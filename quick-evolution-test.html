<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Evolution System Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f0f0f0; 
        }
        .test-container { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            max-width: 800px; 
            margin: 0 auto; 
        }
        .btn { 
            padding: 10px 20px; 
            margin: 5px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🧬 快速进化系统测试</h1>
        
        <div id="testResults"></div>
        
        <div>
            <button class="btn btn-primary" onclick="testModuleLoading()">
                🧪 测试模块加载
            </button>
            <button class="btn btn-success" onclick="testEvolutionInterface()">
                🔧 测试进化界面
            </button>
            <button class="btn btn-warning" onclick="createSimpleModal()">
                📋 创建简单模态框
            </button>
        </div>
        
        <hr>
        <p><strong>说明：</strong> 这个页面独立测试进化系统组件，帮助诊断问题。</p>
    </div>

    <!-- 加载进化系统模块 -->
    <script src="src/renderer/modules/ConversationAnalysisEngine.js"></script>
    <script src="src/renderer/modules/AutoPluginGenerator.js"></script>
    <script src="src/renderer/modules/EvolutionPluginTestFramework.js"></script>
    <script src="src/renderer/modules/ConversationEvolutionManager.js"></script>
    <script src="src/renderer/modules/EvolutionInterfaceManager.js"></script>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('testResults');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
            console.log(message);
        }

        function testModuleLoading() {
            document.getElementById('testResults').innerHTML = '';
            log('🧪 开始测试模块加载...', 'info');
            
            const modules = [
                'ConversationAnalysisEngine',
                'AutoPluginGenerator',
                'EvolutionPluginTestFramework', 
                'ConversationEvolutionManager',
                'EvolutionInterfaceManager'
            ];
            
            let loaded = 0;
            modules.forEach(module => {
                if (window[module]) {
                    log(`✅ ${module} 已加载`, 'success');
                    loaded++;
                } else {
                    log(`❌ ${module} 未找到`, 'error');
                }
            });
            
            log(`📊 总结: ${loaded}/${modules.length} 个模块已加载`, loaded === modules.length ? 'success' : 'error');
        }

        function testEvolutionInterface() {
            log('🔧 测试进化界面创建...', 'info');
            
            try {
                if (!window.ConversationEvolutionManager || !window.EvolutionInterfaceManager) {
                    log('❌ 必需的类未加载', 'error');
                    return;
                }
                
                // 创建模拟依赖
                const mockChatManager = {
                    addConversationUpdateListener: () => {},
                    getConversationHistory: () => []
                };
                const mockPluginManager = {
                    registerPlugin: () => {},
                    getPlugins: () => []
                };
                const mockConfigManager = {
                    get: () => null,
                    set: () => {}
                };
                
                // 创建进化管理器
                const evolutionManager = new ConversationEvolutionManager(
                    mockChatManager, mockPluginManager, mockConfigManager
                );
                log('✅ ConversationEvolutionManager 创建成功', 'success');
                
                // 创建界面管理器
                const interfaceManager = new EvolutionInterfaceManager(evolutionManager);
                log('✅ EvolutionInterfaceManager 创建成功', 'success');
                
                // 尝试打开界面
                interfaceManager.openEvolutionInterface();
                log('✅ 尝试打开进化界面', 'info');
                
                // 检查模态框
                setTimeout(() => {
                    const modal = document.getElementById('evolutionModal');
                    if (modal) {
                        log('✅ 进化模态框已创建', 'success');
                        log(`📏 模态框尺寸: ${modal.getBoundingClientRect().width}x${modal.getBoundingClientRect().height}`, 'info');
                    } else {
                        log('❌ 进化模态框未找到', 'error');
                    }
                }, 500);
                
            } catch (error) {
                log(`❌ 测试失败: ${error.message}`, 'error');
                console.error(error);
            }
        }

        function createSimpleModal() {
            log('📋 创建简单测试模态框...', 'info');
            
            const existingModal = document.getElementById('simpleTestModal');
            if (existingModal) existingModal.remove();
            
            const modal = document.createElement('div');
            modal.id = 'simpleTestModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                z-index: 999999;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white;
                    padding: 30px;
                    border-radius: 8px;
                    text-align: center;
                    color: black;
                    max-width: 500px;
                ">
                    <h2>🎉 简单模态框测试</h2>
                    <p>如果你能看到这个，说明模态框显示功能正常工作。</p>
                    <button onclick="document.getElementById('simpleTestModal').remove()" 
                            style="padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        关闭
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
            log('✅ 简单模态框已创建', 'success');
        }

        // 页面加载后自动测试
        window.addEventListener('load', () => {
            setTimeout(testModuleLoading, 500);
        });
    </script>
</body>
</html> 