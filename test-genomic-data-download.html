<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试基因组数据下载功能</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .test-section h2 {
            color: #34495e;
            margin-top: 0;
        }
        
        .button {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
        }
        
        .button.success {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        }
        
        .log {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 15px;
        }
        
        .menu-info {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .menu-info h3 {
            margin: 0 0 10px 0;
            color: #2e7d32;
        }
        
        .api-test {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .api-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: white;
        }
        
        .api-card h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        
        .api-card p {
            margin: 0 0 15px 0;
            color: #7f8c8d;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧬 基因组数据下载功能测试</h1>
        
        <div class="menu-info">
            <h3>📋 测试说明</h3>
            <p>此页面用于测试新添加的基因组数据下载功能。功能已添加到 <strong>File → Download Genomic Data</strong> 菜单中。</p>
            <ul>
                <li><strong>NCBI Databases:</strong> GenBank Sequences, RefSeq Genomes, SRA Sequencing Data, Assembly Data</li>
                <li><strong>EMBL-EBI Databases:</strong> EMBL Sequences, Ensembl Genomes, ENA Archive</li>
                <li><strong>Other Databases:</strong> DDBJ Sequences, UniProt Proteins, KEGG Pathways</li>
                <li><strong>Bulk Download Manager:</strong> 批量下载管理器 (Cmd/Ctrl+Shift+D)</li>
            </ul>
        </div>
        
        <div class="test-section">
            <h2>🔍 菜单访问测试</h2>
            <p>通过应用菜单测试各个数据库的访问功能：</p>
            <button class="button" onclick="testMenuAccess('ncbi-genbank')">测试 NCBI GenBank</button>
            <button class="button" onclick="testMenuAccess('ncbi-refseq')">测试 NCBI RefSeq</button>
            <button class="button" onclick="testMenuAccess('embl-sequences')">测试 EMBL Sequences</button>
            <button class="button" onclick="testMenuAccess('ensembl-genomes')">测试 Ensembl Genomes</button>
            <button class="button" onclick="testMenuAccess('uniprot-proteins')">测试 UniProt Proteins</button>
        </div>
        
        <div class="test-section">
            <h2>📡 API 连接测试</h2>
            <p>测试与各个公共数据库API的连接状态：</p>
            <div class="api-test">
                <div class="api-card">
                    <h4>NCBI E-utilities</h4>
                    <p>测试NCBI E-utilities API连接</p>
                    <button class="button" onclick="testAPI('ncbi')">测试 NCBI API</button>
                    <div id="ncbi-status"></div>
                </div>
                
                <div class="api-card">
                    <h4>EMBL-EBI</h4>
                    <p>测试EMBL-EBI REST API连接</p>
                    <button class="button" onclick="testAPI('embl')">测试 EMBL API</button>
                    <div id="embl-status"></div>
                </div>
                
                <div class="api-card">
                    <h4>Ensembl</h4>
                    <p>测试Ensembl REST API连接</p>
                    <button class="button" onclick="testAPI('ensembl')">测试 Ensembl API</button>
                    <div id="ensembl-status"></div>
                </div>
                
                <div class="api-card">
                    <h4>UniProt</h4>
                    <p>测试UniProt REST API连接</p>
                    <button class="button" onclick="testAPI('uniprot')">测试 UniProt API</button>
                    <div id="uniprot-status"></div>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>🔬 样本搜索测试</h2>
            <p>使用预定义的搜索词测试各个数据库的搜索功能：</p>
            <button class="button success" onclick="performSampleSearch('escherichia coli')">搜索 E.coli</button>
            <button class="button success" onclick="performSampleSearch('homo sapiens')">搜索 Human</button>
            <button class="button success" onclick="performSampleSearch('saccharomyces cerevisiae')">搜索 Yeast</button>
            <button class="button success" onclick="performSampleSearch('NC_000913')">搜索特定序列号</button>
        </div>
        
        <div class="test-section">
            <h2>📥 下载功能测试</h2>
            <p>测试文件下载功能的基本操作：</p>
            <button class="button" onclick="testDirectorySelection()">测试目录选择</button>
            <button class="button" onclick="testFileDownload()">测试文件下载</button>
            <div id="download-status"></div>
        </div>
        
        <div class="log" id="testLog">测试日志将在这里显示...</div>
    </div>

    <script>
        let logElement = document.getElementById('testLog');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }
        
        function testMenuAccess(downloadType) {
            log(`🔍 Testing menu access for: ${downloadType}`);
            log(`✅ Menu structure successfully added to File → Download Genomic Data`);
            log(`📝 To test: Go to File menu → Download Genomic Data → Select database type`);
            log(`🎯 Expected: Opens genomic download window with ${downloadType} configuration\n`);
        }
        
        async function testAPI(apiType) {
            const statusElement = document.getElementById(`${apiType}-status`);
            statusElement.innerHTML = '⏳ Testing...';
            
            try {
                let testUrl;
                switch (apiType) {
                    case 'ncbi':
                        testUrl = 'https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=nucleotide&term=escherichia%20coli&retmax=1&retmode=json';
                        break;
                    case 'embl':
                        testUrl = 'https://www.ebi.ac.uk/ena/portal/api/search?result=sequence&query=escherichia%20coli&format=json&limit=1';
                        break;
                    case 'ensembl':
                        testUrl = 'https://rest.ensembl.org/info/ping?content-type=application/json';
                        break;
                    case 'uniprot':
                        testUrl = 'https://rest.uniprot.org/uniprotkb/search?query=escherichia%20coli&format=json&size=1';
                        break;
                }
                
                log(`🔗 Testing ${apiType.toUpperCase()} API: ${testUrl}`);
                
                const response = await fetch(testUrl);
                if (response.ok) {
                    statusElement.innerHTML = '✅ API Connected';
                    statusElement.style.color = 'green';
                    log(`✅ ${apiType.toUpperCase()} API test successful (Status: ${response.status})`);
                } else {
                    statusElement.innerHTML = '❌ API Error';
                    statusElement.style.color = 'red';
                    log(`❌ ${apiType.toUpperCase()} API test failed (Status: ${response.status})`);
                }
            } catch (error) {
                statusElement.innerHTML = '❌ Connection Failed';
                statusElement.style.color = 'red';
                log(`❌ ${apiType.toUpperCase()} API connection failed: ${error.message}`);
            }
            log('');
        }
        
        function performSampleSearch(searchTerm) {
            log(`🔬 Sample search test for: "${searchTerm}"`);
            log(`📝 To perform actual search:`);
            log(`   1. Open File → Download Genomic Data → Select any database`);
            log(`   2. Enter search term: "${searchTerm}"`);
            log(`   3. Click "Search Database"`);
            log(`   4. Verify results appear with organism information`);
            log(`🎯 Expected: Results showing accession numbers, organisms, lengths\n`);
        }
        
        async function testDirectorySelection() {
            log(`📁 Testing directory selection...`);
            
            if (window.electronAPI && window.electronAPI.selectDirectory) {
                try {
                    const result = await window.electronAPI.selectDirectory();
                    if (result.success && !result.canceled) {
                        log(`✅ Directory selection successful: ${result.filePath}`);
                    } else if (result.canceled) {
                        log(`ℹ️ Directory selection canceled by user`);
                    } else {
                        log(`❌ Directory selection failed: ${result.error || 'Unknown error'}`);
                    }
                } catch (error) {
                    log(`❌ Directory selection error: ${error.message}`);
                }
            } else {
                log(`❌ electronAPI.selectDirectory not available - requires Electron environment`);
            }
            log('');
        }
        
        async function testFileDownload() {
            log(`📥 Testing file download functionality...`);
            
            if (window.electronAPI && window.electronAPI.downloadFile) {
                try {
                    // 测试下载一个小的样本文件
                    const testUrl = 'https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=nucleotide&id=NC_000913&rettype=fasta&retmode=text&retstart=1&retend=100';
                    const outputPath = './test_download.fasta';
                    
                    log(`🔗 Testing download from: ${testUrl}`);
                    
                    const result = await window.electronAPI.downloadFile(testUrl, outputPath);
                    
                    if (result.success) {
                        log(`✅ File download successful: ${result.filePath}`);
                        document.getElementById('download-status').innerHTML = '✅ Download test passed';
                        document.getElementById('download-status').style.color = 'green';
                    } else {
                        log(`❌ File download failed: ${result.error}`);
                        document.getElementById('download-status').innerHTML = '❌ Download test failed';
                        document.getElementById('download-status').style.color = 'red';
                    }
                } catch (error) {
                    log(`❌ Download test error: ${error.message}`);
                    document.getElementById('download-status').innerHTML = '❌ Download test error';
                    document.getElementById('download-status').style.color = 'red';
                }
            } else {
                log(`❌ electronAPI.downloadFile not available - requires Electron environment`);
                document.getElementById('download-status').innerHTML = '❌ Electron API not available';
                document.getElementById('download-status').style.color = 'red';
            }
            log('');
        }
        
        // 初始化测试
        document.addEventListener('DOMContentLoaded', () => {
            log('🧬 基因组数据下载功能测试页面已加载');
            log('📋 功能特性：');
            log('   ✓ 支持多个公共数据库 (NCBI, EMBL, DDBJ, UniProt, KEGG)');
            log('   ✓ 实时API搜索和数据检索');
            log('   ✓ 多种文件格式下载 (FASTA, GenBank, GFF, EMBL)');
            log('   ✓ 批量下载管理');
            log('   ✓ 智能搜索过滤器');
            log('   ✓ 下载进度跟踪');
            log('');
            log('🎯 测试指南：');
            log('   1. 使用上方按钮测试各个功能模块');
            log('   2. 通过菜单 File → Download Genomic Data 访问主功能');
            log('   3. 验证搜索、预览和下载功能');
            log('');
        });
    </script>
</body>
</html> 