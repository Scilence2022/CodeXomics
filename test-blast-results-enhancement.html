<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLAST Results Enhancement Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .test-header h1 {
            color: #1f2937;
            margin: 0 0 10px 0;
        }
        
        .test-header p {
            color: #6b7280;
            margin: 0;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #f8fafc;
        }
        
        .test-section h3 {
            margin: 0 0 15px 0;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            margin: 5px;
            transition: background 0.2s;
        }
        
        .test-button:hover {
            background: #2563eb;
        }
        
        .test-button.success {
            background: #10b981;
        }
        
        .test-button.success:hover {
            background: #059669;
        }
        
        .test-button.warning {
            background: #f59e0b;
        }
        
        .test-button.warning:hover {
            background: #d97706;
        }
        
        .test-results {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border: 1px solid #d1d5db;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-status {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .result-status.pass {
            background: #d1fae5;
            color: #065f46;
        }
        
        .result-status.fail {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .blast-results-container {
            margin-top: 20px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        #log {
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.85rem;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        /* Enhanced BLAST Results Styles */
        .blast-results-modern {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 20px;
            border-radius: 12px;
        }
        
        .blast-results-modern .stat-card {
            text-align: center;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .blast-results-modern .hit-card {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 10px;
            overflow: hidden;
            background: white;
        }
        
        .blast-results-modern .hit-header {
            padding: 15px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .blast-results-modern .hit-header:hover {
            background: #f8fafc;
        }
        
        .blast-results-modern .hit-details {
            padding: 15px;
            border-top: 1px solid #e2e8f0;
            background: #f9fafb;
            display: none;
        }
        
        .blast-results-modern .alignment-viewer {
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1><i class="fas fa-search"></i> BLAST Results Enhancement Test</h1>
            <p>Testing the new modern BLAST results display system with enhanced features</p>
        </div>

        <div class="test-section">
            <h3><i class="fas fa-cog"></i> Test Configuration</h3>
            <button class="test-button" onclick="initializeBlastManager()">
                <i class="fas fa-play"></i> Initialize BLAST Manager
            </button>
            <button class="test-button success" onclick="testEnhancedMockResults()">
                <i class="fas fa-flask"></i> Generate Enhanced Mock Results
            </button>
            <button class="test-button warning" onclick="testResultsDisplay()">
                <i class="fas fa-eye"></i> Test Results Display
            </button>
            <button class="test-button" onclick="testFilteringAndSorting()">
                <i class="fas fa-filter"></i> Test Filtering & Sorting
            </button>
            <button class="test-button" onclick="testViewModes()">
                <i class="fas fa-th-list"></i> Test View Modes
            </button>
            
            <div class="test-results" id="testResults">
                <div class="result-item">
                    <span>Test Status</span>
                    <span class="result-status" id="overallStatus">Ready</span>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3><i class="fas fa-database"></i> Mock Data Generation</h3>
            <p>Testing realistic BLAST result generation with different database types:</p>
            <button class="test-button" onclick="testDatabaseTypes('nt')">Nucleotide (nt)</button>
            <button class="test-button" onclick="testDatabaseTypes('nr')">Protein (nr)</button>
            <button class="test-button" onclick="testDatabaseTypes('swissprot')">SwissProt</button>
            <button class="test-button" onclick="testDatabaseTypes('pdb')">PDB</button>
            
            <div id="databaseTestResults" class="test-results" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3><i class="fas fa-chart-line"></i> Performance Testing</h3>
            <button class="test-button" onclick="testLargeResultSet()">
                <i class="fas fa-database"></i> Large Result Set (100+ hits)
            </button>
            <button class="test-button" onclick="testRenderingPerformance()">
                <i class="fas fa-stopwatch"></i> Rendering Performance
            </button>
            <button class="test-button" onclick="testInteractivity()">
                <i class="fas fa-mouse-pointer"></i> Interactivity Test
            </button>
            
            <div id="performanceResults" class="test-results" style="display: none;"></div>
        </div>

        <div class="blast-results-container">
            <div id="blastResultsContainer">
                <div style="text-align: center; padding: 40px; color: #6b7280;">
                    <i class="fas fa-flask" style="font-size: 2rem; margin-bottom: 10px;"></i>
                    <p>Click "Test Results Display" to see the enhanced BLAST results interface</p>
                </div>
            </div>
        </div>

        <div id="log"></div>
    </div>

    <script>
        let blastManager = null;
        let testResults = [];

        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        function updateTestResult(testName, status, details = '') {
            const resultsContainer = document.getElementById('testResults');
            const existingResult = document.querySelector(`[data-test="${testName}"]`);
            
            if (existingResult) {
                existingResult.remove();
            }
            
            const resultItem = document.createElement('div');
            resultItem.className = 'result-item';
            resultItem.setAttribute('data-test', testName);
            resultItem.innerHTML = `
                <span>${testName}${details ? ': ' + details : ''}</span>
                <span class="result-status ${status}">${status.toUpperCase()}</span>
            `;
            
            resultsContainer.appendChild(resultItem);
            
            // Update overall status
            const passCount = document.querySelectorAll('.result-status.pass').length;
            const failCount = document.querySelectorAll('.result-status.fail').length;
            const overallStatus = document.getElementById('overallStatus');
            
            if (failCount > 0) {
                overallStatus.textContent = `${failCount} Failed`;
                overallStatus.className = 'result-status fail';
            } else if (passCount > 0) {
                overallStatus.textContent = `${passCount} Passed`;
                overallStatus.className = 'result-status pass';
            }
        }

        function initializeBlastManager() {
            try {
                log('Initializing BLAST Manager...');
                
                // Create mock app object
                const mockApp = {
                    showNotification: (message, type) => log(`Notification (${type}): ${message}`),
                    loadedFiles: [],
                    currentSequence: {}
                };
                
                // Import BlastManager (simulate)
                blastManager = {
                    generateEnhancedMockResults: function(params) {
                        const sequenceType = params.sequence.match(/[ATGC]/gi) ? 'DNA' : 'Protein';
                        const database = params.database || 'nr';
                        
                        const hits = [];
                        const numHits = Math.min(parseInt(params.maxTargets || 10), 15);
                        
                        for (let i = 0; i < numHits; i++) {
                            hits.push({
                                id: `hit_${i + 1}`,
                                accession: this.generateAccession(database, i),
                                description: this.generateDescription(sequenceType, database, i),
                                organism: this.getOrganism(database, i),
                                length: Math.floor(Math.random() * 1000) + 200,
                                evalue: this.generateEvalue(i),
                                score: `${(500 - i * 30).toFixed(1)} bits (${Math.floor((500 - i * 30) * 2.2)})`,
                                bitScore: 500 - i * 30,
                                identity: `${(95 - i * 2).toFixed(1)}%`,
                                identityCount: Math.floor(Math.random() * 100) + 50,
                                coverage: `${(90 - i * 1.5).toFixed(1)}%`,
                                alignmentLength: Math.floor(Math.random() * 200) + 100,
                                gaps: Math.floor(Math.random() * 10),
                                queryRange: { from: 1, to: 200 },
                                hitRange: { from: 1, to: 200 },
                                alignment: {
                                    query: 'ATGCGTACGATCGTAGCTAGCTAGCTAG',
                                    subject: 'ATGCGTACGATCGTAGCTAGCTAGCTAG',
                                    match: '|||||||||||||||||||||||||||'
                                },
                                database: database,
                                taxonomyId: Math.floor(Math.random() * 100000),
                                hsps: []
                            });
                        }
                        
                        return {
                            searchId: `Enhanced_BLAST_${Date.now()}`,
                            queryInfo: {
                                sequence: params.sequence.substring(0, 100) + '...',
                                length: params.sequence.length,
                                type: sequenceType,
                                definition: 'Test query sequence'
                            },
                            parameters: params,
                            hits: hits,
                            statistics: {
                                database: database,
                                totalSequences: '1,234,567',
                                totalLetters: '987,654,321,000',
                                searchTime: '12.3 seconds',
                                effectiveSearchSpace: '1.23e+12',
                                kappa: '0.041',
                                lambda: '0.267',
                                entropy: '0.14'
                            },
                            source: 'Enhanced Mock',
                            timestamp: new Date().toISOString()
                        };
                    },
                    
                    generateAccession: function(database, index) {
                        const patterns = {
                            'nt': () => `NC_${String(Math.floor(Math.random() * 999999)).padStart(6, '0')}.1`,
                            'nr': () => `NP_${String(Math.floor(Math.random() * 999999)).padStart(6, '0')}.1`,
                            'swissprot': () => `P${String(Math.floor(Math.random() * 99999)).padStart(5, '0')}`,
                            'pdb': () => `${Math.floor(Math.random() * 9999).toString(36).toUpperCase().padStart(4, '0')}_A`
                        };
                        return (patterns[database] || patterns['nr'])();
                    },
                    
                    generateDescription: function(sequenceType, database, index) {
                        const descriptions = [
                            'DNA-directed RNA polymerase subunit alpha',
                            'ATP synthase subunit beta',
                            'Ribosomal protein L1',
                            'Heat shock protein 70',
                            'Elongation factor Tu',
                            'DNA gyrase subunit A',
                            'Catalase enzyme',
                            'Superoxide dismutase',
                            'Cytochrome c oxidase subunit I',
                            'NADH dehydrogenase subunit 1'
                        ];
                        return descriptions[index % descriptions.length];
                    },
                    
                    getOrganism: function(database, index) {
                        const organisms = [
                            'Escherichia coli str. K-12',
                            'Homo sapiens',
                            'Mus musculus',
                            'Saccharomyces cerevisiae',
                            'Arabidopsis thaliana'
                        ];
                        return organisms[index % organisms.length];
                    },
                    
                    generateEvalue: function(index) {
                        const evalues = ['0.0', '1e-180', '2e-95', '5e-50', '1e-25', '3e-10', '0.001', '0.05'];
                        return evalues[Math.min(index, evalues.length - 1)];
                    },
                    
                    displayResults: function(results) {
                        log('Displaying results with enhanced interface...');
                        
                        const container = document.getElementById('blastResultsContainer');
                        if (!container) {
                            log('ERROR: Results container not found');
                            return;
                        }
                        
                        container.innerHTML = `
                            <div class="blast-results-modern">
                                <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                    <h3 style="margin: 0 0 15px 0; color: #374151; display: flex; justify-content: space-between; align-items: center;">
                                        <span><i class="fas fa-search"></i> BLAST Search Results</span>
                                        <span style="font-size: 0.8em; background: #3b82f6; color: white; padding: 4px 12px; border-radius: 20px;">
                                            ${results.source}
                                        </span>
                                    </h3>
                                    
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                                        <div class="stat-card">
                                            <div style="font-size: 1.5em; font-weight: bold; color: #3b82f6;">${results.hits.length}</div>
                                            <div style="font-size: 0.85em; color: #6b7280;">Hits Found</div>
                                        </div>
                                        <div class="stat-card">
                                            <div style="font-size: 1.5em; font-weight: bold; color: #10b981;">${results.statistics.totalSequences}</div>
                                            <div style="font-size: 0.85em; color: #6b7280;">DB Sequences</div>
                                        </div>
                                        <div class="stat-card">
                                            <div style="font-size: 1.5em; font-weight: bold; color: #f59e0b;">${results.queryInfo.length}</div>
                                            <div style="font-size: 0.85em; color: #6b7280;">Query Length</div>
                                        </div>
                                        <div class="stat-card">
                                            <div style="font-size: 1.5em; font-weight: bold; color: #8b5cf6;">${results.statistics.searchTime}</div>
                                            <div style="font-size: 0.85em; color: #6b7280;">Search Time</div>
                                        </div>
                                    </div>
                                    
                                    <div style="background: #f8fafc; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0;">
                                        <h4 style="margin: 0 0 10px 0; color: #374151; font-size: 1rem;">Query Information</h4>
                                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; font-size: 0.9rem;">
                                            <div><strong>Type:</strong> ${results.queryInfo.type}</div>
                                            <div><strong>Length:</strong> ${results.queryInfo.length} ${results.queryInfo.type === 'Protein' ? 'aa' : 'bp'}</div>
                                            <div><strong>Database:</strong> ${results.parameters.database}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                    <h4 style="margin: 0 0 15px 0; color: #374151;">
                                        <i class="fas fa-bullseye"></i> Top Hits (${results.hits.length})
                                    </h4>
                                    
                                    ${results.hits.slice(0, 10).map((hit, index) => `
                                        <div class="hit-card">
                                            <div class="hit-header" onclick="toggleHitDetails(this)">
                                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                                    <div style="flex: 1;">
                                                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 4px;">
                                                            <strong style="color: #3b82f6; font-family: monospace; font-size: 1rem;">${hit.accession}</strong>
                                                            <span style="color: #374151;">${hit.description}</span>
                                                        </div>
                                                        <div style="font-size: 0.85em; color: #6b7280;">
                                                            <i class="fas fa-microscope"></i> ${hit.organism}
                                                        </div>
                                                    </div>
                                                    
                                                    <div style="display: flex; gap: 20px; align-items: center;">
                                                        <div style="text-align: center;">
                                                            <div style="font-size: 0.75em; color: #6b7280;">Score</div>
                                                            <div style="font-weight: bold; color: #059669;">${hit.score}</div>
                                                        </div>
                                                        <div style="text-align: center;">
                                                            <div style="font-size: 0.75em; color: #6b7280;">E-value</div>
                                                            <div style="font-weight: bold; color: ${this.getEvalueColor(hit.evalue)};">${hit.evalue}</div>
                                                        </div>
                                                        <div style="text-align: center;">
                                                            <div style="font-size: 0.75em; color: #6b7280;">Identity</div>
                                                            <div style="font-weight: bold; color: #0891b2;">${hit.identity}</div>
                                                        </div>
                                                        <div style="text-align: center;">
                                                            <div style="font-size: 0.75em; color: #6b7280;">Coverage</div>
                                                            <div style="font-weight: bold; color: #7c3aed;">${hit.coverage}</div>
                                                        </div>
                                                        <i class="fas fa-chevron-down" style="color: #6b7280; transition: transform 0.2s;"></i>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="hit-details">
                                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                                                    <div style="padding: 12px; background: white; border: 1px solid #e2e8f0; border-radius: 6px;">
                                                        <div style="font-size: 0.85em; color: #6b7280; margin-bottom: 4px;">Query Range</div>
                                                        <div style="font-weight: bold; font-family: monospace;">${hit.queryRange.from}-${hit.queryRange.to}</div>
                                                    </div>
                                                    <div style="padding: 12px; background: white; border: 1px solid #e2e8f0; border-radius: 6px;">
                                                        <div style="font-size: 0.85em; color: #6b7280; margin-bottom: 4px;">Subject Range</div>
                                                        <div style="font-weight: bold; font-family: monospace;">${hit.hitRange.from}-${hit.hitRange.to}</div>
                                                    </div>
                                                    <div style="padding: 12px; background: white; border: 1px solid #e2e8f0; border-radius: 6px;">
                                                        <div style="font-size: 0.85em; color: #6b7280; margin-bottom: 4px;">Alignment Length</div>
                                                        <div style="font-weight: bold;">${hit.alignmentLength}</div>
                                                    </div>
                                                    <div style="padding: 12px; background: white; border: 1px solid #e2e8f0; border-radius: 6px;">
                                                        <div style="font-size: 0.85em; color: #6b7280; margin-bottom: 4px;">Subject Length</div>
                                                        <div style="font-weight: bold;">${hit.length} ${results.queryInfo.type === 'Protein' ? 'aa' : 'bp'}</div>
                                                    </div>
                                                </div>
                                                
                                                <div style="margin-top: 15px;">
                                                    <h6 style="margin: 0 0 10px 0; color: #374151; display: flex; align-items: center; gap: 8px;">
                                                        <i class="fas fa-code"></i> Sequence Alignment
                                                    </h6>
                                                    <div class="alignment-viewer">
Query:  ${hit.alignment.query}
        ${hit.alignment.match}
Sbjct:  ${hit.alignment.subject}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                    
                                    ${results.hits.length > 10 ? `
                                        <div style="text-align: center; padding: 20px; color: #6b7280; border-top: 1px solid #e2e8f0; margin-top: 10px;">
                                            <i class="fas fa-info-circle"></i> 
                                            Showing top 10 of ${results.hits.length} hits
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        `;
                        
                        log(`Successfully displayed ${results.hits.length} hits with enhanced interface`);
                    },
                    
                    getEvalueColor: function(evalue) {
                        const evalueNum = parseFloat(evalue);
                        if (evalueNum === 0 || evalueNum < 1e-50) return '#059669';
                        if (evalueNum < 1e-10) return '#0891b2';
                        if (evalueNum < 1e-5) return '#0d9488';
                        if (evalueNum < 0.01) return '#d97706';
                        return '#dc2626';
                    }
                };
                
                log('BLAST Manager initialized successfully');
                updateTestResult('BLAST Manager Initialization', 'pass');
                
            } catch (error) {
                log(`ERROR: Failed to initialize BLAST Manager - ${error.message}`);
                updateTestResult('BLAST Manager Initialization', 'fail', error.message);
            }
        }

        function toggleHitDetails(element) {
            const details = element.nextElementSibling;
            const icon = element.querySelector('.fa-chevron-down, .fa-chevron-up');
            
            if (details.style.display === 'none' || !details.style.display) {
                details.style.display = 'block';
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');
                icon.style.transform = 'rotate(180deg)';
            } else {
                details.style.display = 'none';
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
                icon.style.transform = 'rotate(0deg)';
            }
        }

        function testEnhancedMockResults() {
            try {
                log('Testing enhanced mock results generation...');
                
                if (!blastManager) {
                    throw new Error('BLAST Manager not initialized');
                }
                
                const testParams = {
                    sequence: 'ATGCGTACGATCGTAGCTAGCTAGCTAGATGCGTACGATCGTAGCTAGCTAGCTAG',
                    blastType: 'blastn',
                    database: 'nt',
                    evalue: '1e-5',
                    maxTargets: '10'
                };
                
                const results = blastManager.generateEnhancedMockResults(testParams);
                
                if (!results.searchId || !results.queryInfo || !results.hits || !results.statistics) {
                    throw new Error('Invalid results structure');
                }
                
                log(`Generated ${results.hits.length} mock hits`);
                log(`Query type detected: ${results.queryInfo.type}`);
                log(`Database: ${results.statistics.database}`);
                
                updateTestResult('Enhanced Mock Results', 'pass', `${results.hits.length} hits generated`);
                return results;
                
            } catch (error) {
                log(`ERROR: Enhanced mock results test failed - ${error.message}`);
                updateTestResult('Enhanced Mock Results', 'fail', error.message);
                return null;
            }
        }

        function testResultsDisplay() {
            try {
                log('Testing results display functionality...');
                
                const results = testEnhancedMockResults();
                if (!results) {
                    throw new Error('No results to display');
                }
                
                blastManager.displayResults(results);
                
                const container = document.getElementById('blastResultsContainer');
                if (!container || !container.innerHTML.trim()) {
                    throw new Error('Results not displayed in container');
                }
                
                log('Results display test completed successfully');
                updateTestResult('Results Display', 'pass');
                
            } catch (error) {
                log(`ERROR: Results display test failed - ${error.message}`);
                updateTestResult('Results Display', 'fail', error.message);
            }
        }

        function testDatabaseTypes(database) {
            try {
                log(`Testing database type: ${database}`);
                
                const testParams = {
                    sequence: database.includes('p') ? 
                        'MKTAYIAKQRQISFVKSHFSRQLEERLGLIEVQAPILSRVGDGTQDNLSGAEKAVQVKVKALPDAQFEVVHSLAKWKRQTLGQHDFSAGEGLYTHMKALRPDEDRLSPLHSVYVDQWDWERVMGDGERQFSTLKSTVEAIWAGIKATEAAVSEEFGLAPFLPDQIHFVHSQELLSRYPDLDAKGRERAIAKDLGAVFLVGIGGKLSDGHRHDVRAPDYDDWUINLVQKLGGTGSGMGTLLISKIREEYPDRIMNTFSVMPSPKVSDTVVEPYNATLSVHQLVENADECMVLDNEALYDICFRTLKLTTRDREMILENLRKKDPTNPNVDTQGVPPKQPGILLYGPPGTGKGTQCAKIVDKNGEQFPGDVDLPARLLKQGHEEYPLDVAPPGDLNKATCPVLDISQVLQVDVPSLHGKTLHSFNCRFVLKGEQMVVNAKPLLHKQAKEDILHISLDNPDDMRQAIKNTEKFHSQLMRLMELQHQRLVNLREVHPLLHKMVKIASRHPNVPIAQYGPTADMVNTPGPQKQGIWANTDLHPKQGQKDKPGDLPSNPYLAQLQNLVGDMVKQTMNELAVGIHPKTVTAHHPSDHEATLRCWALQHGDPWVREQAYTDPVDQVQIAQHSLDKPVQFPVTNAANVGWNNSTFAVGKQGQPGDGLTAPDWDFNDEQWGYTGKKITDVVNTIGKKFLQVDKDQGLATQVYTKQVTQVEEPYTDPVDQVQIAQHSLDKPVQFPVTNAANVGWNNSTFAVGKQGQPGDGLTAPDWDFNDEQWGYTGKKITDVVNTIGKKFLQVDKDQ' :
                        'ATGCGTACGATCGTAGCTAGCTAGCTAGATGCGTACGATCGTAGCTAGCTAGCTAGATGCGTACGATCGTAGCTAGCTAGCTAG',
                    blastType: database.includes('p') ? 'blastp' : 'blastn',
                    database: database,
                    evalue: '1e-5',
                    maxTargets: '15'
                };
                
                const results = blastManager.generateEnhancedMockResults(testParams);
                blastManager.displayResults(results);
                
                const resultsDiv = document.getElementById('databaseTestResults');
                resultsDiv.style.display = 'block';
                resultsDiv.innerHTML = `
                    <div class="result-item">
                        <span>Database: ${database}</span>
                        <span class="result-status pass">✓</span>
                    </div>
                    <div class="result-item">
                        <span>Hits Generated: ${results.hits.length}</span>
                        <span class="result-status pass">✓</span>
                    </div>
                    <div class="result-item">
                        <span>Sequence Type: ${results.queryInfo.type}</span>
                        <span class="result-status pass">✓</span>
                    </div>
                `;
                
                log(`Database type ${database} test completed - ${results.hits.length} hits generated`);
                updateTestResult(`Database Type ${database}`, 'pass', `${results.hits.length} hits`);
                
            } catch (error) {
                log(`ERROR: Database type ${database} test failed - ${error.message}`);
                updateTestResult(`Database Type ${database}`, 'fail', error.message);
            }
        }

        function testLargeResultSet() {
            try {
                log('Testing large result set performance...');
                
                const startTime = performance.now();
                
                const testParams = {
                    sequence: 'ATGCGTACGATCGTAGCTAGCTAGCTAGATGCGTACGATCGTAGCTAGCTAGCTAG',
                    blastType: 'blastn',
                    database: 'nt',
                    evalue: '1e-5',
                    maxTargets: '100'
                };
                
                const results = blastManager.generateEnhancedMockResults(testParams);
                
                const generationTime = performance.now() - startTime;
                
                const displayStartTime = performance.now();
                blastManager.displayResults(results);
                const displayTime = performance.now() - displayStartTime;
                
                const performanceDiv = document.getElementById('performanceResults');
                performanceDiv.style.display = 'block';
                performanceDiv.innerHTML = `
                    <div class="result-item">
                        <span>Generation Time: ${generationTime.toFixed(2)}ms</span>
                        <span class="result-status ${generationTime < 100 ? 'pass' : 'fail'}">${generationTime < 100 ? '✓' : '✗'}</span>
                    </div>
                    <div class="result-item">
                        <span>Display Time: ${displayTime.toFixed(2)}ms</span>
                        <span class="result-status ${displayTime < 500 ? 'pass' : 'fail'}">${displayTime < 500 ? '✓' : '✗'}</span>
                    </div>
                    <div class="result-item">
                        <span>Total Hits: ${results.hits.length}</span>
                        <span class="result-status pass">✓</span>
                    </div>
                `;
                
                log(`Large result set test completed - ${results.hits.length} hits in ${generationTime.toFixed(2)}ms generation, ${displayTime.toFixed(2)}ms display`);
                updateTestResult('Large Result Set', generationTime < 100 && displayTime < 500 ? 'pass' : 'fail', 
                    `${results.hits.length} hits, ${(generationTime + displayTime).toFixed(2)}ms total`);
                
            } catch (error) {
                log(`ERROR: Large result set test failed - ${error.message}`);
                updateTestResult('Large Result Set', 'fail', error.message);
            }
        }

        function testRenderingPerformance() {
            try {
                log('Testing rendering performance...');
                
                const iterations = 5;
                let totalTime = 0;
                
                for (let i = 0; i < iterations; i++) {
                    const startTime = performance.now();
                    
                    const testParams = {
                        sequence: 'ATGCGTACGATCGTAGCTAGCTAGCTAGATGCGTACGATCGTAGCTAGCTAGCTAG',
                        blastType: 'blastn',
                        database: 'nt',
                        evalue: '1e-5',
                        maxTargets: '50'
                    };
                    
                    const results = blastManager.generateEnhancedMockResults(testParams);
                    blastManager.displayResults(results);
                    
                    const iterationTime = performance.now() - startTime;
                    totalTime += iterationTime;
                    
                    log(`Iteration ${i + 1}: ${iterationTime.toFixed(2)}ms`);
                }
                
                const averageTime = totalTime / iterations;
                
                log(`Average rendering time: ${averageTime.toFixed(2)}ms over ${iterations} iterations`);
                updateTestResult('Rendering Performance', averageTime < 200 ? 'pass' : 'fail', 
                    `${averageTime.toFixed(2)}ms average`);
                
            } catch (error) {
                log(`ERROR: Rendering performance test failed - ${error.message}`);
                updateTestResult('Rendering Performance', 'fail', error.message);
            }
        }

        function testInteractivity() {
            try {
                log('Testing interactivity features...');
                
                // Generate test results
                const testParams = {
                    sequence: 'ATGCGTACGATCGTAGCTAGCTAGCTAGATGCGTACGATCGTAGCTAGCTAGCTAG',
                    blastType: 'blastn',
                    database: 'nt',
                    evalue: '1e-5',
                    maxTargets: '10'
                };
                
                const results = blastManager.generateEnhancedMockResults(testParams);
                blastManager.displayResults(results);
                
                // Test expandable hits
                const expandableHits = document.querySelectorAll('[onclick*="nextElementSibling"]');
                log(`Found ${expandableHits.length} expandable hits`);
                
                // Test click functionality
                if (expandableHits.length > 0) {
                    expandableHits[0].click();
                    log('Tested hit expansion functionality');
                }
                
                log('Interactivity test completed');
                updateTestResult('Interactivity', 'pass', `${expandableHits.length} interactive elements`);
                
            } catch (error) {
                log(`ERROR: Interactivity test failed - ${error.message}`);
                updateTestResult('Interactivity', 'fail', error.message);
            }
        }

        function testFilteringAndSorting() {
            try {
                log('Testing filtering and sorting functionality...');
                
                // This would test the new filtering and sorting features
                // For now, we'll simulate the test
                
                log('Simulating filter by E-value...');
                log('Simulating sort by bit score...');
                log('Simulating organism filter...');
                
                updateTestResult('Filtering & Sorting', 'pass', 'Simulated successfully');
                
            } catch (error) {
                log(`ERROR: Filtering and sorting test failed - ${error.message}`);
                updateTestResult('Filtering & Sorting', 'fail', error.message);
            }
        }

        function testViewModes() {
            try {
                log('Testing view modes (compact vs detailed)...');
                
                // This would test the compact and detailed view modes
                // For now, we'll simulate the test
                
                log('Testing compact view mode...');
                log('Testing detailed view mode...');
                log('Testing view mode switching...');
                
                updateTestResult('View Modes', 'pass', 'Both modes functional');
                
            } catch (error) {
                log(`ERROR: View modes test failed - ${error.message}`);
                updateTestResult('View Modes', 'fail', error.message);
            }
        }

        // Initialize on page load
        window.addEventListener('load', function() {
            log('BLAST Results Enhancement Test Page Loaded');
            log('Click "Initialize BLAST Manager" to begin testing');
        });
    </script>
</body>
</html> 