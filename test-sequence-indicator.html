<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Sequence Gene Indicator with Settings</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            margin: 20px;
        }
        
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .settings-panel {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .settings-row {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .sequence-line-group {
            margin-bottom: 10px;
        }

        .sequence-line {
            margin-bottom: 2px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .sequence-position {
            display: inline-block;
            width: 100px;
            color: #666;
            text-align: right;
            margin-right: 10px;
        }

        .sequence-bases {
            display: inline-block;
        }

        .gene-indicator-line {
            margin-left: 100px;
            padding-left: 10px;
            margin-top: 1px;
            margin-bottom: 3px;
        }

        .gene-indicator-svg {
            display: block;
        }

        .gene-indicator-svg:hover path,
        .gene-indicator-svg:hover rect,
        .gene-indicator-svg:hover line {
            opacity: 1 !important;
            filter: brightness(1.1);
        }

        .gene-indicator-svg path,
        .gene-indicator-svg rect,
        .gene-indicator-svg line {
            cursor: pointer;
        }
        
        .demo-info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .legend {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .legend-symbol {
            width: 30px;
            height: 12px;
            margin-right: 10px;
            border: 1px solid #ccc;
        }
        
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .btn:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="demo-info">
            <h3>Enhanced Sequence Gene Indicator with Settings Demo</h3>
            <p>演示可配置的基因指示条系统，具有以下新功能：</p>
            <ul>
                <li><strong>设置面板：</strong>可配置所有指示器选项</li>
                <li><strong>增大的标记：</strong>更粗的起始线和更大的箭头（2倍）</li>
                <li><strong>基因类型过滤：</strong>可选择显示哪些基因类型</li>
                <li><strong>透明度控制：</strong>可调整指示器透明度</li>
                <li><strong>高度调整：</strong>可设置指示条高度</li>
            </ul>
        </div>
        
        <div class="settings-panel">
            <h4>Gene Indicator Settings</h4>
            <div class="settings-row">
                <label><input type="checkbox" id="showIndicators" checked> Show Indicators</label>
                <label><input type="checkbox" id="showStartMarkers" checked> Start Markers</label>
                <label><input type="checkbox" id="showEndArrows" checked> End Arrows</label>
                <button class="btn" onclick="updateDisplay()">Apply Settings</button>
            </div>
            <div class="settings-row">
                <label>Bar Height: <input type="range" id="indicatorHeight" min="8" max="20" value="12"> <span id="heightValue">12</span>px</label>
                <label>Opacity: <input type="range" id="indicatorOpacity" min="0.3" max="1" step="0.1" value="0.7"> <span id="opacityValue">0.7</span></label>
                <label>Arrow Size: <input type="range" id="arrowSize" min="3" max="12" value="8"> <span id="arrowValue">8</span>px</label>
            </div>
            <div class="settings-row">
                <label>Start Height: <input type="range" id="startMarkerHeight" min="50" max="100" value="85"> <span id="startHeightValue">85</span>%</label>
                <label>Arrow Height: <input type="range" id="arrowHeight" min="50" max="100" value="85"> <span id="arrowHeightValue">85</span>%</label>
            </div>
            <div class="settings-row">
                <label><input type="checkbox" id="showCDS" checked> CDS</label>
                <label><input type="checkbox" id="showRNA" checked> RNA</label>
                <label><input type="checkbox" id="showPromoter" checked> Promoter</label>
                <label><input type="checkbox" id="showTerminator" checked> Terminator</label>
                <label><input type="checkbox" id="showRegulatory" checked> Regulatory</label>
            </div>
        </div>
        
        <div id="sequence-demo">
            <!-- Demo sequence will be generated here -->
        </div>

        <div class="legend">
            <h4>基因指示条图例 (Enhanced)</h4>
            <div class="legend-item">
                <div class="legend-symbol" style="background: #8e44ad; border-radius: 0;"></div>
                <span><strong>CDS</strong> - 编码序列（紫色矩形）+ 起始线 + 方向箭头</span>
            </div>
            <div class="legend-item">
                <div class="legend-symbol" style="background: #f1c40f; clip-path: polygon(0 0, 70% 0, 100% 50%, 70% 100%, 0 100%);"></div>
                <span><strong>Promoter</strong> - 启动子（黄色箭头形状）</span>
            </div>
            <div class="legend-item">
                <div class="legend-symbol" style="background: #27ae60; border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;"></div>
                <span><strong>tRNA/rRNA</strong> - RNA基因（绿色/蓝色波浪形）</span>
            </div>
            <div class="legend-item">
                <div class="legend-symbol" style="background: #d35400; border-radius: 3px;"></div>
                <span><strong>Terminator</strong> - 终止子（橙色圆角矩形）</span>
            </div>
            <div class="legend-item">
                <div class="legend-symbol" style="background: #c0392b;"></div>
                <span><strong>Regulatory</strong> - 调控元件（红色矩形）</span>
            </div>
            <div style="margin-top: 10px; font-size: 14px; color: #666;">
                <p><strong>增强的标记说明：</strong></p>
                <p>｜ 竖线（可调宽度）= 基因起始位置</p>
                <p>► 右箭头（可调大小）= 正链基因终止</p>
                <p>◄ 左箭头（可调大小）= 负链基因终止</p>
                <p>🎛️ 可通过设置面板实时调整所有参数</p>
                <p><strong>新增高度设置：</strong></p>
                <p>• 起始标记高度：50-100%（指示条高度百分比）</p>
                <p>• 箭头高度：50-100%（指示条高度百分比）</p>
            </div>
        </div>
    </div>
    
    <script>
        // Settings object
        let settings = {
            showIndicators: true,
            indicatorHeight: 12,
            indicatorOpacity: 0.7,
            showStartMarkers: true,
            showEndArrows: true,
            arrowSize: 8,
            startMarkerHeight: 85,
            arrowHeight: 85,
            showCDS: true,
            showRNA: true,
            showPromoter: true,
            showTerminator: true,
            showRegulatory: true
        };
        
        function createGeneIndicator(x, width, height, type, color, isForward, hasStart, hasEnd) {
            if (!settings.showIndicators) return '';
            
            // Filter by type
            if (type === 'CDS' && !settings.showCDS) return '';
            if (['tRNA', 'rRNA'].includes(type) && !settings.showRNA) return '';
            if (type === 'Promoter' && !settings.showPromoter) return '';
            if (type === 'Terminator' && !settings.showTerminator) return '';
            if (type === 'Regulatory' && !settings.showRegulatory) return '';
            
            let indicator = '';
            const opacity = settings.indicatorOpacity;
            
            // Gene body
            if (type === 'Promoter') {
                if (isForward) {
                    indicator += `<path d="M ${x} 3 L ${x + width - 6} 3 L ${x + width} ${height/2} L ${x + width - 6} ${height - 3} L ${x} ${height - 3} Z" fill="${color}" opacity="${opacity}"/>`;
                } else {
                    indicator += `<path d="M ${x + 6} 3 L ${x + width} 3 L ${x + width} ${height - 3} L ${x + 6} ${height - 3} L ${x} ${height/2} Z" fill="${color}" opacity="${opacity}"/>`;
                }
            } else if (type === 'Terminator') {
                indicator += `<rect x="${x}" y="3" width="${width}" height="${height - 6}" rx="3" ry="3" fill="${color}" opacity="${opacity}"/>`;
            } else if (['tRNA', 'rRNA'].includes(type)) {
                indicator += `<path d="M ${x} 5 Q ${x + width/4} 3 ${x + width/2} 4 Q ${x + 3*width/4} 3 ${x + width} 5 L ${x + width} ${height - 3} L ${x} ${height - 3} Z" fill="${color}" opacity="${opacity}"/>`;
            } else {
                indicator += `<rect x="${x}" y="3" width="${width}" height="${height - 6}" fill="${color}" opacity="${opacity}"/>`;
            }
            
            // Start marker with configurable height
            if (settings.showStartMarkers && hasStart) {
                const darkColor = darkenColor(color, 30);
                const markerHeight = (height * settings.startMarkerHeight / 100);
                const markerOffset = (height - markerHeight) / 2;
                indicator += `<line x1="${x}" y1="${markerOffset}" x2="${x}" y2="${markerOffset + markerHeight}" stroke="${darkColor}" stroke-width="3" opacity="0.9"/>`;
            }
            
            // End arrow with configurable height
            if (settings.showEndArrows && hasEnd) {
                const darkColor = darkenColor(color, 40);
                const arrowSize = settings.arrowSize;
                const arrowHeight = (height * settings.arrowHeight / 100);
                const arrowOffset = (height - arrowHeight) / 2;
                const arrowTop = arrowOffset;
                const arrowMiddle = height / 2;
                const arrowBottom = arrowOffset + arrowHeight;
                
                if (isForward) {
                    indicator += `<path d="M ${x + width - arrowSize} ${arrowTop} L ${x + width} ${arrowMiddle} L ${x + width - arrowSize} ${arrowBottom} Z" fill="${darkColor}" opacity="1"/>`;
                } else {
                    indicator += `<path d="M ${x + arrowSize} ${arrowTop} L ${x} ${arrowMiddle} L ${x + arrowSize} ${arrowBottom} Z" fill="${darkColor}" opacity="1"/>`;
                }
            }
            
            return indicator;
        }
        
        function darkenColor(color, percent) {
            const num = parseInt(color.replace('#', ''), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) - amt;
            const G = (num >> 8 & 0x00FF) - amt;
            const B = (num & 0x0000FF) - amt;
            return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 + 
                        (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 + 
                        (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
        }
        
        function updateDisplay() {
            // Update settings
            settings.showIndicators = document.getElementById('showIndicators').checked;
            settings.indicatorHeight = parseInt(document.getElementById('indicatorHeight').value);
            settings.indicatorOpacity = parseFloat(document.getElementById('indicatorOpacity').value);
            settings.showStartMarkers = document.getElementById('showStartMarkers').checked;
            settings.showEndArrows = document.getElementById('showEndArrows').checked;
            settings.arrowSize = parseInt(document.getElementById('arrowSize').value);
            settings.startMarkerHeight = parseInt(document.getElementById('startMarkerHeight').value);
            settings.arrowHeight = parseInt(document.getElementById('arrowHeight').value);
            settings.showCDS = document.getElementById('showCDS').checked;
            settings.showRNA = document.getElementById('showRNA').checked;
            settings.showPromoter = document.getElementById('showPromoter').checked;
            settings.showTerminator = document.getElementById('showTerminator').checked;
            settings.showRegulatory = document.getElementById('showRegulatory').checked;
            
            // Generate demo
            generateDemo();
        }
        
        function generateDemo() {
            const container = document.getElementById('sequence-demo');
            const height = settings.indicatorHeight;
            
            if (!settings.showIndicators) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">Gene indicators are disabled</p>';
                return;
            }
            
            container.innerHTML = `
                <div class="sequence-line-group">
                    <div class="sequence-line">
                        <span class="sequence-position">1</span>
                        <div class="sequence-bases">ATGCGTAAAGCCATGCGTAAAGCCATGCGTAAAGCCATGCGTAAAGCCATGCGTAAAGCC</div>
                    </div>
                    <div class="gene-indicator-line">
                        <svg class="gene-indicator-svg" style="width: 720px; height: ${height}px;">
                            ${createGeneIndicator(0, 60, height, 'Promoter', '#f1c40f', true, true, true)}
                            ${createGeneIndicator(80, 180, height, 'CDS', '#8e44ad', true, true, true)}
                            ${createGeneIndicator(280, 60, height, 'Terminator', '#d35400', true, true, true)}
                        </svg>
                    </div>
                </div>
                
                <div class="sequence-line-group">
                    <div class="sequence-line">
                        <span class="sequence-position">61</span>
                        <div class="sequence-bases">GCATGCGTAAAGCCATGCGTAAAGCCATGCGTAAAGCCATGCGTAAAGCCATGCGTAAAGC</div>
                    </div>
                    <div class="gene-indicator-line">
                        <svg class="gene-indicator-svg" style="width: 720px; height: ${height}px;">
                            ${createGeneIndicator(0, 80, height, 'tRNA', '#27ae60', true, true, true)}
                            ${createGeneIndicator(120, 200, height, 'CDS', '#8e44ad', false, true, true)}
                        </svg>
                    </div>
                </div>
                
                <div class="sequence-line-group">
                    <div class="sequence-line">
                        <span class="sequence-position">121</span>
                        <div class="sequence-bases">CATGCGTAAAGCCATGCGTAAAGCCATGCGTAAAGCCATGCGTAAAGCCATGCGTAAAGCC</div>
                    </div>
                    <div class="gene-indicator-line">
                        <svg class="gene-indicator-svg" style="width: 720px; height: ${height}px;">
                            ${createGeneIndicator(0, 120, height, 'rRNA', '#2980b9', false, true, true)}
                            ${createGeneIndicator(160, 120, height, 'Regulatory', '#c0392b', true, true, true)}
                        </svg>
                    </div>
                </div>
            `;
        }
        
        // Update value displays and trigger demo update
        document.getElementById('indicatorHeight').addEventListener('input', function() {
            document.getElementById('heightValue').textContent = this.value;
            updateDisplay();
        });
        
        document.getElementById('indicatorOpacity').addEventListener('input', function() {
            document.getElementById('opacityValue').textContent = this.value;
            updateDisplay();
        });
        
        document.getElementById('arrowSize').addEventListener('input', function() {
            document.getElementById('arrowValue').textContent = this.value;
            updateDisplay();
        });
        
        document.getElementById('startMarkerHeight').addEventListener('input', function() {
            document.getElementById('startHeightValue').textContent = this.value;
            updateDisplay();
        });
        
        document.getElementById('arrowHeight').addEventListener('input', function() {
            document.getElementById('arrowHeightValue').textContent = this.value;
            updateDisplay();
        });
        
        // Checkbox event listeners
        ['showIndicators', 'showStartMarkers', 'showEndArrows', 'showCDS', 'showRNA', 'showPromoter', 'showTerminator', 'showRegulatory']
        .forEach(id => {
            document.getElementById(id).addEventListener('change', updateDisplay);
        });
        
        // Initial generation
        generateDemo();
    </script>
</body>
</html> 