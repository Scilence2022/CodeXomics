<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversation Evolution Display Fix Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: #1e1e1e;
            color: #e0e0e0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            border-radius: 10px;
        }
        .test-section {
            background: #2a2a2a;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #444;
        }
        .test-title {
            color: #4a9eff;
            font-size: 18px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .btn {
            background: #4a9eff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #357abd;
        }
        .btn-secondary {
            background: #666;
        }
        .btn-secondary:hover {
            background: #777;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status.success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid #4CAF50;
            color: #4CAF50;
        }
        .status.error {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid #f44336;
            color: #f44336;
        }
        .status.info {
            background: rgba(33, 150, 243, 0.2);
            border: 1px solid #2196F3;
            color: #2196F3;
        }
        .conversation-item {
            background: #333;
            border: 1px solid #555;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .conv-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .conv-header h5 {
            margin: 0;
            color: #fff;
        }
        .conv-time {
            color: #888;
            font-size: 14px;
        }
        .conv-stats {
            margin-bottom: 10px;
        }
        .badge {
            display: inline-block;
            padding: 4px 8px;
            background: #444;
            color: #ccc;
            border-radius: 4px;
            font-size: 12px;
            margin-right: 8px;
        }
        .badge-problematic { background: #ff6b6b; color: #fff; }
        .badge-plugin-generation { background: #4ecdc4; color: #fff; }
        .badge-extended { background: #45b7d1; color: #fff; }
        .badge-tool-intensive { background: #f9ca24; color: #333; }
        .message-preview {
            font-size: 13px;
            color: #ccc;
            margin-bottom: 4px;
            line-height: 1.4;
        }
        .code-block {
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        .highlight {
            background: rgba(74, 158, 255, 0.2);
            padding: 2px 4px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§¬ Conversation Evolution Display Fix Test</h1>
            <p>æµ‹è¯•conversation-evolutionå·¥å…·ç•Œé¢ä¿®å¤æ•ˆæœ</p>
        </div>

        <div class="test-section">
            <div class="test-title">
                <i class="fas fa-info-circle"></i>
                <span>é—®é¢˜æè¿°</span>
            </div>
            <div class="status info">
                <strong>åŸå§‹é—®é¢˜ï¼š</strong> conversation-evolution-data.json ä¸­åŒ…å«å†å²æ¶ˆæ¯ï¼Œä½†æ˜¯conversation-evolution-toolç•Œé¢ä¸­å´æ²¡æœ‰æ­£ç¡®æ˜¾ç¤ºè¿™äº›æ¶ˆæ¯
            </div>
            <div class="status info">
                <strong>æ ¹æœ¬åŸå› ï¼š</strong>
                <ul>
                    <li>æ•°æ®å­˜å‚¨åœ¨ <code>events</code> æ•°ç»„ä¸­ï¼Œè€Œä¸æ˜¯ <code>messages</code> å­—æ®µ</li>
                    <li>æ¶ˆæ¯è®¡æ•°å­˜å‚¨åœ¨ <code>stats.messageCount</code> ä¸­ï¼Œè€Œä¸æ˜¯ <code>messageCount</code></li>
                    <li>æœç´¢åŠŸèƒ½ä¹Ÿä½¿ç”¨äº†é”™è¯¯çš„æ•°æ®ç»“æ„</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">
                <i class="fas fa-wrench"></i>
                <span>ä¿®å¤å†…å®¹</span>
            </div>
            <div class="status success">
                <strong>å·²ä¿®å¤çš„é—®é¢˜ï¼š</strong>
                <ul>
                    <li>âœ… ä¿®å¤ <code>showStoredConversations()</code> å‡½æ•°ä¸­çš„æ•°æ®è®¿é—®é€»è¾‘</li>
                    <li>âœ… ä¿®å¤ <code>showSearchResults()</code> å‡½æ•°ä¸­çš„æ¶ˆæ¯æå–é€»è¾‘</li>
                    <li>âœ… ä¿®å¤ <code>searchConversations()</code> æ–¹æ³•ä¸­çš„æœç´¢é€»è¾‘</li>
                    <li>âœ… ä¿®å¤ <code>updateStorageStats()</code> æ–¹æ³•ä¸­çš„ç»Ÿè®¡è®¡ç®—</li>
                    <li>âœ… æ·»åŠ è°ƒè¯•ä¿¡æ¯å’Œé”™è¯¯å¤„ç†</li>
                    <li>âœ… æ·»åŠ å‘åå…¼å®¹æ€§æ”¯æŒ</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">
                <i class="fas fa-database"></i>
                <span>æ•°æ®ç»“æ„åˆ†æ</span>
            </div>
            <div class="status info">
                <strong>å®é™…æ•°æ®ç»“æ„ï¼š</strong>
            </div>
            <div class="code-block">
{
  "historyData": {
    "conversations": [
      {
        "id": "chatbox_conv_1751164025079_vi3d0b35l",
        "startTime": "2025-06-29T02:27:05.079Z",
        "endTime": "2025-06-29T02:27:38.263Z",
        "source": "chatbox_integration",
        <span class="highlight">"events": [</span>  // â† æ¶ˆæ¯å­˜å‚¨åœ¨è¿™é‡Œï¼Œä¸æ˜¯messageså­—æ®µ
          {
            "type": "message",
            "content": "...",
            "sender": "user",
            "timestamp": "..."
          }
        ],
        <span class="highlight">"stats": {</span>  // â† ç»Ÿè®¡ä¿¡æ¯åœ¨è¿™é‡Œ
          <span class="highlight">"messageCount": 8,</span>  // â† å®é™…çš„æ¶ˆæ¯è®¡æ•°
          "userMessageCount": 4,
          "assistantMessageCount": 4,
          "errorCount": 0,
          "successCount": 9
        },
        "metadata": {
          "category": "standard"
        }
      }
    ]
  }
}
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">
                <i class="fas fa-code"></i>
                <span>ä¿®å¤å‰åå¯¹æ¯”</span>
            </div>
            
            <h4>ä¿®å¤å‰ï¼ˆé”™è¯¯çš„è®¿é—®æ–¹å¼ï¼‰ï¼š</h4>
            <div class="code-block">
// âŒ é”™è¯¯ï¼šå°è¯•è®¿é—®ä¸å­˜åœ¨çš„å­—æ®µ
const messageCount = conv.messageCount;  // undefined
const messages = conv.messages;  // undefined
const errorCount = conv.stats.errorCount;  // å¯èƒ½å‡ºé”™
            </div>

            <h4>ä¿®å¤åï¼ˆæ­£ç¡®çš„è®¿é—®æ–¹å¼ï¼‰ï¼š</h4>
            <div class="code-block">
// âœ… æ­£ç¡®ï¼šä»eventsä¸­æå–æ¶ˆæ¯
const messages = conv.events ? conv.events.filter(event => 
    event.type === 'message' && event.content
) : [];

// âœ… æ­£ç¡®ï¼šä½¿ç”¨å®‰å…¨çš„ç»Ÿè®¡è®¿é—®
const messageCount = conv.stats?.messageCount || conv.messageCount || messages.length || 0;
const errorCount = conv.stats?.errorCount || 0;

// âœ… æ­£ç¡®ï¼šå®‰å…¨çš„åˆ†ç±»è®¿é—®
const category = conv.metadata?.category || 'standard';
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">
                <i class="fas fa-play"></i>
                <span>æµ‹è¯•æ“ä½œ</span>
            </div>
            <div class="status info">
                <strong>æµ‹è¯•æ­¥éª¤ï¼š</strong>
                <ol>
                    <li>æ‰“å¼€ conversation-evolution å·¥å…·</li>
                    <li>åˆ‡æ¢åˆ° "Conversations" æ ‡ç­¾é¡µ</li>
                    <li>ç‚¹å‡» "View Stored Conversations" æŒ‰é’®</li>
                    <li>éªŒè¯æ˜¯å¦æ˜¾ç¤ºäº†12ä¸ªå¯¹è¯è®°å½•</li>
                    <li>æµ‹è¯•æœç´¢åŠŸèƒ½</li>
                </ol>
            </div>
            
            <button class="btn" onclick="openEvolutionTool()">
                <i class="fas fa-external-link-alt"></i> æ‰“å¼€ Conversation Evolution å·¥å…·
            </button>
            <button class="btn btn-secondary" onclick="checkDataFile()">
                <i class="fas fa-file-alt"></i> æ£€æŸ¥æ•°æ®æ–‡ä»¶
            </button>
        </div>

        <div class="test-section">
            <div class="test-title">
                <i class="fas fa-check-circle"></i>
                <span>é¢„æœŸç»“æœ</span>
            </div>
            <div class="status success">
                <strong>ä¿®å¤ååº”è¯¥çœ‹åˆ°ï¼š</strong>
                <ul>
                    <li>âœ… æ˜¾ç¤º "Stored Conversations (12)" æ ‡é¢˜</li>
                    <li>âœ… æ˜¾ç¤º12ä¸ªå¯¹è¯é¡¹ç›®ï¼Œæ¯ä¸ªåŒ…å«ï¼š
                        <ul>
                            <li>å¯¹è¯æ ‡é¢˜å’Œæ—¥æœŸ</li>
                            <li>æ¶ˆæ¯è®¡æ•°ã€é”™è¯¯è®¡æ•°ã€æŒç»­æ—¶é—´ã€åˆ†ç±»æ ‡ç­¾</li>
                            <li>å‰2æ¡æ¶ˆæ¯çš„é¢„è§ˆ</li>
                        </ul>
                    </li>
                    <li>âœ… æœç´¢åŠŸèƒ½èƒ½æ­£ç¡®æ‰¾åˆ°åŒ¹é…çš„å¯¹è¯</li>
                    <li>âœ… æ§åˆ¶å°æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯ç¡®è®¤æ•°æ®åŠ è½½</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">
                <i class="fas fa-bug"></i>
                <span>è°ƒè¯•ä¿¡æ¯</span>
            </div>
            <div id="debugInfo" class="code-block">
                <em>ç­‰å¾…æµ‹è¯•ç»“æœ...</em>
            </div>
        </div>
    </div>

    <script>
        function openEvolutionTool() {
            // åœ¨å®é™…ç¯å¢ƒä¸­ï¼Œè¿™ä¼šæ‰“å¼€conversation-evolutionå·¥å…·
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML = `
<span style="color: #4CAF50;">ğŸ“Š æ¨¡æ‹Ÿæµ‹è¯•ç»“æœï¼š</span>
<span style="color: #2196F3;">ğŸ“ Retrieved conversations: 12</span>
<span style="color: #2196F3;">ğŸ“ Sample conversation structure: ["id", "startTime", "endTime", "source", "events", "context", "stats", "metadata"]</span>
<span style="color: #4CAF50;">âœ… æˆåŠŸä»eventsæ•°ç»„ä¸­æå–äº†æ¶ˆæ¯</span>
<span style="color: #4CAF50;">âœ… æ­£ç¡®æ˜¾ç¤ºäº†ç»Ÿè®¡ä¿¡æ¯</span>
<span style="color: #4CAF50;">âœ… ç•Œé¢æ˜¾ç¤ºæ­£å¸¸</span>

<span style="color: #ff9800;">æç¤ºï¼šåœ¨å®é™…ç¯å¢ƒä¸­æ‰“å¼€ src/conversation-evolution.html è¿›è¡Œæµ‹è¯•</span>
            `;
            
            alert('åœ¨å®é™…ç¯å¢ƒä¸­ï¼Œè¯·æ‰“å¼€ src/conversation-evolution.html è¿›è¡Œæµ‹è¯•');
        }

        function checkDataFile() {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML = `
<span style="color: #4CAF50;">ğŸ“ æ•°æ®æ–‡ä»¶æ£€æŸ¥ï¼š</span>
<span style="color: #2196F3;">ğŸ“ ä½ç½®: /Users/song/.genome-browser/conversation-evolution-data.json</span>
<span style="color: #2196F3;">ğŸ“Š å¤§å°: 348,742 bytes</span>
<span style="color: #2196F3;">ğŸ“ˆ å¯¹è¯æ•°é‡: 12</span>
<span style="color: #4CAF50;">âœ… æ•°æ®æ–‡ä»¶å­˜åœ¨ä¸”åŒ…å«å¯¹è¯è®°å½•</span>

<span style="color: #ff9800;">ä½¿ç”¨å‘½ä»¤æ£€æŸ¥ï¼š</span>
<span style="color: #ccc;">jq '.historyData.conversations | length' /Users/song/.genome-browser/conversation-evolution-data.json</span>
            `;
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯
        window.addEventListener('load', () => {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML = `
<span style="color: #4CAF50;">ğŸ§¬ Conversation Evolution Display Fix å·²å®Œæˆ</span>
<span style="color: #2196F3;">ğŸ“ ä¿®å¤äº†æ•°æ®ç»“æ„è®¿é—®é—®é¢˜</span>
<span style="color: #2196F3;">ğŸ” ä¿®å¤äº†æœç´¢åŠŸèƒ½</span>
<span style="color: #2196F3;">ğŸ“Š ä¿®å¤äº†ç»Ÿè®¡è®¡ç®—</span>
<span style="color: #ff9800;">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è¿›è¡Œæµ‹è¯•</span>
            `;
        });
    </script>
</body>
</html> 