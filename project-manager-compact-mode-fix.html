<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Manager Compact Mode Fix Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }
        
        .fix-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            background: #f8f9fa;
        }
        
        .fix-section h3 {
            color: #667eea;
            margin-top: 0;
        }
        
        .code-block {
            background: #f1f3f4;
            border: 1px solid #dadce0;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        
        .test-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .fix-result {
            margin: 15px 0;
            padding: 12px;
            border-radius: 8px;
            font-weight: 500;
        }
        
        .fix-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .fix-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .fix-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ”§ Project Manager Compact Mode Fix</h1>
        
        <div class="fix-section">
            <h3>ğŸ¯ é—®é¢˜è¯Šæ–­</h3>
            <p>é”™è¯¯ä¿¡æ¯ï¼š<code>projectManagerWindow.toggleCompactMode is not a function</code></p>
            <p>åŸå› åˆ†æï¼š</p>
            <ul>
                <li>ProjectManagerWindow.js è„šæœ¬å¯èƒ½æœªæ­£ç¡®åŠ è½½</li>
                <li>projectManagerWindow å®ä¾‹å¯èƒ½åœ¨DOMå®Œå…¨åŠ è½½å‰è¢«è®¿é—®</li>
                <li>å¯èƒ½å­˜åœ¨é‡å¤çš„å˜é‡å£°æ˜</li>
            </ul>
        </div>
        
        <div class="fix-section">
            <h3>ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ</h3>
            
            <h4>æ–¹æ¡ˆ1: æ·»åŠ å®‰å…¨åŒ…è£…å‡½æ•°</h4>
            <div class="code-block">
// åœ¨ &lt;script&gt; æ ‡ç­¾ä¸­æ·»åŠ å®‰å…¨åŒ…è£…å‡½æ•°
function toggleCompactMode() {
    if (window.projectManagerWindow && 
        typeof window.projectManagerWindow.toggleCompactMode === 'function') {
        window.projectManagerWindow.toggleCompactMode();
    } else {
        console.warn('ProjectManagerWindow not ready or toggleCompactMode method not available');
        // å»¶è¿Ÿé‡è¯•
        setTimeout(toggleCompactMode, 500);
    }
}
            </div>
            
            <h4>æ–¹æ¡ˆ2: ä½¿ç”¨äº‹ä»¶å§”æ‰˜</h4>
            <div class="code-block">
// ä½¿ç”¨äº‹ä»¶å§”æ‰˜è€Œä¸æ˜¯å†…è”äº‹ä»¶å¤„ç†å™¨
document.addEventListener('DOMContentLoaded', () => {
    const compactToggle = document.getElementById('compactModeToggle');
    if (compactToggle) {
        compactToggle.addEventListener('change', (e) => {
            if (projectManagerWindow && projectManagerWindow.toggleCompactMode) {
                projectManagerWindow.toggleCompactMode();
            }
        });
    }
});
            </div>
            
            <h4>æ–¹æ¡ˆ3: ç¡®ä¿è„šæœ¬åŠ è½½é¡ºåº</h4>
            <div class="code-block">
&lt;!-- ç¡®ä¿ ProjectManagerWindow.js åœ¨ä½¿ç”¨å‰åŠ è½½ --&gt;
&lt;script src="renderer/modules/ProjectManagerWindow.js"&gt;&lt;/script&gt;
&lt;script src="renderer/modules/ProjectXMLHandler.js"&gt;&lt;/script&gt;
&lt;script src="renderer/modules/ProjectManager.js"&gt;&lt;/script&gt;
            </div>
        </div>
        
        <div class="fix-section">
            <h3>âœ… æ¨èçš„å®Œæ•´ä¿®å¤</h3>
            <p>ç»“åˆå¤šç§æ–¹æ¡ˆçš„æœ€ä½³ä¿®å¤æ–¹å¼ï¼š</p>
            
            <div class="code-block">
&lt;!-- HTML ä¸­çš„ toggle switch --&gt;
&lt;input type="checkbox" id="compactModeToggle"&gt;

&lt;script&gt;
// å®‰å…¨çš„åˆå§‹åŒ–å‡½æ•°
function initializeCompactMode() {
    const toggle = document.getElementById('compactModeToggle');
    if (toggle && window.projectManagerWindow) {
        toggle.addEventListener('change', () => {
            if (typeof projectManagerWindow.toggleCompactMode === 'function') {
                projectManagerWindow.toggleCompactMode();
            }
        });
        
        // åŠ è½½ä¿å­˜çš„åå¥½è®¾ç½®
        if (typeof projectManagerWindow.initializeCompactMode === 'function') {
            projectManagerWindow.initializeCompactMode();
        }
    }
}

// ç­‰å¾… ProjectManagerWindow å®ä¾‹åŒ–åå†åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', () => {
    // å»¶è¿Ÿåˆå§‹åŒ–ä»¥ç¡®ä¿æ‰€æœ‰è„šæœ¬éƒ½å·²åŠ è½½
    setTimeout(initializeCompactMode, 100);
});
&lt;/script&gt;
            </div>
        </div>
        
        <div class="fix-section">
            <h3>ğŸ§ª æµ‹è¯•ä¿®å¤ç»“æœ</h3>
            <button class="test-btn" onclick="testProjectManagerWindowAvailable()">
                æ£€æŸ¥ ProjectManagerWindow å¯ç”¨æ€§
            </button>
            <button class="test-btn" onclick="testToggleFunctionAvailable()">
                æ£€æŸ¥ toggleCompactMode æ–¹æ³•
            </button>
            <button class="test-btn" onclick="applyQuickFix()">
                åº”ç”¨å¿«é€Ÿä¿®å¤
            </button>
            
            <div id="fixResults"></div>
        </div>
        
        <div class="fix-section">
            <h3>ğŸ“ ä¿®å¤åçš„é¡¹ç›®ç®¡ç†å™¨</h3>
            <iframe src="src/project-manager.html" width="100%" height="600" style="border: 2px solid #dee2e6; border-radius: 12px;"></iframe>
        </div>
    </div>

    <script>
        function addFixResult(test, status, message) {
            const resultsDiv = document.getElementById('fixResults');
            const statusClass = status === 'SUCCESS' ? 'fix-success' : 
                              status === 'ERROR' ? 'fix-error' : 'fix-info';
            
            const resultHtml = `
                <div class="fix-result ${statusClass}">
                    <strong>${test}</strong><br>
                    ${message}
                </div>
            `;
            resultsDiv.innerHTML += resultHtml;
        }
        
        function testProjectManagerWindowAvailable() {
            try {
                const iframe = document.querySelector('iframe');
                const iframeWindow = iframe.contentWindow;
                
                if (iframeWindow.projectManagerWindow) {
                    addFixResult('ProjectManagerWindow æ£€æŸ¥', 'SUCCESS', 
                        'ProjectManagerWindow å®ä¾‹å·²åˆ›å»ºå¹¶å¯è®¿é—®');
                } else {
                    addFixResult('ProjectManagerWindow æ£€æŸ¥', 'ERROR', 
                        'ProjectManagerWindow å®ä¾‹ä¸å¯ç”¨ï¼Œéœ€è¦æ£€æŸ¥è„šæœ¬åŠ è½½');
                }
            } catch (error) {
                addFixResult('ProjectManagerWindow æ£€æŸ¥', 'ERROR', 
                    `æ£€æŸ¥å¤±è´¥: ${error.message}`);
            }
        }
        
        function testToggleFunctionAvailable() {
            try {
                const iframe = document.querySelector('iframe');
                const iframeWindow = iframe.contentWindow;
                
                if (iframeWindow.projectManagerWindow && 
                    typeof iframeWindow.projectManagerWindow.toggleCompactMode === 'function') {
                    addFixResult('toggleCompactMode æ–¹æ³•æ£€æŸ¥', 'SUCCESS', 
                        'toggleCompactMode æ–¹æ³•å¯ç”¨');
                } else {
                    addFixResult('toggleCompactMode æ–¹æ³•æ£€æŸ¥', 'ERROR', 
                        'toggleCompactMode æ–¹æ³•ä¸å¯ç”¨');
                }
            } catch (error) {
                addFixResult('toggleCompactMode æ–¹æ³•æ£€æŸ¥', 'ERROR', 
                    `æ£€æŸ¥å¤±è´¥: ${error.message}`);
            }
        }
        
        function applyQuickFix() {
            addFixResult('å¿«é€Ÿä¿®å¤', 'INFO', 
                'æ­£åœ¨åº”ç”¨ä¿®å¤...');
            
            try {
                const iframe = document.querySelector('iframe');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                const iframeWindow = iframe.contentWindow;
                
                // åˆ›å»ºå®‰å…¨çš„åŒ…è£…å‡½æ•°
                iframeWindow.toggleCompactMode = function() {
                    if (iframeWindow.projectManagerWindow && 
                        typeof iframeWindow.projectManagerWindow.toggleCompactMode === 'function') {
                        iframeWindow.projectManagerWindow.toggleCompactMode();
                    } else {
                        console.warn('ProjectManagerWindow not ready, retrying...');
                        setTimeout(() => {
                            if (iframeWindow.projectManagerWindow && 
                                typeof iframeWindow.projectManagerWindow.toggleCompactMode === 'function') {
                                iframeWindow.projectManagerWindow.toggleCompactMode();
                            }
                        }, 500);
                    }
                };
                
                addFixResult('å¿«é€Ÿä¿®å¤', 'SUCCESS', 
                    'å®‰å…¨åŒ…è£…å‡½æ•°å·²æ·»åŠ ï¼Œç°åœ¨å¯ä»¥å°è¯•ä½¿ç”¨ Simple Mode åˆ‡æ¢');
                    
            } catch (error) {
                addFixResult('å¿«é€Ÿä¿®å¤', 'ERROR', 
                    `ä¿®å¤å¤±è´¥: ${error.message}`);
            }
        }
        
        // æ¸…ç©ºä¹‹å‰çš„ç»“æœ
        window.addEventListener('load', () => {
            document.getElementById('fixResults').innerHTML = '';
        });
    </script>
</body>
</html> 