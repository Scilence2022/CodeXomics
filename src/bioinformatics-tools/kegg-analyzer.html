<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KEGG Pathway Analysis - CodeXomics</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- Plotly loading commented out to improve performance -->
    <!-- <script src="https://cdn.plot.ly/plotly-latest.min.js"></script> -->
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --bg-primary: #f8f9fa;
            --bg-secondary: #ffffff;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --border-color: #dee2e6;
            --radius: 8px;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .app-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .app-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .app-title i {
            font-size: 2rem;
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: var(--radius);
        }

        .title-text h1 {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .title-text p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .main-container {
            display: flex;
            height: calc(100vh - 100px);
            max-width: 1400px;
            margin: 0 auto;
            gap: 20px;
            padding: 20px;
        }

        .sidebar {
            width: 400px;
            background: var(--bg-secondary);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 20px;
            overflow-y: auto;
        }

        .content-area {
            flex: 1;
            background: var(--bg-secondary);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 20px;
            overflow-y: auto;
        }

        .form-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 14px;
            margin-bottom: 15px;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--secondary-color);
            color: white;
            width: 100%;
            justify-content: center;
        }

        .btn-primary:hover {
            background: var(--primary-color);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .pathway-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .pathway-card:hover {
            box-shadow: var(--shadow);
            transform: translateY(-2px);
        }

        .pathway-id {
            font-weight: 600;
            color: var(--secondary-color);
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        .pathway-name {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .pathway-stats {
            display: flex;
            gap: 15px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .loading i {
            font-size: 2rem;
            animation: spin 1s linear infinite;
            margin-bottom: 10px;
            display: block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-message {
            padding: 10px;
            border-radius: var(--radius);
            margin-bottom: 15px;
        }

        .status-success {
            background: rgba(39, 174, 96, 0.1);
            border: 1px solid rgba(39, 174, 96, 0.3);
            color: var(--success-color);
        }

        .status-error {
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid rgba(231, 76, 60, 0.3);
            color: var(--danger-color);
        }
    </style>
</head>
<body>
    <div class="app-header">
        <div class="header-content">
            <div class="app-title">
                <i class="fas fa-sitemap"></i>
                <div class="title-text">
                    <h1>KEGG Pathway Analysis</h1>
                    <p>Kyoto Encyclopedia of Genes and Genomes</p>
                </div>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="sidebar">
            <div class="form-section">
                <div class="section-title">
                    <i class="fas fa-upload"></i>
                    Input Data
                </div>
                
                <select class="form-control" id="organism">
                    <option value="hsa">Homo sapiens (Human)</option>
                    <option value="mmu">Mus musculus (Mouse)</option>
                    <option value="sce">Saccharomyces cerevisiae</option>
                    <option value="eco">Escherichia coli</option>
                    <option value="dme">Drosophila melanogaster</option>
                </select>
                
                <textarea class="form-control" id="geneInput" placeholder="Enter gene symbols or KEGG IDs (one per line):
TP53
EGFR
BRCA1
MYC" rows="8"></textarea>
                
                <button class="btn btn-primary" id="analyzeBtn">
                    <i class="fas fa-play"></i>
                    Analyze Pathways
                </button>
            </div>

            <div class="form-section">
                <div class="section-title">
                    <i class="fas fa-sliders-h"></i>
                    Analysis Options
                </div>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">P-value Threshold</label>
                    <input type="number" class="form-control" id="pValueThreshold" value="0.05" step="0.01" min="0" max="1">
                </div>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Minimum Gene Count</label>
                    <input type="number" class="form-control" id="minGeneCount" value="2" min="1">
                </div>
            </div>

            <div class="form-section">
                <div class="section-title">
                    <i class="fas fa-bolt"></i>
                    Quick Actions
                </div>

                <button class="btn btn-success" id="exampleBtn" style="margin-bottom: 10px;">
                    <i class="fas fa-flask"></i>
                    Load Example
                </button>

                <button class="btn btn-primary" id="clearBtn">
                    <i class="fas fa-trash"></i>
                    Clear Results
                </button>
            </div>
        </div>

        <div class="content-area">
            <div id="statusArea"></div>
            
            <div id="resultsContainer">
                <div class="loading" style="display: none;" id="loadingIndicator">
                    <i class="fas fa-spinner"></i>
                    <p>Analyzing KEGG pathways...</p>
                </div>
                
                <div id="keggResults">
                    <div style="text-align: center; padding: 40px; color: #7f8c8d;">
                        <i class="fas fa-sitemap" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.3;"></i>
                        <h3>No KEGG Analysis Results</h3>
                        <p>Enter gene data and click "Analyze Pathways" to see results.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="tool-menu-handler.js"></script>
    <script>
        class KEGGAnalyzer {
            constructor() {
                this.init();
            }

            init() {
                document.getElementById('analyzeBtn').addEventListener('click', () => this.analyzePathways());
                document.getElementById('exampleBtn').addEventListener('click', () => this.loadExample());
                document.getElementById('clearBtn').addEventListener('click', () => this.clearResults());
            }

            loadExample() {
                // Show organism selection dialog
                const sampleOptions = `
                    <div style="text-align: center; padding: 20px;">
                        <h3>Select Sample Dataset</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
                            <button class="btn btn-primary" onclick="this.loadHumanSample()" style="padding: 15px;">
                                <i class="fas fa-user"></i><br>
                                Human Cancer Genes<br>
                                <small>(TP53, EGFR, BRCA1...)</small>
                            </button>
                            <button class="btn btn-success" onclick="this.loadEcoliSample()" style="padding: 15px;">
                                <i class="fas fa-bacteria"></i><br>
                                E. coli K12 Genes<br>
                                <small>(lacZ, trpA, recA...)</small>
                            </button>
                        </div>
                        <button class="btn btn-secondary" onclick="this.closeSampleDialog()" style="width: 100px;">Cancel</button>
                    </div>
                `;
                
                const dialog = document.createElement('div');
                dialog.id = 'sampleDialog';
                dialog.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                    background: rgba(0,0,0,0.5); z-index: 1000; display: flex; 
                    align-items: center; justify-content: center;
                `;
                dialog.innerHTML = `<div style="background: white; border-radius: 10px; max-width: 500px; width: 90%;">${sampleOptions}</div>`;
                document.body.appendChild(dialog);
                
                // Add event listeners to buttons
                dialog.querySelector('button:nth-of-type(1)').onclick = () => this.loadHumanSample();
                dialog.querySelector('button:nth-of-type(2)').onclick = () => this.loadEcoliSample();
                dialog.querySelector('button:nth-of-type(3)').onclick = () => this.closeSampleDialog();
            }

            loadHumanSample() {
                document.getElementById('geneInput').value = `TP53
EGFR
BRCA1
MYC
KRAS
PTEN
RB1
CDKN2A`;
                document.getElementById('organism').value = 'hsa';
                this.closeSampleDialog();
                this.showStatus('Human cancer genes sample loaded successfully!', 'success');
            }

            loadEcoliSample() {
                document.getElementById('geneInput').value = `lacZ
lacY
lacA
trpA
trpB
trpC
trpD
trpE
recA
recB
recC
lexA
rpoB
rpoD
ftsZ
dnaA
dnaB
dnaC
gyrA
gyrB
topA
ssb
polA
ligA
dam
seqA
ftsA
ftsQ
ftsW
ftsI
murE
murF
acrA
acrB
tolC
ompF
ompC
malE
malF
malG
malK
glpF
glpK
glpD
fadA
fadB
aceA
aceB
gltA
acnA
acnB
icdA
sucA
sucB
sucC
sucD
sdhA
sdhB
sdhC
sdhD
fumA
fumB
fumC
mdh
pykA
pykF
eno
pgk
gapA
fbaA
tpiA
pfkA
pfkB
glk
pgi
fbp
gnd
zwf
rpe
rpiA
tkfA
tkfB
tktA
tktB
talA
talB`;
                document.getElementById('organism').value = 'eco';
                this.closeSampleDialog();
                this.showStatus('E. coli K12 metabolic genes sample loaded successfully!', 'success');
            }

            closeSampleDialog() {
                const dialog = document.getElementById('sampleDialog');
                if (dialog) {
                    dialog.remove();
                }
            }

            clearResults() {
                document.getElementById('keggResults').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #7f8c8d;">
                        <i class="fas fa-sitemap" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.3;"></i>
                        <h3>No KEGG Analysis Results</h3>
                        <p>Enter gene data and click "Analyze Pathways" to see results.</p>
                    </div>
                `;
                this.showStatus('Results cleared.', 'success');
            }

            async analyzePathways() {
                const geneInput = document.getElementById('geneInput').value.trim();
                if (!geneInput) {
                    this.showStatus('Please enter gene data to analyze.', 'error');
                    return;
                }

                const genes = geneInput.split('\n').filter(g => g.trim());
                const organism = document.getElementById('organism').value;
                const pValueThreshold = parseFloat(document.getElementById('pValueThreshold').value);
                const minGeneCount = parseInt(document.getElementById('minGeneCount').value);

                this.showLoading(true);
                this.showStatus('Querying KEGG database...', 'success');

                try {
                    await this.delay(2500);
                    const results = await this.simulateKEGGAnalysis(genes, organism, pValueThreshold, minGeneCount);
                    this.displayResults(results);
                    this.showStatus(`Analysis complete! Found ${results.enrichedPathways.length} enriched pathways.`, 'success');
                } catch (error) {
                    this.showStatus(`Analysis failed: ${error.message}`, 'error');
                } finally {
                    this.showLoading(false);
                }
            }

            async simulateKEGGAnalysis(genes, organism, pValueThreshold, minGeneCount) {
                let pathwayDatabase = [];
                
                if (organism === 'eco') {
                    // E. coli K12 specific pathways
                    pathwayDatabase = [
                        { id: 'eco00010', name: 'Glycolysis / Gluconeogenesis', category: 'Carbohydrate Metabolism', geneCount: Math.floor(Math.random() * 8) + 5 },
                        { id: 'eco00020', name: 'Citrate cycle (TCA cycle)', category: 'Carbohydrate Metabolism', geneCount: Math.floor(Math.random() * 6) + 4 },
                        { id: 'eco00030', name: 'Pentose phosphate pathway', category: 'Carbohydrate Metabolism', geneCount: Math.floor(Math.random() * 5) + 3 },
                        { id: 'eco00040', name: 'Pentose and glucuronate interconversions', category: 'Carbohydrate Metabolism', geneCount: Math.floor(Math.random() * 4) + 2 },
                        { id: 'eco00051', name: 'Fructose and mannose metabolism', category: 'Carbohydrate Metabolism', geneCount: Math.floor(Math.random() * 5) + 3 },
                        { id: 'eco00052', name: 'Galactose metabolism', category: 'Carbohydrate Metabolism', geneCount: Math.floor(Math.random() * 4) + 2 },
                        { id: 'eco00053', name: 'Ascorbate and aldarate metabolism', category: 'Carbohydrate Metabolism', geneCount: Math.floor(Math.random() * 3) + 2 },
                        { id: 'eco00061', name: 'Fatty acid biosynthesis', category: 'Lipid Metabolism', geneCount: Math.floor(Math.random() * 6) + 3 },
                        { id: 'eco00071', name: 'Fatty acid degradation', category: 'Lipid Metabolism', geneCount: Math.floor(Math.random() * 5) + 3 },
                        { id: 'eco00240', name: 'Pyrimidine metabolism', category: 'Nucleotide Metabolism', geneCount: Math.floor(Math.random() * 7) + 4 },
                        { id: 'eco00230', name: 'Purine metabolism', category: 'Nucleotide Metabolism', geneCount: Math.floor(Math.random() * 8) + 5 },
                        { id: 'eco00260', name: 'Glycine, serine and threonine metabolism', category: 'Amino Acid Metabolism', geneCount: Math.floor(Math.random() * 6) + 3 },
                        { id: 'eco00270', name: 'Cysteine and methionine metabolism', category: 'Amino Acid Metabolism', geneCount: Math.floor(Math.random() * 5) + 3 },
                        { id: 'eco00280', name: 'Valine, leucine and isoleucine degradation', category: 'Amino Acid Metabolism', geneCount: Math.floor(Math.random() * 4) + 2 },
                        { id: 'eco00290', name: 'Valine, leucine and isoleucine biosynthesis', category: 'Amino Acid Metabolism', geneCount: Math.floor(Math.random() * 5) + 3 },
                        { id: 'eco00300', name: 'Lysine biosynthesis', category: 'Amino Acid Metabolism', geneCount: Math.floor(Math.random() * 4) + 2 },
                        { id: 'eco00310', name: 'Lysine degradation', category: 'Amino Acid Metabolism', geneCount: Math.floor(Math.random() * 3) + 2 },
                        { id: 'eco00350', name: 'Tyrosine metabolism', category: 'Amino Acid Metabolism', geneCount: Math.floor(Math.random() * 4) + 2 },
                        { id: 'eco00360', name: 'Phenylalanine metabolism', category: 'Amino Acid Metabolism', geneCount: Math.floor(Math.random() * 3) + 2 },
                        { id: 'eco00380', name: 'Tryptophan metabolism', category: 'Amino Acid Metabolism', geneCount: Math.floor(Math.random() * 5) + 3 },
                        { id: 'eco00400', name: 'Phenylalanine, tyrosine and tryptophan biosynthesis', category: 'Amino Acid Metabolism', geneCount: Math.floor(Math.random() * 6) + 4 },
                        { id: 'eco00410', name: 'beta-Alanine metabolism', category: 'Amino Acid Metabolism', geneCount: Math.floor(Math.random() * 3) + 2 },
                        { id: 'eco00430', name: 'Taurine and hypotaurine metabolism', category: 'Amino Acid Metabolism', geneCount: Math.floor(Math.random() * 3) + 2 },
                        { id: 'eco00440', name: 'Phosphonate and phosphinate metabolism', category: 'Metabolism of Other Amino Acids', geneCount: Math.floor(Math.random() * 4) + 2 },
                        { id: 'eco00450', name: 'Selenocompound metabolism', category: 'Metabolism of Other Amino Acids', geneCount: Math.floor(Math.random() * 3) + 2 },
                        { id: 'eco00460', name: 'Cyanoamino acid metabolism', category: 'Metabolism of Other Amino Acids', geneCount: Math.floor(Math.random() * 3) + 2 },
                        { id: 'eco00471', name: 'D-Glutamine and D-glutamate metabolism', category: 'Metabolism of Other Amino Acids', geneCount: Math.floor(Math.random() * 3) + 2 },
                        { id: 'eco00473', name: 'D-Alanine metabolism', category: 'Metabolism of Other Amino Acids', geneCount: Math.floor(Math.random() * 3) + 2 },
                        { id: 'eco00480', name: 'Glutathione metabolism', category: 'Metabolism of Other Amino Acids', geneCount: Math.floor(Math.random() * 4) + 2 },
                        { id: 'eco00500', name: 'Starch and sucrose metabolism', category: 'Carbohydrate Metabolism', geneCount: Math.floor(Math.random() * 5) + 3 },
                        { id: 'eco00520', name: 'Amino sugar and nucleotide sugar metabolism', category: 'Carbohydrate Metabolism', geneCount: Math.floor(Math.random() * 6) + 4 },
                        { id: 'eco00540', name: 'Lipopolysaccharide biosynthesis', category: 'Glycan Biosynthesis and Metabolism', geneCount: Math.floor(Math.random() * 7) + 4 },
                        { id: 'eco00550', name: 'Peptidoglycan biosynthesis', category: 'Glycan Biosynthesis and Metabolism', geneCount: Math.floor(Math.random() * 6) + 3 },
                        { id: 'eco00564', name: 'Glycerophospholipid metabolism', category: 'Lipid Metabolism', geneCount: Math.floor(Math.random() * 5) + 3 },
                        { id: 'eco00620', name: 'Pyruvate metabolism', category: 'Carbohydrate Metabolism', geneCount: Math.floor(Math.random() * 6) + 4 },
                        { id: 'eco00630', name: 'Glyoxylate and dicarboxylate metabolism', category: 'Carbohydrate Metabolism', geneCount: Math.floor(Math.random() * 5) + 3 },
                        { id: 'eco00640', name: 'Propanoate metabolism', category: 'Carbohydrate Metabolism', geneCount: Math.floor(Math.random() * 4) + 3 },
                        { id: 'eco00650', name: 'Butanoate metabolism', category: 'Carbohydrate Metabolism', geneCount: Math.floor(Math.random() * 4) + 2 },
                        { id: 'eco00660', name: 'C5-Branched dibasic acid metabolism', category: 'Carbohydrate Metabolism', geneCount: Math.floor(Math.random() * 3) + 2 },
                        { id: 'eco00670', name: 'One carbon pool by folate', category: 'Metabolism of Cofactors and Vitamins', geneCount: Math.floor(Math.random() * 4) + 3 },
                        { id: 'eco00680', name: 'Methane metabolism', category: 'Energy Metabolism', geneCount: Math.floor(Math.random() * 3) + 2 },
                        { id: 'eco00710', name: 'Carbon fixation in photosynthetic organisms', category: 'Energy Metabolism', geneCount: Math.floor(Math.random() * 5) + 3 },
                        { id: 'eco00720', name: 'Carbon fixation pathways in prokaryotes', category: 'Energy Metabolism', geneCount: Math.floor(Math.random() * 4) + 3 },
                        { id: 'eco00730', name: 'Thiamine metabolism', category: 'Metabolism of Cofactors and Vitamins', geneCount: Math.floor(Math.random() * 4) + 2 },
                        { id: 'eco00740', name: 'Riboflavin metabolism', category: 'Metabolism of Cofactors and Vitamins', geneCount: Math.floor(Math.random() * 3) + 2 },
                        { id: 'eco00750', name: 'Vitamin B6 metabolism', category: 'Metabolism of Cofactors and Vitamins', geneCount: Math.floor(Math.random() * 3) + 2 },
                        { id: 'eco00760', name: 'Nicotinate and nicotinamide metabolism', category: 'Metabolism of Cofactors and Vitamins', geneCount: Math.floor(Math.random() * 4) + 2 },
                        { id: 'eco00770', name: 'Pantothenate and CoA biosynthesis', category: 'Metabolism of Cofactors and Vitamins', geneCount: Math.floor(Math.random() * 4) + 3 },
                        { id: 'eco00780', name: 'Biotin metabolism', category: 'Metabolism of Cofactors and Vitamins', geneCount: Math.floor(Math.random() * 3) + 2 },
                        { id: 'eco00785', name: 'Lipoic acid metabolism', category: 'Metabolism of Cofactors and Vitamins', geneCount: Math.floor(Math.random() * 3) + 2 },
                        { id: 'eco00790', name: 'Folate biosynthesis', category: 'Metabolism of Cofactors and Vitamins', geneCount: Math.floor(Math.random() * 4) + 3 },
                        { id: 'eco00860', name: 'Porphyrin and chlorophyll metabolism', category: 'Metabolism of Cofactors and Vitamins', geneCount: Math.floor(Math.random() * 5) + 3 },
                        { id: 'eco00900', name: 'Terpenoid backbone biosynthesis', category: 'Metabolism of Terpenoids and Polyketides', geneCount: Math.floor(Math.random() * 4) + 3 },
                        { id: 'eco00910', name: 'Nitrogen metabolism', category: 'Energy Metabolism', geneCount: Math.floor(Math.random() * 5) + 3 },
                        { id: 'eco00920', name: 'Sulfur metabolism', category: 'Energy Metabolism', geneCount: Math.floor(Math.random() * 4) + 3 },
                        { id: 'eco01040', name: 'Biosynthesis of unsaturated fatty acids', category: 'Lipid Metabolism', geneCount: Math.floor(Math.random() * 4) + 3 },
                        { id: 'eco01100', name: 'Metabolic pathways', category: 'Global and Overview Maps', geneCount: Math.floor(Math.random() * 15) + 10 },
                        { id: 'eco01110', name: 'Biosynthesis of secondary metabolites', category: 'Global and Overview Maps', geneCount: Math.floor(Math.random() * 12) + 8 },
                        { id: 'eco01120', name: 'Microbial metabolism in diverse environments', category: 'Global and Overview Maps', geneCount: Math.floor(Math.random() * 10) + 6 },
                        { id: 'eco01200', name: 'Carbon metabolism', category: 'Global and Overview Maps', geneCount: Math.floor(Math.random() * 12) + 8 },
                        { id: 'eco01210', name: '2-Oxocarboxylic acid metabolism', category: 'Global and Overview Maps', geneCount: Math.floor(Math.random() * 6) + 4 },
                        { id: 'eco01212', name: 'Fatty acid metabolism', category: 'Global and Overview Maps', geneCount: Math.floor(Math.random() * 8) + 5 },
                        { id: 'eco01230', name: 'Biosynthesis of amino acids', category: 'Global and Overview Maps', geneCount: Math.floor(Math.random() * 10) + 7 },
                        { id: 'eco02010', name: 'ABC transporters', category: 'Environmental Information Processing', geneCount: Math.floor(Math.random() * 12) + 8 },
                        { id: 'eco02020', name: 'Two-component system', category: 'Environmental Information Processing', geneCount: Math.floor(Math.random() * 8) + 5 },
                        { id: 'eco02030', name: 'Bacterial chemotaxis', category: 'Environmental Information Processing', geneCount: Math.floor(Math.random() * 6) + 4 },
                        { id: 'eco02040', name: 'Flagellar assembly', category: 'Cellular Processes', geneCount: Math.floor(Math.random() * 7) + 4 },
                        { id: 'eco03010', name: 'Ribosome', category: 'Genetic Information Processing', geneCount: Math.floor(Math.random() * 15) + 10 },
                        { id: 'eco03020', name: 'RNA polymerase', category: 'Genetic Information Processing', geneCount: Math.floor(Math.random() * 5) + 3 },
                        { id: 'eco03030', name: 'DNA replication', category: 'Genetic Information Processing', geneCount: Math.floor(Math.random() * 8) + 5 },
                        { id: 'eco03060', name: 'Protein export', category: 'Genetic Information Processing', geneCount: Math.floor(Math.random() * 6) + 4 },
                        { id: 'eco03070', name: 'Bacterial secretion system', category: 'Environmental Information Processing', geneCount: Math.floor(Math.random() * 7) + 4 },
                        { id: 'eco03410', name: 'Base excision repair', category: 'Genetic Information Processing', geneCount: Math.floor(Math.random() * 5) + 3 },
                        { id: 'eco03420', name: 'Nucleotide excision repair', category: 'Genetic Information Processing', geneCount: Math.floor(Math.random() * 6) + 4 },
                        { id: 'eco03430', name: 'Mismatch repair', category: 'Genetic Information Processing', geneCount: Math.floor(Math.random() * 5) + 3 },
                        { id: 'eco03440', name: 'Homologous recombination', category: 'Genetic Information Processing', geneCount: Math.floor(Math.random() * 7) + 4 }
                    ];
                } else {
                    // Human pathways (default)
                    pathwayDatabase = [
                        { id: 'hsa05200', name: 'Pathways in cancer', category: 'Human Diseases', geneCount: Math.floor(Math.random() * 6) + 3 },
                        { id: 'hsa04110', name: 'Cell cycle', category: 'Cellular Processes', geneCount: Math.floor(Math.random() * 5) + 2 },
                        { id: 'hsa04115', name: 'p53 signaling pathway', category: 'Cellular Processes', geneCount: Math.floor(Math.random() * 4) + 2 },
                        { id: 'hsa04151', name: 'PI3K-Akt signaling pathway', category: 'Signal Transduction', geneCount: Math.floor(Math.random() * 7) + 3 },
                        { id: 'hsa04210', name: 'Apoptosis', category: 'Cellular Processes', geneCount: Math.floor(Math.random() * 5) + 2 }
                    ];
                }

                const enrichedPathways = pathwayDatabase.map(pathway => ({
                    ...pathway,
                    pValue: Math.random() * pValueThreshold,
                    fdr: Math.random() * 0.2,
                    enrichmentScore: Math.random() * 3 + 1,
                    geneRatio: `${pathway.geneCount}/${genes.length}`,
                    bgRatio: `${pathway.geneCount + Math.floor(Math.random() * 100)}/20000`
                })).filter(pathway => pathway.geneCount >= minGeneCount);

                return {
                    inputGenes: genes,
                    organism: organism,
                    enrichedPathways: enrichedPathways.sort((a, b) => a.pValue - b.pValue),
                    statistics: {
                        totalInputGenes: genes.length,
                        mappedGenes: Math.floor(genes.length * 0.90),
                        enrichedPathways: enrichedPathways.length
                    }
                };
            }

            displayResults(results) {
                const container = document.getElementById('keggResults');
                
                if (!results.enrichedPathways.length) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #7f8c8d;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.3;"></i>
                            <h3>No Enriched Pathways Found</h3>
                            <p>Try adjusting your thresholds or use different genes.</p>
                        </div>
                    `;
                    return;
                }

                const summaryHtml = `
                    <div style="margin-bottom: 20px; padding: 15px; background: #e8f4fd; border-radius: 8px;">
                        <h4>Analysis Summary</h4>
                        <p><strong>Input Genes:</strong> ${results.statistics.totalInputGenes} | 
                           <strong>Mapped:</strong> ${results.statistics.mappedGenes} | 
                           <strong>Enriched Pathways:</strong> ${results.statistics.enrichedPathways}</p>
                        <p><strong>Organism:</strong> ${results.organism.toUpperCase()}</p>
                    </div>
                `;

                const pathwayCards = results.enrichedPathways.map(pathway => `
                    <div class="pathway-card">
                        <div class="pathway-id">${pathway.id}</div>
                        <div class="pathway-name">${pathway.name}</div>
                        <div style="margin: 10px 0; color: #666; font-style: italic;">${pathway.category}</div>
                        <div class="pathway-stats">
                            <div class="stat-item">
                                <i class="fas fa-dna"></i>
                                <span>${pathway.geneRatio}</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-chart-line"></i>
                                <span>p = ${pathway.pValue.toExponential(2)}</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-fire"></i>
                                <span>ES = ${pathway.enrichmentScore.toFixed(2)}</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-percentage"></i>
                                <span>FDR = ${pathway.fdr.toFixed(3)}</span>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="window.open('https://www.genome.jp/kegg-bin/show_pathway?${pathway.id}', '_blank')" style="margin-top: 15px; width: auto;">
                            <i class="fas fa-external-link-alt"></i>
                            View in KEGG
                        </button>
                    </div>
                `).join('');

                container.innerHTML = summaryHtml + pathwayCards;
            }

            showLoading(show) {
                document.getElementById('loadingIndicator').style.display = show ? 'block' : 'none';
            }

            showStatus(message, type) {
                const statusArea = document.getElementById('statusArea');
                statusArea.innerHTML = `
                    <div class="status-message status-${type}">
                        <i class="fas fa-${type === 'success' ? 'check' : 'exclamation-triangle'}"></i>
                        ${message}
                    </div>
                `;
                setTimeout(() => statusArea.innerHTML = '', 5000);
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // 注意：ToolMenuHandler类已从外部文件 tool-menu-handler.js 引入
        // 不需要在此处重复定义

        document.addEventListener('DOMContentLoaded', () => {
            window.keggAnalyzer = new KEGGAnalyzer();
            // 初始化菜单处理器，传入工具名称和实例
            window.toolMenuHandler = new ToolMenuHandler('KEGG Pathway Analysis', window.keggAnalyzer);
        });
    </script>
</body>
</html> 