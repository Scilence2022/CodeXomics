<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Circos Genome Plotter - Genome AI Studio</title>
    
    <!-- External Dependencies -->
    <script src="../node_modules/d3/dist/d3.min.js" onerror="this.onerror=null; this.src='https://d3js.org/d3.v7.min.js'"></script>
    <script src="../node_modules/papaparse/papaparse.min.js" onerror="this.onerror=null; this.src='https://unpkg.com/papaparse@5/papaparse.min.js'"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
            gap: 15px;
            padding: 15px;
        }

        .main-panel {
            flex: 1;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-width: 0; /* Allow flex shrinking */
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-title h1 {
            font-size: 24px;
            font-weight: 600;
        }

        .header-title i {
            font-size: 28px;
        }

        .toolbar {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px 20px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: #4a90e2;
            color: white;
        }

        .btn-primary:hover {
            background: #357abd;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #475569;
        }

        .btn-secondary:hover {
            background: #cbd5e1;
        }

        .circos-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            padding: 20px;
        }

        #circos-svg {
            background: #fefefe;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            max-width: 100%;
            max-height: 100%;
        }

        .parameters-panel {
            width: 320px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            max-height: 100%;
        }

        .panel-header {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-header h3 {
            font-size: 16px;
            font-weight: 600;
        }

        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }

        .parameter-section {
            padding: 16px;
            border-bottom: 1px solid #e2e8f0;
        }

        .parameter-section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .parameter-group {
            margin-bottom: 16px;
        }

        .parameter-group:last-child {
            margin-bottom: 0;
        }

        .parameter-group label {
            display: block;
            font-size: 12px;
            font-weight: 500;
            color: #4b5563;
            margin-bottom: 6px;
        }

        .parameter-input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .parameter-input:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .color-input {
            width: 60px;
            height: 36px;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .color-input:hover {
            border-color: #10b981;
        }

        .range-input {
            width: 100%;
            margin: 8px 0;
        }

        .range-value {
            font-size: 11px;
            color: #6b7280;
            text-align: center;
            margin-top: 4px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .checkbox-input {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .checkbox-label {
            font-size: 12px;
            color: #4b5563;
            cursor: pointer;
            margin: 0;
        }

        .button-group {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .btn-small {
            flex: 1;
            padding: 6px 12px;
            font-size: 11px;
            border-radius: 4px;
        }

        .preset-colors {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
            margin-top: 8px;
        }

        .preset-color {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .preset-color:hover {
            border-color: #374151;
            transform: scale(1.1);
        }

        .preset-color.active {
            border-color: #10b981;
            transform: scale(1.15);
        }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 16px;
            color: #6b7280;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f4f6;
            border-top: 4px solid #4a90e2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Circos plot specific styles */
        .chromosome-arc {
            fill: none;
            stroke-width: 8;
            cursor: pointer;
        }

        .chromosome-label {
            font-size: 12px;
            font-weight: 600;
            text-anchor: middle;
            cursor: pointer;
        }

        .track {
            opacity: 0.8;
        }

        .tick {
            stroke: #666;
            stroke-width: 1;
        }

        .tick-label {
            font-size: 10px;
            fill: #666;
            text-anchor: middle;
        }

        .link {
            fill: none;
            stroke-width: 2;
            opacity: 0.6;
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        /* Status indicator */
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #6b7280;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ef4444;
        }

        .status-dot.connected {
            background: #10b981;
        }

        .status-dot.loading {
            background: #f59e0b;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Main Circos Plot Panel -->
        <div class="main-panel">
            <div class="header">
                <div class="header-title">
                    <i class="fas fa-chart-pie"></i>
                    <h1>Circos Genome Plotter</h1>
                </div>
                <div class="status-indicator">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">Ready</span>
                </div>
            </div>
            
            <div class="toolbar">
                <button class="btn btn-primary" id="loadDataBtn">
                    <i class="fas fa-upload"></i>
                    Load Data
                </button>
                <button class="btn btn-secondary" id="exampleDataBtn">
                    <i class="fas fa-flask"></i>
                    Load Example
                </button>
                <button class="btn btn-secondary" id="exportBtn">
                    <i class="fas fa-download"></i>
                    Export SVG
                </button>
                <button class="btn btn-secondary" id="resetBtn">
                    <i class="fas fa-refresh"></i>
                    Reset
                </button>
                <button class="btn btn-secondary" id="helpBtn">
                    <i class="fas fa-question-circle"></i>
                    Help
                </button>
            </div>

            <div class="circos-container" id="circosContainer">
                <div class="loading" id="loadingIndicator">
                    <div class="spinner"></div>
                    <span>Initializing Circos Plot...</span>
                </div>
            </div>
        </div>

        <!-- Parameters Panel -->
        <div class="parameters-panel">
            <div class="panel-header">
                <i class="fas fa-sliders-h"></i>
                <h3>Plot Parameters</h3>
            </div>
            
            <div class="panel-content">
                <!-- Basic Settings -->
                <div class="parameter-section">
                    <div class="section-title">
                        <i class="fas fa-cog"></i>
                        Basic Settings
                    </div>
                    
                    <div class="parameter-group">
                        <label>Plot Radius</label>
                        <input type="range" class="range-input" id="radiusSlider" min="150" max="500" value="250" step="10">
                        <div class="range-value" id="radiusValue">250px</div>
                    </div>

                    <div class="parameter-group">
                        <label>Inner Radius Ratio</label>
                        <input type="range" class="range-input" id="innerRadiusSlider" min="0.1" max="0.9" value="0.8" step="0.05">
                        <div class="range-value" id="innerRadiusValue">80%</div>
                    </div>

                    <div class="parameter-group">
                        <label>Start Angle</label>
                        <input type="range" class="range-input" id="startAngleSlider" min="0" max="360" value="0" step="15">
                        <div class="range-value" id="startAngleValue">0°</div>
                    </div>
                </div>

                <!-- Chromosome Settings -->
                <div class="parameter-section">
                    <div class="section-title">
                        <i class="fas fa-dna"></i>
                        Chromosomes
                    </div>
                    
                    <div class="parameter-group">
                        <label>Chromosome Width</label>
                        <input type="range" class="range-input" id="chrWidthSlider" min="5" max="30" value="12" step="1">
                        <div class="range-value" id="chrWidthValue">12px</div>
                    </div>

                    <div class="parameter-group">
                        <label>Gap Between Chromosomes</label>
                        <input type="range" class="range-input" id="gapSlider" min="0.5" max="15" value="3" step="0.5">
                        <div class="range-value" id="gapValue">3°</div>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="showLabelsCheck" checked>
                        <label class="checkbox-label" for="showLabelsCheck">Show Labels</label>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="showTicksCheck" checked>
                        <label class="checkbox-label" for="showTicksCheck">Show Ticks</label>
                    </div>

                    <div class="parameter-group">
                        <label>Label Distance</label>
                        <input type="range" class="range-input" id="labelDistanceSlider" min="10" max="50" value="25" step="5">
                        <div class="range-value" id="labelDistanceValue">25px</div>
                    </div>
                </div>

                <!-- Color Settings -->
                <div class="parameter-section">
                    <div class="section-title">
                        <i class="fas fa-palette"></i>
                        Colors
                    </div>
                    
                    <div class="parameter-group">
                        <label>Color Theme</label>
                        <select class="parameter-input" id="themeSelect">
                            <option value="scientific">Scientific</option>
                            <option value="nature">Nature</option>
                            <option value="ocean">Ocean</option>
                            <option value="sunset">Sunset</option>
                            <option value="arctic">Arctic</option>
                            <option value="cosmic">Cosmic</option>
                            <option value="forest">Forest</option>
                            <option value="monochrome">Monochrome</option>
                        </select>
                    </div>

                    <div class="parameter-group">
                        <label>Background Color</label>
                        <input type="color" class="color-input" id="backgroundColorPicker" value="#ffffff">
                    </div>

                    <div class="parameter-group">
                        <label>Stroke Color</label>
                        <input type="color" class="color-input" id="strokeColorPicker" value="#ffffff">
                    </div>

                    <div class="parameter-group">
                        <label>Stroke Width</label>
                        <input type="range" class="range-input" id="strokeWidthSlider" min="0" max="3" value="1" step="0.5">
                        <div class="range-value" id="strokeWidthValue">1px</div>
                    </div>
                </div>

                <!-- Track Settings -->
                <div class="parameter-section">
                    <div class="section-title">
                        <i class="fas fa-layer-group"></i>
                        Tracks
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="showGenesCheck" checked>
                        <label class="checkbox-label" for="showGenesCheck">Show Genes</label>
                    </div>

                    <div class="parameter-group">
                        <label>Gene Track Height</label>
                        <input type="range" class="range-input" id="geneHeightSlider" min="3" max="20" value="8" step="1">
                        <div class="range-value" id="geneHeightValue">8px</div>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="showLinksCheck" checked>
                        <label class="checkbox-label" for="showLinksCheck">Show Links</label>
                    </div>

                    <div class="parameter-group">
                        <label>Link Opacity</label>
                        <input type="range" class="range-input" id="linkOpacitySlider" min="0.1" max="1" value="0.6" step="0.1">
                        <div class="range-value" id="linkOpacityValue">60%</div>
                    </div>

                    <div class="parameter-group">
                        <label>Max Genes to Show</label>
                        <input type="range" class="range-input" id="maxGenesSlider" min="50" max="1000" value="200" step="50">
                        <div class="range-value" id="maxGenesValue">200</div>
                    </div>

                    <div class="parameter-group">
                        <label>Max Links to Show</label>
                        <input type="range" class="range-input" id="maxLinksSlider" min="10" max="100" value="20" step="10">
                        <div class="range-value" id="maxLinksValue">20</div>
                    </div>
                </div>

                <!-- Data Tracks -->
                <div class="parameter-section">
                    <div class="section-title">
                        <i class="fas fa-chart-line"></i>
                        Data Tracks
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="showGCContentCheck">
                        <label class="checkbox-label" for="showGCContentCheck">Show GC Content</label>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="showGCSkewCheck">
                        <label class="checkbox-label" for="showGCSkewCheck">Show GC Skew</label>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="showWigDataCheck">
                        <label class="checkbox-label" for="showWigDataCheck">Show WIG Data</label>
                    </div>

                    <div class="parameter-group">
                        <label>GC Window Size</label>
                        <input type="range" class="range-input" id="gcWindowSlider" min="1000" max="50000" value="10000" step="1000">
                        <div class="range-value" id="gcWindowValue">10kb</div>
                    </div>

                    <div class="parameter-group">
                        <label>Track Height</label>
                        <input type="range" class="range-input" id="wigHeightSlider" min="10" max="60" value="30" step="5">
                        <div class="range-value" id="wigHeightValue">30px</div>
                    </div>
                </div>

                <!-- Chromosome Order -->
                <div class="parameter-section">
                    <div class="section-title">
                        <i class="fas fa-sort"></i>
                        Chromosome Order
                    </div>
                    
                    <div class="parameter-group">
                        <label>Sort Order</label>
                        <select class="parameter-input" id="chromosomeOrderSelect">
                            <option value="default">Default</option>
                            <option value="size">By Size (Large to Small)</option>
                            <option value="size_asc">By Size (Small to Large)</option>
                            <option value="name">By Name (Alphabetical)</option>
                            <option value="reverse">Reverse Default</option>
                        </select>
                    </div>

                    <div class="button-group">
                        <button class="btn btn-small btn-secondary" id="shuffleOrderBtn">
                            <i class="fas fa-random"></i>
                            Shuffle
                        </button>
                        <button class="btn btn-small btn-secondary" id="applyOrderBtn">
                            <i class="fas fa-check"></i>
                            Apply
                        </button>
                    </div>
                </div>

                <!-- Example Data -->
                <div class="parameter-section">
                    <div class="section-title">
                        <i class="fas fa-database"></i>
                        Sample Data
                    </div>
                    
                    <div class="button-group">
                        <button class="btn btn-small btn-secondary" id="loadHumanBtn">
                            <i class="fas fa-user"></i>
                            Human
                        </button>
                        <button class="btn btn-small btn-secondary" id="loadEcoliBtn">
                            <i class="fas fa-bacteria"></i>
                            E.coli
                        </button>
                    </div>

                    <div class="button-group">
                        <button class="btn btn-small btn-secondary" id="loadYeastBtn">
                            <i class="fas fa-circle"></i>
                            Yeast
                        </button>
                        <button class="btn btn-small btn-secondary" id="loadDrosaBtn">
                            <i class="fas fa-bug"></i>
                            Drosophila
                        </button>
                    </div>

                    <div class="button-group">
                        <button class="btn btn-small btn-secondary" id="loadPlantBtn">
                            <i class="fas fa-leaf"></i>
                            Plant
                        </button>
                        <button class="btn btn-small btn-secondary" id="loadVirusBtn">
                            <i class="fas fa-virus"></i>
                            Virus
                        </button>
                    </div>
                </div>

                <!-- Export Options -->
                <div class="parameter-section">
                    <div class="section-title">
                        <i class="fas fa-download"></i>
                        Export
                    </div>
                    
                    <div class="button-group">
                        <button class="btn btn-small btn-primary" id="exportSvgBtn">
                            <i class="fas fa-file-code"></i>
                            SVG
                        </button>
                        <button class="btn btn-small btn-secondary" id="exportPngBtn">
                            <i class="fas fa-file-image"></i>
                            PNG
                        </button>
                    </div>

                    <div class="parameter-group">
                        <label>Export Resolution</label>
                        <select class="parameter-input" id="exportResolutionSelect">
                            <option value="1">Standard (1x)</option>
                            <option value="2">High (2x)</option>
                            <option value="3">Very High (3x)</option>
                            <option value="4">Ultra (4x)</option>
                        </select>
                    </div>
                </div>

                <!-- Legend Settings -->
                <div class="parameter-section">
                    <div class="section-title">
                        <i class="fas fa-info-circle"></i>
                        Legend & Annotations
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="showLegendCheck" checked>
                        <label class="checkbox-label" for="showLegendCheck">Show Legend</label>
                    </div>

                    <div class="parameter-group">
                        <label>Legend Position</label>
                        <select class="parameter-input" id="legendPositionSelect">
                            <option value="top-right">Top Right</option>
                            <option value="top-left">Top Left</option>
                            <option value="bottom-right">Bottom Right</option>
                            <option value="bottom-left">Bottom Left</option>
                        </select>
                    </div>

                    <div class="parameter-group">
                        <label>Legend Opacity</label>
                        <input type="range" class="range-input" id="legendOpacitySlider" min="0.5" max="1" value="0.95" step="0.05">
                        <div class="range-value" id="legendOpacityValue">95%</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tooltip -->
    <div class="tooltip" id="tooltip"></div>

    <!-- Scripts -->
    <script src="circos-plotter.js"></script>
</body>
</html> 