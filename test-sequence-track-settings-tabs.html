<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sequence Track Settings Tabs Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            color: #333;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .test-header {
            background: #007bff;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .test-header h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 600;
        }
        
        .test-content {
            padding: 30px;
        }
        
        .demo-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .demo-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .demo-btn:hover {
            background: #218838;
        }
        
        .demo-btn.mode-btn {
            background: #6f42c1;
        }
        
        .demo-btn.mode-btn:hover {
            background: #5a2a9d;
        }
        
        .mock-settings-modal {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 0;
            margin-top: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .mock-modal-header {
            background: #007bff;
            color: white;
            padding: 15px 20px;
            border-radius: 6px 6px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .mock-modal-header h3 {
            margin: 0;
            font-size: 18px;
        }
        
        .mock-modal-body {
            padding: 20px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .status-info {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #1565c0;
        }
        
        .status-info i {
            margin-right: 8px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #495057;
            font-size: 18px;
        }
        
        .test-result {
            margin-top: 15px;
            padding: 12px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            background: #f1f3f4;
            border: 1px solid #dadce0;
        }
        
        .success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        
        .error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        /* Copy styles from TrackRenderer for the mock modal */
        .sequence-settings-tabs {
            margin-top: 10px;
        }
        
        .tab-buttons {
            display: flex;
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 20px;
        }
        
        .tab-button {
            background: #f8f9fa;
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            border-radius: 6px 6px 0 0;
            margin-right: 4px;
            color: #6c757d;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab-button:hover {
            background: #e9ecef;
            color: #495057;
        }
        
        .tab-button.active {
            background: #007bff;
            color: white;
            border-bottom: 2px solid #007bff;
        }
        
        .tab-panel {
            display: none;
        }
        
        .tab-panel.active {
            display: block;
        }
        
        .mode-indicator {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #1565c0;
        }
        
        .mode-indicator i {
            margin-right: 8px;
        }
        
        .settings-section {
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }
        
        .settings-section h4 {
            margin-top: 0;
            margin-bottom: 15px;
            color: #495057;
            font-size: 16px;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 8px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }
        
        .form-group input[type="number"],
        .form-group input[type="color"],
        .form-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-group input[type="checkbox"] {
            margin-right: 8px;
        }
        
        .help-text {
            font-size: 12px;
            color: #6c757d;
            margin-top: 4px;
        }
        
        .select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 8px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1><i class="fas fa-tabs"></i> Sequence Track Settings Tabs Test</h1>
        </div>
        
        <div class="test-content">
            <div class="status-info">
                <i class="fas fa-info-circle"></i>
                <strong>测试目标：</strong> 验证Sequence Track Settings界面的Tab化设置页，分别针对View Mode和Edit Mode提供不同的设置选项。
            </div>
            
            <div class="demo-buttons">
                <button class="demo-btn" onclick="showViewModeSettings()">
                    <i class="fas fa-eye"></i> 显示View Mode设置
                </button>
                <button class="demo-btn" onclick="showEditModeSettings()">
                    <i class="fas fa-edit"></i> 显示Edit Mode设置
                </button>
                <button class="demo-btn mode-btn" onclick="testTabSwitching()">
                    <i class="fas fa-exchange-alt"></i> 测试Tab切换
                </button>
                <button class="demo-btn mode-btn" onclick="testSettingsCollection()">
                    <i class="fas fa-save"></i> 测试设置收集
                </button>
            </div>
            
            <div class="test-section">
                <h3><i class="fas fa-cogs"></i> Sequence Track Settings 模拟界面</h3>
                <div class="mock-settings-modal">
                    <div class="mock-modal-header">
                        <h3 id="trackSettingsTitle">Sequence Track Settings</h3>
                        <button onclick="closeModal()" style="background: none; border: none; color: white; font-size: 18px; cursor: pointer;">×</button>
                    </div>
                    <div class="mock-modal-body" id="trackSettingsBody">
                        <!-- Settings content will be inserted here -->
                    </div>
                </div>
            </div>
            
            <div class="test-section">
                <h3><i class="fas fa-list-check"></i> 测试结果</h3>
                <div id="testResults">
                    <p>点击上方按钮开始测试...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mock TrackRenderer class for testing
        class MockTrackRenderer {
            constructor() {
                this.genomeBrowser = {
                    sequenceUtils: {
                        displayMode: 'view' // Default to view mode
                    }
                };
            }
            
            getCurrentSequenceViewMode() {
                try {
                    if (this.genomeBrowser && this.genomeBrowser.sequenceUtils) {
                        return this.genomeBrowser.sequenceUtils.displayMode || 'view';
                    }
                    
                    const sequenceContent = document.getElementById('sequenceContent');
                    if (sequenceContent && sequenceContent.querySelector('.vscode-sequence-editor')) {
                        return 'edit';
                    }
                    
                    return 'view';
                } catch (error) {
                    console.warn('Could not determine sequence view mode:', error);
                    return 'view';
                }
            }
            
            createViewModeSettingsContent(settings) {
                return `
                    <div class="mode-indicator">
                        <i class="fas fa-eye"></i>
                        These settings apply to the traditional sequence view mode with gene indicator bars.
                    </div>
                    
                    <div class="settings-section">
                        <h4>Gene Indicator Bar Settings</h4>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="sequenceShowIndicators" ${settings.showIndicators !== false ? 'checked' : ''}>
                                Show gene indicator bars below sequence lines
                            </label>
                            <div class="help-text">Display colored bars below each sequence line showing gene locations and types.</div>
                        </div>
                        <div class="form-group">
                            <label for="sequenceIndicatorHeight">Indicator bar height (px):</label>
                            <input type="number" id="sequenceIndicatorHeight" min="6" max="20" value="${settings.indicatorHeight || 12}">
                            <div class="help-text">Height of the gene indicator bars below sequence lines.</div>
                        </div>
                        <div class="form-group">
                            <label for="sequenceIndicatorOpacity">Indicator opacity (0-1):</label>
                            <input type="number" id="sequenceIndicatorOpacity" min="0.3" max="1" step="0.1" value="${settings.indicatorOpacity || 0.7}">
                            <div class="help-text">Transparency level of gene indicator bars.</div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h4>Gene Type Filters</h4>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="sequenceShowCDS" ${settings.showCDS !== false ? 'checked' : ''}>
                                Show CDS genes
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="sequenceShowRNA" ${settings.showRNA !== false ? 'checked' : ''}>
                                Show RNA genes (tRNA, rRNA, mRNA)
                            </label>
                        </div>
                    </div>
                `;
            }
            
            createEditModeSettingsContent(settings) {
                return `
                    <div class="mode-indicator">
                        <i class="fas fa-edit"></i>
                        VS Code-style editor for advanced sequence editing and analysis with local modification support.
                    </div>
                    
                    <div class="settings-section">
                        <h4>Editor Layout</h4>
                        <div class="form-group">
                            <label for="editorFontSize">Font size (px):</label>
                            <input type="number" id="editorFontSize" min="10" max="24" value="${settings.editorFontSize || 14}">
                            <div class="help-text">Size of the text in the sequence editor.</div>
                        </div>
                        <div class="form-group">
                            <label for="editorFontFamily">Font family:</label>
                            <select id="editorFontFamily" class="select">
                                <option value="'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace" ${(settings.editorFontFamily || '').includes('SF Mono') ? 'selected' : ''}>SF Mono (Default)</option>
                                <option value="'Courier New', monospace" ${(settings.editorFontFamily || '').includes('Courier New') ? 'selected' : ''}>Courier New</option>
                                <option value="'Consolas', monospace" ${(settings.editorFontFamily || '').includes('Consolas') ? 'selected' : ''}>Consolas</option>
                                <option value="'Menlo', monospace" ${(settings.editorFontFamily || '').includes('Menlo') ? 'selected' : ''}>Menlo</option>
                                <option value="'Source Code Pro', monospace" ${(settings.editorFontFamily || '').includes('Source Code Pro') ? 'selected' : ''}>Source Code Pro</option>
                            </select>
                            <div class="help-text">Monospace font family for consistent character spacing.</div>
                        </div>
                        <div class="form-group">
                            <label for="editorBasesPerLine">Bases per line:</label>
                            <input type="number" id="editorBasesPerLine" min="40" max="120" value="${settings.editorBasesPerLine || 80}">
                            <div class="help-text">Number of DNA bases displayed per line for optimal viewing.</div>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="editorEnableEditing" ${settings.editorEnableEditing !== false ? 'checked' : ''}>
                                Enable local sequence editing
                            </label>
                            <div class="help-text">Allow direct editing of DNA sequence in the editor.</div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h4>Gene-Based Coloring</h4>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="editorUseGeneColors" ${settings.editorUseGeneColors === true ? 'checked' : ''}>
                                Use gene colors for DNA bases
                            </label>
                            <div class="help-text">Color DNA bases according to the gene they belong to instead of nucleotide type.</div>
                        </div>
                        <div class="form-group">
                            <label for="editorGeneColorCDS">CDS gene color:</label>
                            <input type="color" id="editorGeneColorCDS" value="${settings.editorGeneColorCDS || '#4CAF50'}">
                            <div class="help-text">Color for bases within CDS genes.</div>
                        </div>
                        <div class="form-group">
                            <label for="editorGeneColorRNA">RNA gene color:</label>
                            <input type="color" id="editorGeneColorRNA" value="${settings.editorGeneColorRNA || '#2196F3'}">
                            <div class="help-text">Color for bases within RNA genes (tRNA, rRNA, mRNA).</div>
                        </div>
                        <div class="form-group">
                            <label for="editorGeneColorPromoter">Promoter color:</label>
                            <input type="color" id="editorGeneColorPromoter" value="${settings.editorGeneColorPromoter || '#FF9800'}">
                            <div class="help-text">Color for bases within promoter regions.</div>
                        </div>
                        <div class="form-group">
                            <label for="editorGeneColorIntergenic">Intergenic color:</label>
                            <input type="color" id="editorGeneColorIntergenic" value="${settings.editorGeneColorIntergenic || '#9E9E9E'}">
                            <div class="help-text">Color for bases in intergenic regions (between genes).</div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h4>DNA Base Colors</h4>
                        <div class="form-group">
                            <label for="editorBaseColorA">Adenine (A) color:</label>
                            <input type="color" id="editorBaseColorA" value="${settings.editorBaseColorA || '#f92672'}">
                            <div class="help-text">Color for adenine nucleotides.</div>
                        </div>
                        <div class="form-group">
                            <label for="editorBaseColorT">Thymine (T) color:</label>
                            <input type="color" id="editorBaseColorT" value="${settings.editorBaseColorT || '#66d9ef'}">
                            <div class="help-text">Color for thymine nucleotides.</div>
                        </div>
                        <div class="form-group">
                            <label for="editorBaseColorG">Guanine (G) color:</label>
                            <input type="color" id="editorBaseColorG" value="${settings.editorBaseColorG || '#a6e22e'}">
                            <div class="help-text">Color for guanine nucleotides.</div>
                        </div>
                        <div class="form-group">
                            <label for="editorBaseColorC">Cytosine (C) color:</label>
                            <input type="color" id="editorBaseColorC" value="${settings.editorBaseColorC || '#fd971f'}">
                            <div class="help-text">Color for cytosine nucleotides.</div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h4>Editing Features</h4>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="editorAutoValidate" ${settings.editorAutoValidate !== false ? 'checked' : ''}>
                                Auto-validate nucleotides
                            </label>
                            <div class="help-text">Automatically validate entered nucleotides (A, T, G, C, N only).</div>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="editorShowModifications" ${settings.editorShowModifications !== false ? 'checked' : ''}>
                                Highlight modifications
                            </label>
                            <div class="help-text">Highlight bases that have been modified from the original sequence.</div>
                        </div>
                        <div class="form-group">
                            <label for="editorModificationColor">Modification highlight color:</label>
                            <input type="color" id="editorModificationColor" value="${settings.editorModificationColor || '#FFC107'}">
                            <div class="help-text">Background color for modified bases.</div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h4>Analysis Tools</h4>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="editorShowGCContent" ${settings.editorShowGCContent === true ? 'checked' : ''}>
                                Show GC content per line
                            </label>
                            <div class="help-text">Display GC percentage for each line in the gutter.</div>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="editorHighlightPalindrome" ${settings.editorHighlightPalindrome === true ? 'checked' : ''}>
                                Highlight palindromes
                            </label>
                            <div class="help-text">Automatically detect and highlight palindromic sequences.</div>
                        </div>
                        <div class="form-group">
                            <label for="editorMinPalindromeLength">Min palindrome length:</label>
                            <input type="number" id="editorMinPalindromeLength" min="4" max="20" value="${settings.editorMinPalindromeLength || 6}">
                            <div class="help-text">Minimum length for palindrome detection.</div>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="editorShowFeatureBackgrounds" ${settings.editorShowFeatureBackgrounds === true ? 'checked' : ''}>
                                Show gene backgrounds
                            </label>
                            <div class="help-text">Highlight gene regions with subtle background colors.</div>
                        </div>
                    </div>
                `;
            }
            
            createSequenceSettingsContent(settings) {
                const currentViewMode = this.getCurrentSequenceViewMode();
                
                return `
                    <div class="sequence-settings-tabs">
                        <div class="tab-buttons">
                            <button class="tab-button ${currentViewMode === 'view' ? 'active' : ''}" data-tab="view-mode">
                                <i class="fas fa-eye"></i> View Mode Settings
                            </button>
                            <button class="tab-button ${currentViewMode === 'edit' ? 'active' : ''}" data-tab="edit-mode">
                                <i class="fas fa-edit"></i> Edit Mode Settings
                            </button>
                        </div>
                        
                        <div class="tab-content">
                            <div id="view-mode-tab" class="tab-panel ${currentViewMode === 'view' ? 'active' : ''}">
                                ${this.createViewModeSettingsContent(settings)}
                            </div>
                            
                            <div id="edit-mode-tab" class="tab-panel ${currentViewMode === 'edit' ? 'active' : ''}">
                                ${this.createEditModeSettingsContent(settings)}
                            </div>
                        </div>
                    </div>
                `;
            }
        }
        
        // Global variables
        let mockRenderer = new MockTrackRenderer();
        let testResults = [];
        
        function addTestResult(testName, success, message) {
            testResults.push({ testName, success, message, timestamp: new Date() });
            updateTestResultsDisplay();
        }
        
        function updateTestResultsDisplay() {
            const resultsContainer = document.getElementById('testResults');
            if (testResults.length === 0) {
                resultsContainer.innerHTML = '<p>点击上方按钮开始测试...</p>';
                return;
            }
            
            let html = '';
            testResults.forEach((result, index) => {
                const resultClass = result.success ? 'success' : 'error';
                const icon = result.success ? 'fa-check-circle' : 'fa-times-circle';
                html += `
                    <div class="test-result ${resultClass}">
                        <i class="fas ${icon}"></i> <strong>${result.testName}</strong><br>
                        ${result.message}<br>
                        <small>时间: ${result.timestamp.toLocaleTimeString()}</small>
                    </div>
                `;
            });
            resultsContainer.innerHTML = html;
        }
        
        function setupTabSwitching() {
            setTimeout(() => {
                const tabButtons = document.querySelectorAll('.tab-button');
                const tabPanels = document.querySelectorAll('.tab-panel');
                
                tabButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const targetTab = button.getAttribute('data-tab');
                        
                        // Remove active class from all buttons and panels
                        tabButtons.forEach(btn => btn.classList.remove('active'));
                        tabPanels.forEach(panel => panel.classList.remove('active'));
                        
                        // Add active class to clicked button
                        button.classList.add('active');
                        
                        // Show corresponding panel
                        const targetPanel = document.getElementById(targetTab + '-tab');
                        if (targetPanel) {
                            targetPanel.classList.add('active');
                        }
                        
                        addTestResult('Tab切换', true, `成功切换到 ${targetTab} 标签页`);
                    });
                });
            }, 100);
        }
        
        function showViewModeSettings() {
            mockRenderer.genomeBrowser.sequenceUtils.displayMode = 'view';
            const settings = {
                showIndicators: true,
                indicatorHeight: 12,
                indicatorOpacity: 0.7,
                showCDS: true,
                showRNA: true
            };
            
            const content = mockRenderer.createSequenceSettingsContent(settings);
            document.getElementById('trackSettingsBody').innerHTML = content;
            setupTabSwitching();
            
            addTestResult('View Mode设置', true, '成功生成View Mode设置界面，包含基因指示器、标记和类型过滤器设置');
        }
        
        function showEditModeSettings() {
            mockRenderer.genomeBrowser.sequenceUtils.displayMode = 'edit';
            const settings = {
                // Editor Layout
                editorFontSize: 14,
                editorFontFamily: "'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace",
                editorBasesPerLine: 80,
                editorEnableEditing: true,
                
                // Gene-Based Coloring
                editorUseGeneColors: true,
                editorGeneColorCDS: '#4CAF50',
                editorGeneColorRNA: '#2196F3',
                editorGeneColorPromoter: '#FF9800',
                editorGeneColorIntergenic: '#9E9E9E',
                
                // DNA Base Colors
                editorBaseColorA: '#f92672',
                editorBaseColorT: '#66d9ef',
                editorBaseColorG: '#a6e22e',
                editorBaseColorC: '#fd971f',
                
                // Editing Features
                editorAutoValidate: true,
                editorShowModifications: true,
                editorModificationColor: '#FFC107',
                
                // Analysis Tools
                editorShowGCContent: true,
                editorHighlightPalindrome: true,
                editorMinPalindromeLength: 6,
                editorShowFeatureBackgrounds: true
            };
            
            const content = mockRenderer.createSequenceSettingsContent(settings);
            document.getElementById('trackSettingsBody').innerHTML = content;
            setupTabSwitching();
            
            addTestResult('Edit Mode设置', true, '成功生成完整的Edit Mode设置界面，包含基因颜色映射、序列编辑和分析工具等高级功能');
        }
        
        function testTabSwitching() {
            // First show view mode
            showViewModeSettings();
            
            setTimeout(() => {
                const viewTab = document.querySelector('[data-tab="view-mode"]');
                const editTab = document.querySelector('[data-tab="edit-mode"]');
                const viewPanel = document.getElementById('view-mode-tab');
                const editPanel = document.getElementById('edit-mode-tab');
                
                if (viewTab && editTab && viewPanel && editPanel) {
                    // Test switching to edit mode
                    editTab.click();
                    
                    setTimeout(() => {
                        if (editPanel.classList.contains('active') && !viewPanel.classList.contains('active')) {
                            addTestResult('Tab切换功能', true, '成功测试Tab切换：View Mode → Edit Mode');
                            
                            // Test switching back to view mode
                            viewTab.click();
                            
                            setTimeout(() => {
                                if (viewPanel.classList.contains('active') && !editPanel.classList.contains('active')) {
                                    addTestResult('Tab切换功能', true, '成功测试Tab切换：Edit Mode → View Mode');
                                } else {
                                    addTestResult('Tab切换功能', false, '切换回View Mode失败');
                                }
                            }, 200);
                        } else {
                            addTestResult('Tab切换功能', false, '切换到Edit Mode失败');
                        }
                    }, 200);
                } else {
                    addTestResult('Tab切换功能', false, '无法找到Tab按钮或面板元素');
                }
            }, 300);
        }
        
        function testSettingsCollection() {
            // Create settings with both View and Edit mode settings
            showViewModeSettings();
            
            setTimeout(() => {
                // Simulate changing some values
                const indicatorHeight = document.getElementById('sequenceIndicatorHeight');
                const showCDS = document.getElementById('sequenceShowCDS');
                
                if (indicatorHeight && showCDS) {
                    indicatorHeight.value = '15';
                    showCDS.checked = false;
                    
                    // Switch to edit mode tab
                    const editTab = document.querySelector('[data-tab="edit-mode"]');
                    editTab.click();
                    
                    setTimeout(() => {
                        const editorFontSize = document.getElementById('editorFontSize');
                        const editorBaseColorA = document.getElementById('editorBaseColorA');
                        
                        if (editorFontSize && editorBaseColorA) {
                            editorFontSize.value = '16';
                            editorBaseColorA.value = '#ff0000';
                            
                            // Test settings collection
                            const mockModal = document.querySelector('.mock-settings-modal');
                            const settings = collectSettingsFromModal('sequence', mockModal);
                            
                            const expectedSettings = {
                                indicatorHeight: 15,
                                showCDS: false,
                                editorFontSize: 16,
                                editorBaseColorA: '#ff0000'
                            };
                            
                            let success = true;
                            let message = '成功收集设置：';
                            
                            Object.keys(expectedSettings).forEach(key => {
                                if (settings[key] !== expectedSettings[key]) {
                                    success = false;
                                    message += ` ${key}值不匹配;`;
                                } else {
                                    message += ` ${key}=${settings[key]};`;
                                }
                            });
                            
                            addTestResult('设置收集测试', success, message);
                        } else {
                            addTestResult('设置收集测试', false, '无法找到Edit Mode设置元素');
                        }
                    }, 200);
                } else {
                    addTestResult('设置收集测试', false, '无法找到View Mode设置元素');
                }
            }, 300);
        }
        
        function collectSettingsFromModal(trackType, modal) {
            const settings = {};
            
            if (trackType === 'sequence') {
                // View Mode settings
                const showIndicatorsEl = modal.querySelector('#sequenceShowIndicators');
                if (showIndicatorsEl) settings.showIndicators = showIndicatorsEl.checked;
                
                const indicatorHeightEl = modal.querySelector('#sequenceIndicatorHeight');
                if (indicatorHeightEl) settings.indicatorHeight = parseInt(indicatorHeightEl.value) || 12;
                
                const showCDSEl = modal.querySelector('#sequenceShowCDS');
                if (showCDSEl) settings.showCDS = showCDSEl.checked;
                
                // Edit Mode settings
                const editorFontSizeEl = modal.querySelector('#editorFontSize');
                if (editorFontSizeEl) settings.editorFontSize = parseInt(editorFontSizeEl.value) || 14;
                
                const editorBaseColorAEl = modal.querySelector('#editorBaseColorA');
                if (editorBaseColorAEl) settings.editorBaseColorA = editorBaseColorAEl.value;
            }
            
            return settings;
        }
        
        function closeModal() {
            addTestResult('模态框关闭', true, '用户点击关闭按钮');
        }
        
        // Initialize with View Mode
        showViewModeSettings();
    </script>
</body>
</html> 