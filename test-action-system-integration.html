<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Action System Integration Test</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 20px;
            background: #f8fafc;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #2563eb; }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #f1f5f9;
            border-radius: 6px;
        }
        .btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover { background: #2563eb; }
        .output {
            background: #1e293b;
            color: #e2e8f0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .status {
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
        }
        .success { background: #10b981; color: white; }
        .error { background: #ef4444; color: white; }
        .warning { background: #f59e0b; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß¨ Action System Integration Test</h1>
        <p>This test verifies the integration of the Action Management System with Genome AI Studio.</p>
        
        <div class="test-section">
            <h3>System Status</h3>
            <div id="systemStatus" class="output">Loading...</div>
        </div>
        
        <div class="test-section">
            <h3>Action Menu Test</h3>
            <p>Test the Action menu functionality from the main interface:</p>
            <button class="btn" onclick="testActionMenuIntegration()">Test Action Menu</button>
            <button class="btn" onclick="testSequenceOperations()">Test Sequence Ops</button>
            <div id="actionTest" class="output"></div>
        </div>
        
        <div class="test-section">
            <h3>Quick Integration Test</h3>
            <button class="btn" onclick="runQuickTest()">Run Quick Test</button>
            <button class="btn" onclick="clearOutput()">Clear Output</button>
            <div id="quickTest" class="output"></div>
        </div>
        
        <div class="test-section">
            <h3>Integration Results</h3>
            <div id="results" class="output">No tests run yet.</div>
        </div>
    </div>

    <script>
        let testOutput = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = `[${timestamp}] ${message}`;
            testOutput.push(entry);
            console.log(entry);
            updateAllOutputs();
        }
        
        function updateAllOutputs() {
            const content = testOutput.join('\n');
            document.getElementById('systemStatus').textContent = content;
            document.getElementById('actionTest').textContent = content;
            document.getElementById('quickTest').textContent = content;
        }
        
        function clearOutput() {
            testOutput = [];
            updateAllOutputs();
            document.getElementById('results').textContent = 'Output cleared.';
        }
        
        function testActionMenuIntegration() {
            log('üß™ Testing Action Menu Integration...');
            
            // Check if Action button exists in DOM
            const actionBtn = document.getElementById('actionBtn');
            if (actionBtn) {
                log('‚úÖ Action button found in DOM');
            } else {
                log('‚ùå Action button NOT found - integration incomplete');
                return;
            }
            
            // Check if Action dropdown exists
            const dropdown = document.getElementById('actionDropdownMenu');
            if (dropdown) {
                log('‚úÖ Action dropdown menu found');
                
                // Count menu items
                const menuItems = dropdown.querySelectorAll('.dropdown-item');
                log(`‚úÖ Found ${menuItems.length} menu items`);
                
                // List menu items
                menuItems.forEach((item, index) => {
                    const text = item.textContent.trim();
                    log(`   ${index + 1}. ${text}`);
                });
                
            } else {
                log('‚ùå Action dropdown menu NOT found');
            }
            
            // Check for modals
            const actionModal = document.getElementById('actionListModal');
            const sequenceModal = document.getElementById('sequenceSelectionModal');
            
            if (actionModal) {
                log('‚úÖ Action List modal found');
            } else {
                log('‚ùå Action List modal NOT found');
            }
            
            if (sequenceModal) {
                log('‚úÖ Sequence Selection modal found');
            } else {
                log('‚ùå Sequence Selection modal NOT found');
            }
            
            updateResults('Action Menu Integration', 
                actionBtn && dropdown && actionModal && sequenceModal);
        }
        
        function testSequenceOperations() {
            log('üß™ Testing Sequence Operations...');
            
            // Check if ActionManager is available
            if (typeof ActionManager !== 'undefined') {
                log('‚úÖ ActionManager class available');
            } else {
                log('‚ùå ActionManager class NOT available');
                return;
            }
            
            if (typeof CheckpointManager !== 'undefined') {
                log('‚úÖ CheckpointManager class available');
            } else {
                log('‚ùå CheckpointManager class NOT available');
                return;
            }
            
            // Check global instances
            if (window.actionManager) {
                log('‚úÖ Global actionManager instance found');
                
                // Test basic functionality
                try {
                    const testAction = window.actionManager.addAction(
                        'copy_sequence',
                        'test:1-100',
                        'Test copy operation',
                        { test: true }
                    );
                    log(`‚úÖ Successfully added test action (ID: ${testAction})`);
                    
                    const actionCount = window.actionManager.actions.length;
                    log(`‚úÖ Current action count: ${actionCount}`);
                    
                } catch (error) {
                    log(`‚ùå Error testing ActionManager: ${error.message}`);
                }
            } else {
                log('‚ùå Global actionManager instance NOT found');
            }
            
            if (window.checkpointManager) {
                log('‚úÖ Global checkpointManager instance found');
                
                try {
                    const checkpointId = window.checkpointManager.createCheckpoint('Test Checkpoint');
                    log(`‚úÖ Successfully created test checkpoint`);
                    
                } catch (error) {
                    log(`‚ùå Error testing CheckpointManager: ${error.message}`);
                }
            } else {
                log('‚ùå Global checkpointManager instance NOT found');
            }
            
            updateResults('Sequence Operations', 
                window.actionManager && window.checkpointManager);
        }
        
        function runQuickTest() {
            log('üöÄ Running Quick Integration Test...');
            
            let score = 0;
            let maxScore = 6;
            
            // Test 1: DOM Elements
            if (document.getElementById('actionBtn')) {
                log('‚úÖ Test 1/6: Action button exists');
                score++;
            } else {
                log('‚ùå Test 1/6: Action button missing');
            }
            
            // Test 2: CSS Styles
            const styles = getComputedStyle(document.body);
            if (document.querySelector('style') || document.querySelector('link[href*="styles.css"]')) {
                log('‚úÖ Test 2/6: CSS styles loaded');
                score++;
            } else {
                log('‚ùå Test 2/6: CSS styles not found');
            }
            
            // Test 3: JavaScript Classes
            if (typeof ActionManager !== 'undefined') {
                log('‚úÖ Test 3/6: ActionManager class available');
                score++;
            } else {
                log('‚ùå Test 3/6: ActionManager class missing');
            }
            
            // Test 4: JavaScript Classes
            if (typeof CheckpointManager !== 'undefined') {
                log('‚úÖ Test 4/6: CheckpointManager class available');
                score++;
            } else {
                log('‚ùå Test 4/6: CheckpointManager class missing');
            }
            
            // Test 5: Global instances
            if (window.actionManager) {
                log('‚úÖ Test 5/6: ActionManager instance created');
                score++;
            } else {
                log('‚ùå Test 5/6: ActionManager instance missing');
            }
            
            // Test 6: Modal elements
            if (document.getElementById('actionListModal')) {
                log('‚úÖ Test 6/6: Action modals present');
                score++;
            } else {
                log('‚ùå Test 6/6: Action modals missing');
            }
            
            const percentage = Math.round((score / maxScore) * 100);
            log(`\nüìä Integration Test Score: ${score}/${maxScore} (${percentage}%)`);
            
            if (score === maxScore) {
                log('üéâ All tests passed! Action System fully integrated.');
            } else if (score >= maxScore * 0.7) {
                log('‚ö†Ô∏è Most tests passed. Minor integration issues detected.');
            } else {
                log('‚ùå Integration incomplete. Please check the implementation.');
            }
            
            updateResults('Quick Integration Test', score >= maxScore * 0.7, 
                `${score}/${maxScore} tests passed (${percentage}%)`);
        }
        
        function updateResults(testName, passed, details = '') {
            const resultsDiv = document.getElementById('results');
            const status = passed ? 
                '<span class="status success">PASS</span>' : 
                '<span class="status error">FAIL</span>';
            
            resultsDiv.innerHTML += `
                <div style="margin: 5px 0;">
                    ${status} ${testName} ${details}
                </div>
            `;
        }
        
        // Auto-run basic checks on page load
        document.addEventListener('DOMContentLoaded', function() {
            log('üîÑ Page loaded, starting integration check...');
            
            // Give time for scripts to load
            setTimeout(() => {
                log('üîç Checking system integration...');
                
                // Check if we're running in the actual Genome AI Studio context
                if (window.genomeBrowser || window.genomeApp) {
                    log('‚úÖ Running in Genome AI Studio context');
                } else {
                    log('‚ö†Ô∏è Running in standalone mode (expected for this test)');
                }
                
                // Check script loading
                const scripts = Array.from(document.getElementsByTagName('script'));
                const actionScript = scripts.find(s => s.src.includes('ActionManager.js'));
                const checkpointScript = scripts.find(s => s.src.includes('CheckpointManager.js'));
                
                if (actionScript || typeof ActionManager !== 'undefined') {
                    log('‚úÖ ActionManager script loaded');
                } else {
                    log('‚ùå ActionManager script not loaded');
                }
                
                if (checkpointScript || typeof CheckpointManager !== 'undefined') {
                    log('‚úÖ CheckpointManager script loaded');
                } else {
                    log('‚ùå CheckpointManager script not loaded');
                }
                
                log('‚úÖ Integration check complete. Use buttons above for detailed tests.');
                
            }, 1000);
        });
    </script>
</body>
</html> 