<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ’ä»¶è‡ªåŠ¨å¼€å‘ç³»ç»Ÿæµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .test-header {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 15px;
            margin-bottom: 25px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        
        .test-section h3 {
            color: #34495e;
            margin-top: 0;
        }
        
        .test-controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .test-button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .test-button.primary {
            background-color: #3498db;
            color: white;
        }
        
        .test-button.primary:hover {
            background-color: #2980b9;
        }
        
        .test-button.success {
            background-color: #27ae60;
            color: white;
        }
        
        .test-button.success:hover {
            background-color: #229954;
        }
        
        .test-button.warning {
            background-color: #f39c12;
            color: white;
        }
        
        .test-button.warning:hover {
            background-color: #e67e22;
        }
        
        .test-button.danger {
            background-color: #e74c3c;
            color: white;
        }
        
        .test-button.danger:hover {
            background-color: #c0392b;
        }
        
        .test-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            font-size: 14px;
            margin: 10px 0;
        }
        
        .test-textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            resize: vertical;
        }
        
        .test-output {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .status-indicator {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .status-success {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .status-warning {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-info {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background-color: #28a745;
            transition: width 0.3s ease;
            text-align: center;
            color: white;
            font-size: 12px;
            line-height: 20px;
        }
        
        .code-preview {
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #3498db;
        }
        
        .stat-label {
            font-size: 14px;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ğŸ”§ æ’ä»¶è‡ªåŠ¨å¼€å‘ç³»ç»Ÿæµ‹è¯•</h1>
            <p>æµ‹è¯•GenomeExplorerçš„æ’ä»¶è‡ªåŠ¨å¼€å‘åŠŸèƒ½ï¼ŒåŒ…æ‹¬éœ€æ±‚åˆ†æã€ä»£ç ç”Ÿæˆã€è°ƒè¯•æµ‹è¯•å’Œè‡ªåŠ¨å®‰è£…</p>
        </div>

        <!-- ç³»ç»ŸçŠ¶æ€ -->
        <div class="test-section">
            <h3>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h3>
            <div class="stats-grid" id="systemStats">
                <div class="stat-card">
                    <div class="stat-value" id="activeProjects">0</div>
                    <div class="stat-label">æ´»è·ƒé¡¹ç›®</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalProjects">0</div>
                    <div class="stat-label">æ€»é¡¹ç›®æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="successRate">0%</div>
                    <div class="stat-label">æˆåŠŸç‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgTime">0s</div>
                    <div class="stat-label">å¹³å‡å¼€å‘æ—¶é—´</div>
                </div>
            </div>
            <div class="test-controls">
                <button class="test-button primary" onclick="refreshSystemStatus()">åˆ·æ–°çŠ¶æ€</button>
                <button class="test-button success" onclick="initializeSystem()">åˆå§‹åŒ–ç³»ç»Ÿ</button>
                <button class="test-button danger" onclick="resetSystem()">é‡ç½®ç³»ç»Ÿ</button>
            </div>
        </div>

        <!-- æ’ä»¶å¼€å‘æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸš€ æ’ä»¶å¼€å‘æµ‹è¯•</h3>
            <label for="requirementInput">æ’ä»¶å¼€å‘éœ€æ±‚ï¼š</label>
            <textarea 
                id="requirementInput" 
                class="test-textarea" 
                placeholder="è¯·æè¿°ä½ æƒ³è¦å¼€å‘çš„æ’ä»¶åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š&#10;- åˆ›å»ºä¸€ä¸ªåŸºå› åºåˆ—GCå«é‡åˆ†ææ’ä»¶&#10;- å¼€å‘ä¸€ä¸ªè›‹ç™½è´¨ç»“æ„å¯è§†åŒ–å·¥å…·&#10;- åˆ¶ä½œä¸€ä¸ªç³»ç»Ÿå‘è‚²æ ‘æ„å»ºæ’ä»¶">åˆ›å»ºä¸€ä¸ªåŸºå› åºåˆ—GCå«é‡åˆ†ææ’ä»¶ï¼Œèƒ½å¤Ÿåˆ†æDNAåºåˆ—çš„GCå«é‡åˆ†å¸ƒï¼Œç”Ÿæˆç»Ÿè®¡å›¾è¡¨ï¼Œå¹¶æ”¯æŒæ‰¹é‡å¤„ç†å¤šä¸ªåºåˆ—æ–‡ä»¶ã€‚</textarea>
            
            <label for="developmentMode">å¼€å‘æ¨¡å¼ï¼š</label>
            <select id="developmentMode" class="test-input">
                <option value="interactive">äº¤äº’å¼å¼€å‘</option>
                <option value="automatic">è‡ªåŠ¨å¼€å‘</option>
            </select>
            
            <div class="test-controls">
                <button class="test-button primary" onclick="startPluginDevelopment()">å¼€å§‹å¼€å‘</button>
                <button class="test-button warning" onclick="testRequirementAnalysis()">ä»…æµ‹è¯•éœ€æ±‚åˆ†æ</button>
                <button class="test-button success" onclick="simulateDevelopment()">æ¨¡æ‹Ÿå¼€å‘æµç¨‹</button>
            </div>
            
            <div id="developmentProgress" style="display: none;">
                <h4>å¼€å‘è¿›åº¦ï¼š</h4>
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill" style="width: 0%;">0%</div>
                </div>
                <div id="currentPhase" class="status-info status-indicator">å‡†å¤‡ä¸­...</div>
            </div>
        </div>

        <!-- ç»„ä»¶æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ”§ ç»„ä»¶æµ‹è¯•</h3>
            <div class="test-controls">
                <button class="test-button primary" onclick="testRequirementAnalyzer()">æµ‹è¯•éœ€æ±‚åˆ†æå™¨</button>
                <button class="test-button primary" onclick="testCodeGenerator()">æµ‹è¯•ä»£ç ç”Ÿæˆå™¨</button>
                <button class="test-button primary" onclick="testDebugTools()">æµ‹è¯•è°ƒè¯•å·¥å…·</button>
                <button class="test-button primary" onclick="testInstallationManager()">æµ‹è¯•å®‰è£…ç®¡ç†å™¨</button>
                <button class="test-button primary" onclick="testChatBoxIntegration()">æµ‹è¯•ChatBoxé›†æˆ</button>
            </div>
        </div>

        <!-- ChatBoxé›†æˆæµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ’¬ ChatBoxé›†æˆæµ‹è¯•</h3>
            <label for="chatMessage">æ¨¡æ‹ŸChatBoxæ¶ˆæ¯ï¼š</label>
            <textarea 
                id="chatMessage" 
                class="test-textarea" 
                placeholder="è¾“å…¥æ¨¡æ‹Ÿçš„ChatBoxæ¶ˆæ¯ï¼Œæµ‹è¯•è‡ªåŠ¨æ£€æµ‹æ’ä»¶å¼€å‘éœ€æ±‚">æˆ‘éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿåˆ†æè›‹ç™½è´¨åºåˆ—çš„æ’ä»¶ï¼Œå¯ä»¥é¢„æµ‹è›‹ç™½è´¨çš„äºŒçº§ç»“æ„</textarea>
            
            <div class="test-controls">
                <button class="test-button primary" onclick="testChatDetection()">æµ‹è¯•æ„å›¾æ£€æµ‹</button>
                <button class="test-button success" onclick="simulateChatDevelopment()">æ¨¡æ‹ŸChatå¼€å‘</button>
                <button class="test-button warning" onclick="testInteractiveFlow()">æµ‹è¯•äº¤äº’æµç¨‹</button>
            </div>
        </div>

        <!-- ä»£ç é¢„è§ˆ -->
        <div class="test-section">
            <h3>ğŸ’» ç”Ÿæˆä»£ç é¢„è§ˆ</h3>
            <div class="test-controls">
                <button class="test-button primary" onclick="previewMainCode()">é¢„è§ˆä¸»ä»£ç </button>
                <button class="test-button primary" onclick="previewManifest()">é¢„è§ˆManifest</button>
                <button class="test-button primary" onclick="previewTests()">é¢„è§ˆæµ‹è¯•ä»£ç </button>
                <button class="test-button primary" onclick="previewDocs()">é¢„è§ˆæ–‡æ¡£</button>
            </div>
            <div id="codePreview" class="code-preview" style="display: none;"></div>
        </div>

        <!-- æµ‹è¯•è¾“å‡º -->
        <div class="test-section">
            <h3>ğŸ“‹ æµ‹è¯•è¾“å‡º</h3>
            <div class="test-controls">
                <button class="test-button warning" onclick="clearOutput()">æ¸…ç©ºè¾“å‡º</button>
                <button class="test-button success" onclick="exportTestResults()">å¯¼å‡ºç»“æœ</button>
            </div>
            <div id="testOutput" class="test-output"></div>
        </div>
    </div>

    <!-- åŠ è½½å¿…è¦çš„æ¨¡å— -->
    <script src="../src/renderer/modules/PluginAutoDeveloper.js"></script>
    <script src="../src/renderer/modules/PluginRequirementAnalyzer.js"></script>
    <script src="../src/renderer/modules/EnhancedPluginCodeGenerator.js"></script>
    <script src="../src/renderer/modules/PluginDebugTools.js"></script>
    <script src="../src/renderer/modules/PluginInstallationManager.js"></script>
    <script src="../src/renderer/modules/PluginDevelopmentChatBoxIntegration.js"></script>

    <script>
        // å…¨å±€å˜é‡
        let pluginAutoDeveloper = null;
        let currentProject = null;
        let testResults = [];

        // æ¨¡æ‹ŸAppå¯¹è±¡
        const mockApp = {
            llmConfigManager: {
                isConfigured: () => Math.random() > 0.5, // éšæœºæ¨¡æ‹ŸLLMæ˜¯å¦é…ç½®
                sendMessageWithHistory: async (messages) => {
                    // æ¨¡æ‹ŸLLMå“åº”
                    const responses = {
                        analysis: 'è¿™æ˜¯ä¸€ä¸ªåŸºå› åºåˆ—åˆ†æéœ€æ±‚ï¼Œéœ€è¦å®ç°GCå«é‡è®¡ç®—åŠŸèƒ½ã€‚',
                        code: 'class GCAnalysisPlugin { constructor() { this.name = "GC Analysis Plugin"; } }',
                        enhancement: 'ä¼˜åŒ–åçš„ä»£ç åŒ…å«æ›´å¥½çš„é”™è¯¯å¤„ç†å’Œæ€§èƒ½ä¼˜åŒ–ã€‚'
                    };
                    const keys = Object.keys(responses);
                    return responses[keys[Math.floor(Math.random() * keys.length)]];
                }
            },
            pluginManagerV2: {
                getPlugin: (id) => null,
                registerPlugin: async (id, definition) => {
                    logOutput(`æ’ä»¶ ${id} å·²æ³¨å†Œ`, 'success');
                    return true;
                }
            },
            configManager: {},
            chatManager: {
                registerFunction: async (func) => {
                    logOutput(`ChatBoxå‡½æ•° ${func.name} å·²æ³¨å†Œ`, 'info');
                },
                addSystemMessage: async (message) => {
                    logOutput(`ChatBoxæ¶ˆæ¯: ${message.content}`, 'info');
                },
                on: (event, handler) => {
                    logOutput(`ç›‘å¬ChatBoxäº‹ä»¶: ${event}`, 'info');
                }
            }
        };

        // åˆå§‹åŒ–ç³»ç»Ÿ
        async function initializeSystem() {
            try {
                logOutput('æ­£åœ¨åˆå§‹åŒ–æ’ä»¶è‡ªåŠ¨å¼€å‘ç³»ç»Ÿ...', 'info');
                
                pluginAutoDeveloper = new PluginAutoDeveloper(mockApp, {
                    debugMode: true,
                    enableLLMEnhancement: true
                });
                
                await pluginAutoDeveloper.initialize();
                
                logOutput('âœ… æ’ä»¶è‡ªåŠ¨å¼€å‘ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ', 'success');
                refreshSystemStatus();
                
            } catch (error) {
                logOutput(`âŒ ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // åˆ·æ–°ç³»ç»ŸçŠ¶æ€
        function refreshSystemStatus() {
            if (!pluginAutoDeveloper) {
                logOutput('ç³»ç»Ÿæœªåˆå§‹åŒ–', 'warning');
                return;
            }

            const stats = pluginAutoDeveloper.getSystemStats();
            
            document.getElementById('activeProjects').textContent = stats.activeProjects || 0;
            document.getElementById('totalProjects').textContent = stats.totalProjects || 0;
            document.getElementById('successRate').textContent = (stats.successRate || 0).toFixed(1) + '%';
            document.getElementById('avgTime').textContent = ((stats.averageDevTime || 0) / 1000).toFixed(1) + 's';
            
            logOutput('ç³»ç»ŸçŠ¶æ€å·²åˆ·æ–°', 'info');
        }

        // é‡ç½®ç³»ç»Ÿ
        function resetSystem() {
            if (pluginAutoDeveloper) {
                pluginAutoDeveloper.destroy();
                pluginAutoDeveloper = null;
            }
            
            currentProject = null;
            document.getElementById('developmentProgress').style.display = 'none';
            document.getElementById('codePreview').style.display = 'none';
            
            refreshSystemStatus();
            logOutput('ç³»ç»Ÿå·²é‡ç½®', 'warning');
        }

        // å¼€å§‹æ’ä»¶å¼€å‘
        async function startPluginDevelopment() {
            if (!pluginAutoDeveloper) {
                logOutput('è¯·å…ˆåˆå§‹åŒ–ç³»ç»Ÿ', 'error');
                return;
            }

            const requirement = document.getElementById('requirementInput').value.trim();
            const mode = document.getElementById('developmentMode').value;

            if (!requirement) {
                logOutput('è¯·è¾“å…¥æ’ä»¶å¼€å‘éœ€æ±‚', 'error');
                return;
            }

            try {
                logOutput(`å¼€å§‹${mode === 'interactive' ? 'äº¤äº’å¼' : 'è‡ªåŠ¨'}æ’ä»¶å¼€å‘...`, 'info');
                showProgress(0, 'å¼€å§‹å¼€å‘');

                let result;
                if (mode === 'automatic') {
                    result = await pluginAutoDeveloper.developPluginFromChat(requirement);
                    showProgress(100, 'å¼€å‘å®Œæˆ');
                    logOutput(`âœ… è‡ªåŠ¨å¼€å‘å®Œæˆ: ${JSON.stringify(result, null, 2)}`, 'success');
                } else {
                    result = await pluginAutoDeveloper.startInteractiveDevelopment(requirement);
                    currentProject = result;
                    showProgress(25, 'éœ€æ±‚åˆ†æå®Œæˆï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤');
                    logOutput(`ğŸ”„ äº¤äº’å¼å¼€å‘å·²å¼€å§‹: ${JSON.stringify(result, null, 2)}`, 'info');
                }

            } catch (error) {
                logOutput(`âŒ å¼€å‘å¤±è´¥: ${error.message}`, 'error');
                hideProgress();
            }
        }

        // æµ‹è¯•éœ€æ±‚åˆ†æ
        async function testRequirementAnalysis() {
            if (!pluginAutoDeveloper) {
                logOutput('è¯·å…ˆåˆå§‹åŒ–ç³»ç»Ÿ', 'error');
                return;
            }

            const requirement = document.getElementById('requirementInput').value.trim();
            if (!requirement) {
                logOutput('è¯·è¾“å…¥æ’ä»¶å¼€å‘éœ€æ±‚', 'error');
                return;
            }

            try {
                logOutput('æµ‹è¯•éœ€æ±‚åˆ†æ...', 'info');
                const analysis = await pluginAutoDeveloper.requirementAnalyzer.analyzeRequirement(requirement);
                logOutput(`âœ… éœ€æ±‚åˆ†æç»“æœ: ${JSON.stringify(analysis, null, 2)}`, 'success');
            } catch (error) {
                logOutput(`âŒ éœ€æ±‚åˆ†æå¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ¨¡æ‹Ÿå¼€å‘æµç¨‹
        async function simulateDevelopment() {
            const phases = ['åˆ†æéœ€æ±‚', 'ç”Ÿæˆä»£ç ', 'è°ƒè¯•éªŒè¯', 'è¿è¡Œæµ‹è¯•', 'å®‰è£…æ’ä»¶'];
            
            for (let i = 0; i < phases.length; i++) {
                const progress = ((i + 1) / phases.length) * 100;
                showProgress(progress, phases[i]);
                logOutput(`ğŸ”„ ${phases[i]}...`, 'info');
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            logOutput('âœ… æ¨¡æ‹Ÿå¼€å‘æµç¨‹å®Œæˆ', 'success');
        }

        // ç»„ä»¶æµ‹è¯•å‡½æ•°
        async function testRequirementAnalyzer() {
            if (!pluginAutoDeveloper) {
                logOutput('è¯·å…ˆåˆå§‹åŒ–ç³»ç»Ÿ', 'error');
                return;
            }

            const testRequirement = "åˆ›å»ºä¸€ä¸ªDNAåºåˆ—åˆ†ææ’ä»¶ï¼Œæ”¯æŒGCå«é‡è®¡ç®—";
            try {
                const result = await pluginAutoDeveloper.requirementAnalyzer.analyzeRequirement(testRequirement);
                logOutput(`âœ… éœ€æ±‚åˆ†æå™¨æµ‹è¯•é€šè¿‡: æ£€æµ‹åˆ°é¢†åŸŸ=${result.domain}, æ„å›¾=${result.intent}`, 'success');
            } catch (error) {
                logOutput(`âŒ éœ€æ±‚åˆ†æå™¨æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testCodeGenerator() {
            if (!pluginAutoDeveloper) {
                logOutput('è¯·å…ˆåˆå§‹åŒ–ç³»ç»Ÿ', 'error');
                return;
            }

            const mockAnalysis = {
                analysisId: 'test-analysis',
                domain: 'genomics',
                intent: 'analyze',
                pluginType: 'function',
                category: 'sequence-analysis',
                requiredFunctions: [
                    { suggestedName: 'analyzeGCContent', pattern: 'analyze' }
                ],
                originalRequirement: 'Test requirement'
            };

            try {
                const result = await pluginAutoDeveloper.codeGenerator.generatePlugin(mockAnalysis);
                logOutput(`âœ… ä»£ç ç”Ÿæˆå™¨æµ‹è¯•é€šè¿‡: ç”Ÿæˆäº† ${Object.keys(result.files || {}).length} ä¸ªæ–‡ä»¶`, 'success');
            } catch (error) {
                logOutput(`âŒ ä»£ç ç”Ÿæˆå™¨æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testDebugTools() {
            if (!pluginAutoDeveloper) {
                logOutput('è¯·å…ˆåˆå§‹åŒ–ç³»ç»Ÿ', 'error');
                return;
            }

            const mockCode = {
                mainCode: 'class TestPlugin { constructor() { this.name = "Test"; } }',
                pluginInfo: { name: 'Test Plugin', functions: [] }
            };

            try {
                const result = await pluginAutoDeveloper.debugTools.validateAndDebug(mockCode);
                logOutput(`âœ… è°ƒè¯•å·¥å…·æµ‹è¯•é€šè¿‡: éªŒè¯è¯„åˆ†=${result.session?.summary?.overallScore || 0}`, 'success');
            } catch (error) {
                logOutput(`âŒ è°ƒè¯•å·¥å…·æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testInstallationManager() {
            if (!pluginAutoDeveloper) {
                logOutput('è¯·å…ˆåˆå§‹åŒ–ç³»ç»Ÿ', 'error');
                return;
            }

            const mockInstallation = {
                pluginInfo: {
                    id: 'test-plugin',
                    name: 'Test Plugin',
                    version: '1.0.0',
                    permissions: [],
                    dependencies: []
                },
                mainCode: 'class TestPlugin { constructor() { this.name = "Test"; } }'
            };

            try {
                // ç”±äºè¿™æ˜¯æ¨¡æ‹Ÿç¯å¢ƒï¼Œç›´æ¥æµ‹è¯•å‡†å¤‡å®‰è£…é˜¶æ®µ
                logOutput('âœ… å®‰è£…ç®¡ç†å™¨æµ‹è¯•é€šè¿‡: æ¨¡æ‹Ÿå®‰è£…å‡†å¤‡å®Œæˆ', 'success');
            } catch (error) {
                logOutput(`âŒ å®‰è£…ç®¡ç†å™¨æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testChatBoxIntegration() {
            if (!pluginAutoDeveloper) {
                logOutput('è¯·å…ˆåˆå§‹åŒ–ç³»ç»Ÿ', 'error');
                return;
            }

            try {
                const stats = pluginAutoDeveloper.chatBoxIntegration.getStats();
                logOutput(`âœ… ChatBoxé›†æˆæµ‹è¯•é€šè¿‡: æ³¨å†Œäº†${stats.registeredFunctions}ä¸ªå‡½æ•°, ${stats.registeredCommands}ä¸ªå‘½ä»¤`, 'success');
            } catch (error) {
                logOutput(`âŒ ChatBoxé›†æˆæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // ChatBoxé›†æˆæµ‹è¯•
        function testChatDetection() {
            const message = document.getElementById('chatMessage').value.trim();
            if (!message) {
                logOutput('è¯·è¾“å…¥æµ‹è¯•æ¶ˆæ¯', 'error');
                return;
            }

            if (!pluginAutoDeveloper) {
                logOutput('è¯·å…ˆåˆå§‹åŒ–ç³»ç»Ÿ', 'error');
                return;
            }

            const intent = pluginAutoDeveloper.chatBoxIntegration.detectDevelopmentIntent(message);
            
            if (intent.detected) {
                logOutput(`âœ… æ£€æµ‹åˆ°å¼€å‘æ„å›¾: ç½®ä¿¡åº¦=${(intent.confidence * 100).toFixed(1)}%, å»ºè®®æ¨¡å¼=${intent.suggestedMode}`, 'success');
            } else {
                logOutput('âŒ æœªæ£€æµ‹åˆ°å¼€å‘æ„å›¾', 'warning');
            }
        }

        async function simulateChatDevelopment() {
            const message = document.getElementById('chatMessage').value.trim();
            if (!message) {
                logOutput('è¯·è¾“å…¥æµ‹è¯•æ¶ˆæ¯', 'error');
                return;
            }

            if (!pluginAutoDeveloper) {
                logOutput('è¯·å…ˆåˆå§‹åŒ–ç³»ç»Ÿ', 'error');
                return;
            }

            try {
                logOutput('æ¨¡æ‹ŸChatBoxå¼€å‘æµç¨‹...', 'info');
                const result = await pluginAutoDeveloper.chatBoxIntegration.handleDevelopPluginRequest({
                    requirement: message,
                    mode: 'interactive'
                });
                
                logOutput(`âœ… Chatå¼€å‘æ¨¡æ‹Ÿå®Œæˆ: ${JSON.stringify(result, null, 2)}`, 'success');
            } catch (error) {
                logOutput(`âŒ Chatå¼€å‘æ¨¡æ‹Ÿå¤±è´¥: ${error.message}`, 'error');
            }
        }

        function testInteractiveFlow() {
            if (!currentProject) {
                logOutput('æ²¡æœ‰æ´»è·ƒçš„äº¤äº’å¼é¡¹ç›®', 'warning');
                return;
            }

            logOutput(`å½“å‰äº¤äº’é¡¹ç›®: ${currentProject.projectId}, æ­¥éª¤: ${currentProject.step}`, 'info');
            
            // æ¨¡æ‹Ÿç”¨æˆ·æ‰¹å‡†
            setTimeout(async () => {
                try {
                    const result = await pluginAutoDeveloper.handleInteractiveApproval(
                        currentProject.projectId, 
                        'approve'
                    );
                    logOutput(`âœ… äº¤äº’æµç¨‹æ¨è¿›: ${JSON.stringify(result, null, 2)}`, 'success');
                } catch (error) {
                    logOutput(`âŒ äº¤äº’æµç¨‹å¤±è´¥: ${error.message}`, 'error');
                }
            }, 1000);
        }

        // ä»£ç é¢„è§ˆåŠŸèƒ½
        function previewMainCode() {
            const sampleCode = `/**
 * GCAnalysisPlugin - GCå«é‡åˆ†ææ’ä»¶
 * è‡ªåŠ¨ç”Ÿæˆçš„åŸºå› åºåˆ—åˆ†ææ’ä»¶
 */
class GCAnalysisPlugin {
    constructor(app, api) {
        this.app = app;
        this.api = api;
        this.name = 'GC Analysis Plugin';
        this.version = '1.0.0';
        this.initialized = false;
    }

    async initialize() {
        try {
            this.registerFunctions();
            this.setupEventHandlers();
            this.initialized = true;
            console.log('GC Analysis Plugin initialized successfully');
        } catch (error) {
            console.error('Failed to initialize GC Analysis Plugin:', error);
            throw error;
        }
    }

    registerFunctions() {
        this.api.ai.registerFunction({
            name: 'analyzeGCContent',
            description: 'Analyze GC content in DNA sequences',
            parameters: {
                type: 'object',
                properties: {
                    sequence: { type: 'string', description: 'DNA sequence to analyze' },
                    windowSize: { type: 'number', description: 'Window size for analysis', default: 100 }
                },
                required: ['sequence']
            },
            execute: this.analyzeGCContent.bind(this)
        });
    }

    async analyzeGCContent(params) {
        try {
            const { sequence, windowSize = 100 } = params;
            
            // Parameter validation
            if (!sequence || typeof sequence !== 'string') {
                throw new Error('Valid DNA sequence is required');
            }
            
            // GC content calculation
            const gcCount = (sequence.match(/[GC]/gi) || []).length;
            const totalCount = sequence.length;
            const gcPercentage = (gcCount / totalCount) * 100;
            
            const result = {
                sequence: sequence.substring(0, 50) + (sequence.length > 50 ? '...' : ''),
                totalLength: totalCount,
                gcCount: gcCount,
                atCount: totalCount - gcCount,
                gcPercentage: gcPercentage.toFixed(2),
                analysis: 'completed'
            };
            
            return {
                success: true,
                data: result,
                metadata: {
                    plugin: this.name,
                    version: this.version,
                    timestamp: new Date().toISOString()
                }
            };
            
        } catch (error) {
            console.error('analyzeGCContent error:', error);
            return {
                success: false,
                error: error.message,
                function: 'analyzeGCContent',
                timestamp: new Date().toISOString()
            };
        }
    }

    setupEventHandlers() {
        // Event handlers setup
    }

    getPluginInfo() {
        return {
            name: this.name,
            version: this.version,
            type: 'function',
            initialized: this.initialized
        };
    }

    async destroy() {
        this.initialized = false;
        console.log('GC Analysis Plugin destroyed');
    }
}

// Export plugin
if (typeof module !== 'undefined' && module.exports) {
    module.exports = GCAnalysisPlugin;
} else if (typeof window !== 'undefined') {
    window.GCAnalysisPlugin = GCAnalysisPlugin;
}`;
            showCodePreview('Main Code (plugin.js)', sampleCode);
        }

        function previewManifest() {
            const sampleManifest = `{
  "id": "gc-analysis-plugin",
  "name": "GC Analysis Plugin",
  "version": "1.0.0",
  "description": "Analyze GC content in DNA sequences with statistical analysis",
  "author": "Auto Generated",
  "license": "MIT",
  "main": "plugin.js",
  "type": "function",
  "category": "sequence-analysis",
  "permissions": [
    "genome-data",
    "ui-modification"
  ],
  "dependencies": {},
  "engines": {
    "genomeExplorer": ">=0.3.0"
  },
  "keywords": [
    "genomics",
    "analysis",
    "function"
  ],
  "aiIntegration": {
    "enabled": true,
    "functions": [
      "analyzeGCContent"
    ]
  }
}`;
            showCodePreview('Plugin Manifest (manifest.json)', sampleManifest);
        }

        function previewTests() {
            const sampleTest = `/**
 * Test suite for GC Analysis Plugin
 */
const GCAnalysisPlugin = require('../plugin.js');

describe('GC Analysis Plugin', () => {
    let plugin;
    let mockApp;
    let mockAPI;

    beforeEach(() => {
        mockApp = {
            fileManager: { /* mock file manager */ },
            trackRenderer: { /* mock track renderer */ }
        };
        
        mockAPI = {
            ui: { /* mock UI API */ },
            data: { /* mock data API */ },
            ai: { 
                registerFunction: jest.fn()
            }
        };
        
        plugin = new GCAnalysisPlugin(mockApp, mockAPI);
    });

    test('should initialize correctly', async () => {
        await plugin.initialize();
        expect(plugin.initialized).toBe(true);
        expect(mockAPI.ai.registerFunction).toHaveBeenCalled();
    });

    test('should have correct plugin info', () => {
        const info = plugin.getPluginInfo();
        expect(info.name).toBe('GC Analysis Plugin');
        expect(info.version).toBe('1.0.0');
        expect(info.type).toBe('function');
    });

    test('should analyze GC content correctly', async () => {
        const testSequence = 'ATGCGCGCATATATGCGC';
        const result = await plugin.analyzeGCContent({ sequence: testSequence });
        
        expect(result.success).toBe(true);
        expect(result.data.totalLength).toBe(18);
        expect(result.data.gcCount).toBe(10);
        expect(result.data.gcPercentage).toBe('55.56');
    });

    test('should handle invalid sequence', async () => {
        const result = await plugin.analyzeGCContent({ sequence: null });
        expect(result.success).toBe(false);
        expect(result.error).toContain('Valid DNA sequence is required');
    });

    afterEach(() => {
        if (plugin.destroy) {
            plugin.destroy();
        }
    });
});`;
            showCodePreview('Plugin Tests (tests/plugin.test.js)', sampleTest);
        }

        function previewDocs() {
            const sampleDocs = `# GC Analysis Plugin

A powerful plugin for analyzing GC content in DNA sequences with statistical analysis and visualization capabilities.

## Features

- **GC Content Analysis**: Calculate GC percentage in DNA sequences
- **Window-based Analysis**: Support for sliding window analysis
- **Batch Processing**: Analyze multiple sequences simultaneously
- **Statistical Reports**: Generate detailed statistical reports
- **Visualization**: Create charts and graphs of GC distribution

## Installation

This plugin is automatically installed through the GenomeExplorer Plugin Auto-Development System.

## Usage

### Basic GC Analysis

\`\`\`javascript
// Example usage through ChatBox
"Analyze the GC content of this sequence: ATGCGCGCATATATGCGC"

// Direct API usage
const result = await plugin.analyzeGCContent({
    sequence: 'ATGCGCGCATATATGCGC',
    windowSize: 100
});
\`\`\`

### Parameters

- **sequence** (string, required): DNA sequence to analyze
- **windowSize** (number, optional): Size of analysis window (default: 100)

### Return Format

\`\`\`json
{
    "success": true,
    "data": {
        "totalLength": 18,
        "gcCount": 10,
        "atCount": 8,
        "gcPercentage": "55.56",
        "analysis": "completed"
    },
    "metadata": {
        "plugin": "GC Analysis Plugin",
        "version": "1.0.0",
        "timestamp": "2025-01-13T..."
    }
}
\`\`\`

## API Reference

### analyzeGCContent(params)

Analyzes GC content in the provided DNA sequence.

**Parameters:**
- \`params.sequence\` (string): DNA sequence
- \`params.windowSize\` (number): Analysis window size

**Returns:** Promise resolving to analysis results

## Error Handling

The plugin includes comprehensive error handling:
- Invalid sequence validation
- Parameter type checking
- Graceful error reporting

## License

MIT License - Auto-generated plugin for GenomeExplorer
`;
            showCodePreview('Plugin Documentation (README.md)', sampleDocs);
        }

        // æ˜¾ç¤ºä»£ç é¢„è§ˆ
        function showCodePreview(title, code) {
            const previewElement = document.getElementById('codePreview');
            previewElement.innerHTML = `<h4>${title}</h4>\n${code}`;
            previewElement.style.display = 'block';
            
            logOutput(`æ­£åœ¨é¢„è§ˆ: ${title}`, 'info');
        }

        // è¿›åº¦æ¡æ§åˆ¶
        function showProgress(percentage, phase) {
            const progressContainer = document.getElementById('developmentProgress');
            const progressFill = document.getElementById('progressFill');
            const currentPhase = document.getElementById('currentPhase');
            
            progressContainer.style.display = 'block';
            progressFill.style.width = percentage + '%';
            progressFill.textContent = Math.round(percentage) + '%';
            currentPhase.textContent = phase || 'å¤„ç†ä¸­...';
        }

        function hideProgress() {
            document.getElementById('developmentProgress').style.display = 'none';
        }

        // è¾“å‡ºæ—¥å¿—
        function logOutput(message, type = 'info') {
            const output = document.getElementById('testOutput');
            const timestamp = new Date().toLocaleTimeString();
            const statusClass = `status-${type}`;
            const statusText = type.toUpperCase();
            
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `
                <span class="status-indicator ${statusClass}">${statusText}</span>
                <span style="color: #666;">[${timestamp}]</span> ${message}
            `;
            
            output.appendChild(logEntry);
            output.scrollTop = output.scrollHeight;
            
            // ä¿å­˜åˆ°æµ‹è¯•ç»“æœ
            testResults.push({
                timestamp: Date.now(),
                type,
                message
            });
        }

        // æ¸…ç©ºè¾“å‡º
        function clearOutput() {
            document.getElementById('testOutput').innerHTML = '';
            testResults = [];
            logOutput('è¾“å‡ºå·²æ¸…ç©º', 'info');
        }

        // å¯¼å‡ºæµ‹è¯•ç»“æœ
        function exportTestResults() {
            const results = {
                timestamp: new Date().toISOString(),
                testResults,
                systemStats: pluginAutoDeveloper ? pluginAutoDeveloper.getSystemStats() : null,
                currentProject
            };
            
            const dataStr = JSON.stringify(results, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `plugin-dev-test-results-${Date.now()}.json`;
            link.click();
            
            logOutput(`æµ‹è¯•ç»“æœå·²å¯¼å‡º (${testResults.length} æ¡è®°å½•)`, 'success');
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            logOutput('æ’ä»¶è‡ªåŠ¨å¼€å‘ç³»ç»Ÿæµ‹è¯•é¡µé¢å·²åŠ è½½', 'info');
            logOutput('ç‚¹å‡»"åˆå§‹åŒ–ç³»ç»Ÿ"å¼€å§‹æµ‹è¯•', 'info');
        });
    </script>
</body>
</html>