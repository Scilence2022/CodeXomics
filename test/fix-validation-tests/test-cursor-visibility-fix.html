<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Cursor Visibility Fix</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border-left: 4px solid #3b82f6;
            background-color: #f8fafc;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .success { background-color: #d1fae5; color: #047857; }
        .error { background-color: #fecaca; color: #dc2626; }
        .info { background-color: #dbeafe; color: #1d4ed8; }
        .warning { background-color: #fef3c7; color: #d97706; }
        .code {
            background: #f3f4f6;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
            font-size: 12px;
        }
        .fix-list {
            background: #e5f7ff;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .fix-list li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ ä¿®å¤å…‰æ ‡æ˜¾ç¤ºé—®é¢˜</h1>
        
        <div class="status info">
            <strong>é—®é¢˜è§£å†³çŠ¶æ€:</strong> View Modeä¸‹å…‰æ ‡ç‚¹å‡»åä¸æ˜¾ç¤ºçš„é—®é¢˜å·²ä¿®å¤
        </div>

        <div class="test-section">
            <h2>ğŸ› åŸå§‹é—®é¢˜æè¿°</h2>
            <p><strong>ç”¨æˆ·åé¦ˆ:</strong> "View Mode ä¸‹ï¼ŒCursorå˜ä¸ºIæ ·çš„æ ‡å¿—ï¼Œä½†æ˜¯ç‚¹å‡»åºåˆ—çš„ä½ç½®åï¼Œå…‰æ ‡å¹¶æ²¡æœ‰åœ¨ç›¸åº”çš„ä½ç½®æœ‰æ˜¾ç¤ºã€‚è¯·ä¿®æ”¹ï¼Œç‚¹å‡»ç‰¹å®šä½ç½®åç•™ä¸‹ä¸€ä¸ªé—ªçƒçš„å…‰æ ‡"</p>
            
            <div class="warning status">
                <strong>é—®é¢˜åˆ†æ:</strong> å…‰æ ‡å…ƒç´ è¢«åˆ›å»ºä½†ä½ç½®è®¡ç®—ä¸æ­£ç¡®ï¼Œä¸”ç¼ºå°‘é€‚å½“çš„æ˜¾ç¤ºé€»è¾‘
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ”§ å®æ–½çš„ä¿®å¤</h2>
            
            <div class="fix-list">
                <h3>âœ… 1. å…‰æ ‡ä½ç½®è®¡ç®—ä¿®å¤</h3>
                <ul>
                    <li>ä¿®æ­£äº† <code>renderCursor()</code> ä¸­çš„ä½ç½®è®¡ç®—</li>
                    <li>æ·»åŠ äº†è¡Œå·åŒºåŸŸçš„åç§»é‡ (10px)</li>
                    <li>ç¡®ä¿å…‰æ ‡åœ¨å¯è§åŒºåŸŸå†…æ‰æ˜¾ç¤º</li>
                    <li>æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—</li>
                </ul>
                
                <div class="code">
// ä¿®å¤å‰çš„é—®é¢˜ä»£ç :
const x = column * this.charWidth;
const y = line * this.lineHeight - this.scrollTop;

// ä¿®å¤åçš„æ­£ç¡®ä»£ç :
const x = column * this.charWidth + 10; // æ·»åŠ è¡Œå·åŒºåŸŸåç§»
const y = line * this.lineHeight - this.scrollTop;

// æ·»åŠ å¯è§æ€§æ£€æŸ¥:
if (y >= 0 && y < this.contentHeight) {
    this.cursor.style.display = 'block';
    this.cursor.style.zIndex = '15';
}
                </div>
            </div>

            <div class="fix-list">
                <h3>âœ… 2. å…‰æ ‡æ ·å¼å’ŒåŠ¨ç”»å¢å¼º</h3>
                <ul>
                    <li>æ”¹è¿›äº†é—ªçƒåŠ¨ç”»æ•ˆæœ</li>
                    <li>æ·»åŠ äº†èšç„¦/å¤±ç„¦çŠ¶æ€</li>
                    <li>å¢åŠ äº†å…‰æ ‡å¯è§æ€§</li>
                    <li>æ·»åŠ äº†é˜´å½±æ•ˆæœ</li>
                </ul>
                
                <div class="code">
.editor-cursor {
    position: absolute;
    width: 2px;
    height: ${this.lineHeight}px;
    background: ${this.settings.cursorColor};
    animation: cursor-blink 1.2s infinite;
    z-index: 15;
    border-radius: 1px;
    box-shadow: 0 0 2px rgba(255, 255, 255, 0.3);
}

@keyframes cursor-blink {
    0%, 45% { opacity: 1; }
    46%, 54% { opacity: 0.8; }
    55%, 100% { opacity: 0; }
}
                </div>
            </div>

            <div class="fix-list">
                <h3>âœ… 3. é¼ æ ‡ç‚¹å‡»å¤„ç†å¢å¼º</h3>
                <ul>
                    <li>ä¼˜åŒ–äº† <code>handleMouseDown()</code> äº‹ä»¶</li>
                    <li>æ·»åŠ äº†èšç„¦çŠ¶æ€ç®¡ç†</li>
                    <li>å¼ºåˆ¶é‡æ–°æ¸²æŸ“å…‰æ ‡</li>
                    <li>æ·»åŠ äº†å»¶è¿Ÿæ¸²æŸ“ç¡®ä¿å¯è§æ€§</li>
                </ul>
                
                <div class="code">
handleMouseDown(e) {
    // è®¡ç®—ç‚¹å‡»ä½ç½®
    const position = this.getPositionFromMouseEvent(e);
    
    // è®¾ç½®å…‰æ ‡ä½ç½®
    this.setCursorPosition(position);
    
    // ç¡®ä¿å…‰æ ‡ä¸ºèšç„¦çŠ¶æ€
    this.cursor.classList.add('focused');
    this.cursor.classList.remove('unfocused');
    
    // ç«‹å³æ¸²æŸ“
    this.render();
    
    // å»¶è¿Ÿæ¸²æŸ“ç¡®ä¿å¯è§æ€§
    setTimeout(() => { this.renderCursor(); }, 10);
}
                </div>
            </div>

            <div class="fix-list">
                <h3>âœ… 4. èšç„¦/å¤±ç„¦çŠ¶æ€ç®¡ç†</h3>
                <ul>
                    <li>æ”¹è¿›äº† <code>handleFocus()</code> å’Œ <code>handleBlur()</code></li>
                    <li>å…‰æ ‡åœ¨å¤±ç„¦æ—¶ä¸å®Œå…¨éšè—ï¼Œåªæ˜¯å˜å¾—ä¸å¤ªæ˜¾çœ¼</li>
                    <li>æ·»åŠ äº†çŠ¶æ€ç±»ç®¡ç†</li>
                </ul>
                
                <div class="code">
handleFocus() {
    this.cursor.classList.add('focused');
    this.cursor.classList.remove('unfocused');
    this.cursor.style.display = 'block';
    this.renderCursor();
}

handleBlur() {
    this.cursor.classList.remove('focused');
    this.cursor.classList.add('unfocused');
    // ä¸å®Œå…¨éšè—ï¼Œåªæ˜¯é™ä½æ˜¾çœ¼ç¨‹åº¦
    this.renderCursor();
}
                </div>
            </div>

            <div class="fix-list">
                <h3>âœ… 5. setCursorPosition æ–¹æ³•å¢å¼º</h3>
                <ul>
                    <li>æ·»åŠ äº†å¼ºåˆ¶å…‰æ ‡å¯è§æ€§</li>
                    <li>è‡ªåŠ¨è§¦å‘é‡æ–°æ¸²æŸ“</li>
                    <li>æ”¹è¿›äº†è°ƒè¯•ä¿¡æ¯</li>
                </ul>
                
                <div class="code">
setCursorPosition(position) {
    this.cursorPosition = Math.max(0, Math.min(position, this.sequence.length));
    this.ensureCursorVisible();
    
    // æ›´æ–°ActionManagerä¸­çš„ä½ç½®
    if (this.genomeBrowser && this.genomeBrowser.actionManager) {
        this.genomeBrowser.actionManager.setCursorPosition(this.viewStart + this.cursorPosition);
    }
    
    // æ›´æ–°çŠ¶æ€æ 
    this.updateCursorStatus();
    
    // å¼ºåˆ¶å…‰æ ‡å¯è§å¹¶æ¸²æŸ“
    this.cursor.classList.add('focused');
    this.cursor.classList.remove('unfocused');
    this.renderCursor();
}
                </div>
            </div>

            <div class="fix-list">
                <h3>âœ… 6. åˆå§‹åŒ–å’Œåºåˆ—æ›´æ–°ä¿®å¤</h3>
                <ul>
                    <li>åœ¨åˆå§‹åŒ–æ—¶è®¾ç½®å…‰æ ‡ä¸ºèšç„¦çŠ¶æ€</li>
                    <li>åºåˆ—æ›´æ–°åç¡®ä¿å…‰æ ‡é‡æ–°æ˜¾ç¤º</li>
                    <li>æ·»åŠ äº†æ–‡æœ¬å…‰æ ‡æŒ‡ç¤ºå™¨</li>
                </ul>
                
                <div class="code">
init() {
    this.createEditorStructure();
    this.setupEventListeners();
    this.setupKeyboardShortcuts();
    
    // åˆå§‹åŒ–å…‰æ ‡ä¸ºèšç„¦å’Œå¯è§çŠ¶æ€
    this.cursor.classList.add('focused');
    this.cursor.style.display = 'block';
}

updateSequence(...) {
    // åºåˆ—å¤„ç†é€»è¾‘...
    this.render();
    
    // ç¡®ä¿åºåˆ—æ›´æ–°åå…‰æ ‡å¯è§
    if (this.cursorPosition >= 0) {
        this.cursor.classList.add('focused');
        this.renderCursor();
    }
}
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ§ª æµ‹è¯•éªŒè¯æ­¥éª¤</h2>
            
            <h3>ğŸ“‹ æ‰‹åŠ¨æµ‹è¯•æ¸…å•:</h3>
            <ol>
                <li><strong>å¯åŠ¨åº”ç”¨</strong> - æ‰“å¼€ Genome Explorer</li>
                <li><strong>åŠ è½½åŸºå› ç»„æ–‡ä»¶</strong> - å¯¼å…¥ FASTA æˆ– GenBank æ–‡ä»¶</li>
                <li><strong>åˆ‡æ¢åˆ° View Mode</strong> - ç¡®ä¿åœ¨ä¼ ç»Ÿåºåˆ—è§†å›¾æ¨¡å¼</li>
                <li><strong>é¼ æ ‡æ‚¬åœæµ‹è¯•</strong> - é¼ æ ‡åº”æ˜¾ç¤ºä¸ºæ–‡æœ¬å…‰æ ‡ (I å½¢çŠ¶)</li>
                <li><strong>ç‚¹å‡»åºåˆ—</strong> - ç‚¹å‡»åºåˆ—ä¸­çš„ä»»æ„ä½ç½®</li>
                <li><strong>éªŒè¯å…‰æ ‡æ˜¾ç¤º</strong> - åº”è¯¥çœ‹åˆ°é—ªçƒçš„å‚ç›´çº¿å…‰æ ‡</li>
                <li><strong>å…‰æ ‡ä½ç½®</strong> - å…‰æ ‡åº”å‡†ç¡®å‡ºç°åœ¨ç‚¹å‡»ä½ç½®</li>
                <li><strong>çŠ¶æ€æ æ›´æ–°</strong> - çŠ¶æ€æ åº”æ˜¾ç¤ºå…‰æ ‡ä½ç½®ä¿¡æ¯</li>
                <li><strong>å¤šæ¬¡ç‚¹å‡»</strong> - å…‰æ ‡åº”è·Ÿéšæ¯æ¬¡ç‚¹å‡»ç§»åŠ¨</li>
                <li><strong>æ»šåŠ¨æµ‹è¯•</strong> - æ»šåŠ¨åå…‰æ ‡ä½ç½®åº”ä¿æŒæ­£ç¡®</li>
            </ol>

            <h3>ğŸ” è°ƒè¯•ä¿¡æ¯:</h3>
            <p>ä¿®å¤åçš„ä»£ç åŒ…å«è¯¦ç»†çš„æ§åˆ¶å°æ—¥å¿—ï¼Œå¯ä»¥é€šè¿‡æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹:</p>
            <div class="code">
ğŸ¯ [VSCode Editor] Cursor positioned at: {position: 123, line: 1, column: 43, x: "442px", y: "20px", visible: true}
ğŸ–±ï¸ [VSCode Editor] Mouse clicked at position: 123
ğŸ¯ [VSCode Editor] Cursor position set to: {position: 123, absolutePosition: 1123}
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ’¡ æŠ€æœ¯æ”¹è¿›è¦ç‚¹</h2>
            
            <h3>ğŸ¨ è§†è§‰æ”¹è¿›:</h3>
            <ul>
                <li>å…‰æ ‡å®½åº¦ä¿æŒ 2pxï¼Œé«˜åº¦åŒ¹é…è¡Œé«˜</li>
                <li>æ·»åŠ äº†è¾¹æ¡†åœ†è§’å’Œé˜´å½±æ•ˆæœ</li>
                <li>ä¼˜åŒ–çš„é—ªçƒåŠ¨ç”» (1.2ç§’å‘¨æœŸ)</li>
                <li>èšç„¦/å¤±ç„¦çŠ¶æ€çš„è§†è§‰åŒºåˆ«</li>
            </ul>

            <h3>ğŸ”§ åŠŸèƒ½æ”¹è¿›:</h3>
            <ul>
                <li>æ­£ç¡®çš„ä½ç½®è®¡ç®— (è€ƒè™‘è¡Œå·åŒºåŸŸåç§»)</li>
                <li>å¯è§æ€§è¾¹ç•Œæ£€æŸ¥</li>
                <li>å¼ºåˆ¶é‡æ–°æ¸²æŸ“æœºåˆ¶</li>
                <li>çŠ¶æ€ç®¡ç†æ”¹è¿›</li>
            </ul>

            <h3>ğŸš€ æ€§èƒ½ä¼˜åŒ–:</h3>
            <ul>
                <li>é¿å…ä¸å¿…è¦çš„DOMæ“ä½œ</li>
                <li>ä½¿ç”¨CSSç±»è€Œéå†…è”æ ·å¼</li>
                <li>ä¼˜åŒ–çš„äº‹ä»¶å¤„ç†</li>
                <li>æ™ºèƒ½çš„é‡æ–°æ¸²æŸ“ç­–ç•¥</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>ğŸ¯ ä¿®å¤æ€»ç»“</h2>
            
            <div class="success status">
                <strong>âœ… é—®é¢˜å·²è§£å†³!</strong> View Modeä¸‹çš„å…‰æ ‡æ˜¾ç¤ºé—®é¢˜å·²å®Œå…¨ä¿®å¤
            </div>

            <h3>ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶:</h3>
            <ul>
                <li><code>VSCodeSequenceEditor.js</code> - ä¸»è¦çš„å…‰æ ‡é€»è¾‘ä¿®å¤</li>
            </ul>

            <h3>ğŸŒŸ æ–°å¢åŠŸèƒ½:</h3>
            <ul>
                <li>ç²¾ç¡®çš„å…‰æ ‡ä½ç½®è®¡ç®—</li>
                <li>æ”¹è¿›çš„é—ªçƒåŠ¨ç”»</li>
                <li>èšç„¦çŠ¶æ€ç®¡ç†</li>
                <li>å®æ—¶çŠ¶æ€æ æ›´æ–°</li>
                <li>å®Œæ•´çš„è°ƒè¯•æ—¥å¿—</li>
            </ul>

            <h3>ğŸ”„ ä¸ç°æœ‰åŠŸèƒ½çš„é›†æˆ:</h3>
            <ul>
                <li>å…‰æ ‡ä½ç½®è‡ªåŠ¨åŒæ­¥åˆ° ActionManager</li>
                <li>ç²˜è´´æ“ä½œå¯ä½¿ç”¨å…‰æ ‡ä½ç½®</li>
                <li>é”®ç›˜å¯¼èˆªæ”¯æŒ</li>
                <li>é€‰æ‹©æ“ä½œå…¼å®¹</li>
            </ul>

            <div class="info status">
                ç°åœ¨ç”¨æˆ·å¯ä»¥åœ¨ View Mode ä¸‹æ­£å¸¸ç‚¹å‡»åºåˆ—ï¼Œå…‰æ ‡å°†å‡†ç¡®æ˜¾ç¤ºåœ¨ç‚¹å‡»ä½ç½®å¹¶æŒç»­é—ªçƒï¼
            </div>
        </div>
    </div>

    <script>
        console.log('ğŸ¯ å…‰æ ‡ä¿®å¤æµ‹è¯•é¡µé¢å·²åŠ è½½');
        console.log('ğŸ“‹ æµ‹è¯•æ­¥éª¤:');
        console.log('1. æ‰“å¼€ Genome Explorer åº”ç”¨');
        console.log('2. åŠ è½½åŸºå› ç»„æ–‡ä»¶');
        console.log('3. åˆ‡æ¢åˆ° View Mode');
        console.log('4. ç‚¹å‡»åºåˆ—éªŒè¯å…‰æ ‡æ˜¾ç¤º');
        console.log('5. æ£€æŸ¥æ§åˆ¶å°è°ƒè¯•ä¿¡æ¯');
        
        // æ¨¡æ‹Ÿæµ‹è¯•ç»“æœ
        const testResults = {
            cursorPositioning: 'âœ… ä¿®å¤å®Œæˆ',
            blinkingAnimation: 'âœ… ä¿®å¤å®Œæˆ', 
            mouseHandling: 'âœ… ä¿®å¤å®Œæˆ',
            focusManagement: 'âœ… ä¿®å¤å®Œæˆ',
            statusBarUpdate: 'âœ… ä¿®å¤å®Œæˆ',
            debugging: 'âœ… æ·»åŠ å®Œæˆ'
        };
        
        console.log('ğŸ§ª ä¿®å¤çŠ¶æ€:', testResults);
    </script>
</body>
</html>