<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¢å¼ºChatBoxåŠŸèƒ½æµ‹è¯•</title>
    <link rel="stylesheet" href="src/renderer/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            height: 80vh;
        }
        .demo-info {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
        }
        .feature-demo {
            background: #f8fafc;
            padding: 16px;
            border-radius: 8px;
            margin: 16px 0;
            border-left: 4px solid #667eea;
        }
        .test-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin: 4px;
            transition: background 0.2s;
        }
        .test-btn:hover {
            background: #5a67d8;
        }
        .chat-wrapper {
            position: relative;
            height: 100%;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="demo-info">
            <h1>ğŸš€ GenomeExplorer å¢å¼ºChatBoxåŠŸèƒ½</h1>
            
            <div class="feature-demo">
                <h3>âœ¨ æ–°åŠŸèƒ½æ¦‚è¿°</h3>
                <ul>
                    <li><strong>å®Œæ•´æ€è€ƒè¿‡ç¨‹æ˜¾ç¤º</strong> - æ˜¾ç¤ºAIçš„æ¨ç†å’Œå·¥å…·è°ƒç”¨è¿‡ç¨‹</li>
                    <li><strong>å¯¹è¯çŠ¶æ€ç®¡ç†</strong> - å¤„ç†è¿‡ç¨‹ä¸­ç¦ç”¨æäº¤æŒ‰é’®</li>
                    <li><strong>ä¸­æ­¢åŠŸèƒ½</strong> - å…è®¸ç”¨æˆ·åœæ­¢æ­£åœ¨è¿›è¡Œçš„å¯¹è¯</li>
                    <li><strong>å·¥å…·è°ƒç”¨å¯è§†åŒ–</strong> - è¯¦ç»†å±•ç¤ºæ¯ä¸ªå·¥å…·çš„æ‰§è¡Œæƒ…å†µ</li>
                </ul>
            </div>

            <div class="feature-demo">
                <h3>ğŸ§  æ€è€ƒè¿‡ç¨‹æ˜¾ç¤º</h3>
                <p>å½“AIå¤„ç†å¤æ‚è¯·æ±‚æ—¶ï¼Œä¼šæ˜¾ç¤ºï¼š</p>
                <ul>
                    <li>åˆ†æç”¨æˆ·é—®é¢˜çš„è¿‡ç¨‹</li>
                    <li>é€‰æ‹©åˆé€‚å·¥å…·çš„æ¨ç†</li>
                    <li>å·¥å…·æ‰§è¡Œçš„å®æ—¶çŠ¶æ€</li>
                    <li>ç»“æœæ•´åˆçš„æ€è·¯</li>
                </ul>
                <button class="test-btn" onclick="testThinkingProcess()">
                    ğŸ§  æµ‹è¯•æ€è€ƒè¿‡ç¨‹
                </button>
            </div>

            <div class="feature-demo">
                <h3>ğŸ”§ å·¥å…·è°ƒç”¨æ˜¾ç¤º</h3>
                <p>è¯¦ç»†å±•ç¤ºï¼š</p>
                <ul>
                    <li>è°ƒç”¨çš„å·¥å…·åç§°å’Œå‚æ•°</li>
                    <li>æ‰§è¡ŒçŠ¶æ€ï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰</li>
                    <li>æ‰§è¡Œæ—¶é—´å’Œç»“æœæ‘˜è¦</li>
                    <li>é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰</li>
                </ul>
                <button class="test-btn" onclick="testToolCalls()">
                    ğŸ”§ æµ‹è¯•å·¥å…·è°ƒç”¨
                </button>
            </div>

            <div class="feature-demo">
                <h3>â¹ï¸ å¯¹è¯ä¸­æ­¢åŠŸèƒ½</h3>
                <p>å½“å¯¹è¯å¤„ç†æ—¶é—´è¿‡é•¿æ—¶ï¼š</p>
                <ul>
                    <li>æäº¤æŒ‰é’®å˜ä¸ºç¦ç”¨çŠ¶æ€</li>
                    <li>æ˜¾ç¤ºçº¢è‰²ä¸­æ­¢æŒ‰é’®</li>
                    <li>ç‚¹å‡»å¯ç«‹å³åœæ­¢å¤„ç†</li>
                    <li>æ¢å¤åˆ°å¾…æœºçŠ¶æ€</li>
                </ul>
                <button class="test-btn" onclick="testAbortFunction()">
                    â¹ï¸ æµ‹è¯•ä¸­æ­¢åŠŸèƒ½
                </button>
            </div>

            <div class="feature-demo">
                <h3>ğŸ“Š çŠ¶æ€ç›‘æ§</h3>
                <p>å®æ—¶æ˜¾ç¤ºï¼š</p>
                <ul>
                    <li>å½“å‰å¤„ç†è½®æ¬¡</li>
                    <li>å·²æ‰§è¡Œçš„å·¥å…·æ•°é‡</li>
                    <li>å¤„ç†è€—æ—¶</li>
                    <li>ç³»ç»Ÿèµ„æºçŠ¶æ€</li>
                </ul>
                <button class="test-btn" onclick="testStatusMonitoring()">
                    ğŸ“Š æµ‹è¯•çŠ¶æ€ç›‘æ§
                </button>
            </div>

            <div class="feature-demo">
                <h3>ğŸ¯ æµ‹è¯•åœºæ™¯</h3>
                <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                    <button class="test-btn" onclick="runComplexAnalysis()">
                        å¤æ‚åŸºå› ç»„åˆ†æ
                    </button>
                    <button class="test-btn" onclick="runMultiToolQuery()">
                        å¤šå·¥å…·æŸ¥è¯¢
                    </button>
                    <button class="test-btn" onclick="runLongRunningTask()">
                        é•¿æ—¶é—´ä»»åŠ¡
                    </button>
                    <button class="test-btn" onclick="runErrorScenario()">
                        é”™è¯¯å¤„ç†æµ‹è¯•
                    </button>
                </div>
            </div>

            <div class="feature-demo">
                <h3>ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–</h3>
                <p>æ–°åŠŸèƒ½åŒ…å«çš„ä¼˜åŒ–ï¼š</p>
                <ul>
                    <li>å¼‚æ­¥å¤„ç†é¿å…ç•Œé¢å†»ç»“</li>
                    <li>æ™ºèƒ½å·¥å…·åˆ†ç±»å’Œä¼˜å…ˆçº§æ‰§è¡Œ</li>
                    <li>å†…å­˜ä½¿ç”¨ä¼˜åŒ–</li>
                    <li>é”™è¯¯æ¢å¤æœºåˆ¶</li>
                </ul>
            </div>
        </div>

        <div class="chat-wrapper">
            <!-- ChatBox å°†åœ¨è¿™é‡Œåˆ›å»º -->
            <div id="app"></div>
        </div>
    </div>

    <!-- æ¨¡æ‹Ÿçš„ä¾èµ–é¡¹ -->
    <script>
        // æ¨¡æ‹Ÿçš„å…¨å±€é…ç½®
        class MockConfigManager {
            constructor() {
                this.config = {};
                this.chatHistory = [];
            }
            
            get(key, defaultValue) {
                return this.config[key] || defaultValue;
            }
            
            set(key, value) {
                this.config[key] = value;
            }
            
            addChatMessage(message, sender, timestamp) {
                const messageId = Date.now().toString();
                this.chatHistory.push({ message, sender, timestamp, id: messageId });
                return messageId;
            }
            
            getChatHistory() {
                return this.chatHistory;
            }
            
            clearChatHistory() {
                this.chatHistory = [];
            }
        }

        // æ¨¡æ‹Ÿçš„LLMé…ç½®ç®¡ç†å™¨
        class MockLLMConfigManager {
            isConfigured() {
                return true;
            }
            
            async sendMessageWithHistory(history, context) {
                // æ¨¡æ‹Ÿå»¶è¿Ÿå’Œå“åº”
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // éšæœºè¿”å›ä¸åŒç±»å‹çš„å“åº”
                const responses = [
                    'Sure, I\'ll help you analyze the genome data.',
                    '{"tool_name": "search_features", "parameters": {"query": "lacZ"}}',
                    'Based on your request, I need to execute several tools to get complete information.',
                    '<think>The user wants to analyze a genomic region. I need to first get sequence information, then analyze GC content.</think>This is a complex analysis request.'
                ];
                
                return responses[Math.floor(Math.random() * responses.length)];
            }
        }

        // æ¨¡æ‹Ÿçš„åº”ç”¨ç¨‹åº
        class MockApp {
            constructor() {
                this.genomeBrowser = {
                    currentChromosome: 'chr1',
                    currentPosition: { start: 1000, end: 2000 },
                    loadedFiles: ['genome.fasta'],
                    availableTools: ['navigate_to_position', 'search_features', 'get_sequence'],
                    toolSources: { local: 10, plugins: 5, mcp: 3 }
                };
            }
        }

        // åˆå§‹åŒ–æ¨¡æ‹Ÿç¯å¢ƒ
        const mockApp = new MockApp();
        const mockConfigManager = new MockConfigManager();
        
        // å…¨å±€å˜é‡
        window.LLMConfigManager = MockLLMConfigManager;
        window.MCPServerManager = class { 
            constructor() {}
            on() {}
        };
        window.PluginManager = class {
            constructor() {}
            on() {}
        };
        window.PluginFunctionCallsIntegrator = class {
            constructor() {}
        };
        window.SmartExecutor = class {
            constructor() {}
        };
        window.FunctionCallsOrganizer = class {
            constructor() {}
        };
    </script>

    <!-- åŠ è½½ChatManager -->
    <script src="src/renderer/modules/ChatManager.js"></script>

    <script>
        // åˆå§‹åŒ–å¢å¼ºçš„ChatManager
        const chatManager = new ChatManager(mockApp, mockConfigManager);
        
        // æµ‹è¯•å‡½æ•°
        function testThinkingProcess() {
            chatManager.showThinkingProcess = true;
            chatManager.addThinkingMessage('ğŸ”„ Starting genome data analysis...');
            setTimeout(() => {
                chatManager.updateThinkingMessage('ğŸ§¬ Detected gene sequence features');
            }, 1000);
            setTimeout(() => {
                chatManager.updateThinkingMessage('ğŸ“Š Calculating GC content and statistics');
            }, 2000);
            setTimeout(() => {
                chatManager.removeThinkingMessages();
            }, 4000);
        }
        
        function testToolCalls() {
            const mockTools = [
                { tool_name: 'get_sequence', parameters: { start: 1000, end: 2000 } },
                { tool_name: 'calculate_gc_content', parameters: { sequence: 'ATCG...' } }
            ];
            chatManager.addToolCallMessage(mockTools);
            
            setTimeout(() => {
                const mockResults = [
                    { tool: 'get_sequence', success: true, result: 'Retrieved 1000bp sequence' },
                    { tool: 'calculate_gc_content', success: true, result: 'GC content: 45.2%' }
                ];
                chatManager.addToolResultMessage(mockResults);
            }, 2000);
        }
        
        function testAbortFunction() {
            chatManager.startConversation();
            setTimeout(() => {
                alert('Click the red abort button to test abort functionality');
            }, 1000);
        }
        
        function testStatusMonitoring() {
            chatManager.startConversation();
            let round = 0;
            const interval = setInterval(() => {
                round++;
                chatManager.updateThinkingMessage(`ğŸ”„ Round ${round}/3 processing...`);
                if (round >= 3) {
                    clearInterval(interval);
                    chatManager.endConversation();
                }
            }, 1500);
        }
        
        function runComplexAnalysis() {
            const input = document.getElementById('chatInput');
            if (input) {
                input.value = 'Analyze gene density and GC content distribution in chr1:1000-5000 region, and find all restriction enzyme sites';
                chatManager.sendMessage();
            }
        }
        
        function runMultiToolQuery() {
            const input = document.getElementById('chatInput');
            if (input) {
                input.value = 'Search for lacZ gene in current region, get its sequence, calculate GC content, and find nearby operons';
                chatManager.sendMessage();
            }
        }
        
        function runLongRunningTask() {
            const input = document.getElementById('chatInput');
            if (input) {
                input.value = 'Execute whole-genome BLAST search and analyze homology';
                chatManager.sendMessage();
            }
        }
        
        function runErrorScenario() {
            const input = document.getElementById('chatInput');
            if (input) {
                input.value = 'Call non-existent tools with invalid parameters';
                chatManager.sendMessage();
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„æç¤º
        window.addEventListener('load', () => {
            setTimeout(() => {
                chatManager.addMessageToChat(
                    'ğŸ‰ Enhanced ChatBox features are ready!\n\nâœ¨ New features include:\nâ€¢ Complete thinking process display\nâ€¢ Tool call visualization\nâ€¢ Conversation abort control\nâ€¢ Intelligent state management\n\nTry sending complex genome analysis requests to experience the new features!', 
                    'assistant'
                );
            }, 1000);
        });
    </script>
</body>
</html> 