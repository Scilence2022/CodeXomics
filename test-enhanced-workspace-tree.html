<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Workspace Tree Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            background: #f8f9fa;
        }
        
        .test-section h3 {
            color: #667eea;
            margin-top: 0;
        }
        
        .status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 500;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f1b2b7;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #b6d4db;
        }
        
        #projectManagerFrame {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 12px;
            margin: 20px 0;
        }
        
        .test-controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .btn.primary {
            background: #667eea;
            color: white;
        }
        
        .btn.secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn.success {
            background: #28a745;
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ³ Enhanced Workspace Tree Test Suite</h1>
        <p>Testing the enhanced file tree functionality with expand/collapse and subfolder creation features.</p>
        
        <div class="test-section">
            <h3>ğŸ“‹ Test Checklist</h3>
            <div id="testResults">
                <div class="status info">â³ Initializing tests...</div>
            </div>
        </div>
        
        <div class="test-controls">
            <button class="btn primary" onclick="runFileTreeTests()">ğŸ§ª Run File Tree Tests</button>
            <button class="btn secondary" onclick="testExpandCollapse()">ğŸ“‚ Test Expand/Collapse</button>
            <button class="btn success" onclick="testSubfolderCreation()">ğŸ“ Test Subfolder Creation</button>
            <button class="btn primary" onclick="testRightClickMenus()">ğŸ–±ï¸ Test Context Menus</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ–¼ï¸ Project Manager Interface</h3>
            <iframe id="projectManagerFrame" src="src/project-manager.html"></iframe>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“ Test Details</h3>
            <div id="testDetails">
                <p>Click the test buttons above to run specific tests.</p>
            </div>
        </div>
    </div>

    <script>
        let testResults = [];
        let pmWindow = null;

        // ç­‰å¾…iframeåŠ è½½
        document.getElementById('projectManagerFrame').onload = function() {
            pmWindow = this.contentWindow;
            updateTestResults('âœ… Project Manager loaded successfully', 'success');
            setTimeout(() => {
                runInitialTests();
            }, 1000);
        };

        function updateTestResults(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            resultsDiv.appendChild(statusDiv);
            
            // ä¿æŒæœ€å¤š10ä¸ªç»“æœ
            const statusElements = resultsDiv.querySelectorAll('.status');
            if (statusElements.length > 10) {
                statusElements[0].remove();
            }
        }

        function updateTestDetails(details) {
            document.getElementById('testDetails').innerHTML = details;
        }

        async function runInitialTests() {
            updateTestResults('ğŸ”„ Running initial compatibility tests...', 'info');
            
            try {
                // æ£€æŸ¥ProjectManagerWindowç±»æ˜¯å¦å­˜åœ¨
                if (pmWindow.projectManagerWindow) {
                    updateTestResults('âœ… ProjectManagerWindow instance found', 'success');
                } else {
                    updateTestResults('âŒ ProjectManagerWindow instance not found', 'error');
                    return;
                }

                // æ£€æŸ¥å¢å¼ºæ–¹æ³•æ˜¯å¦å­˜åœ¨
                const requiredMethods = [
                    'renderProjectTree',
                    'renderFolderTree', 
                    'toggleProjectExpansion',
                    'toggleFolderExpansion',
                    'createSubfolderInPath',
                    'showCreateSubfolderModal',
                    'showProjectContextMenu',
                    'showFolderContextMenu'
                ];

                let methodsFound = 0;
                requiredMethods.forEach(method => {
                    if (typeof pmWindow.projectManagerWindow[method] === 'function') {
                        methodsFound++;
                    } else {
                        updateTestResults(`âŒ Method missing: ${method}`, 'error');
                    }
                });

                updateTestResults(`âœ… Found ${methodsFound}/${requiredMethods.length} required methods`, 
                    methodsFound === requiredMethods.length ? 'success' : 'error');

                // æ£€æŸ¥CSSç±»æ˜¯å¦å­˜åœ¨
                const pmDoc = pmWindow.document;
                const cssTests = [
                    '.tree-item-content',
                    '.tree-expander', 
                    '.tree-children',
                    '.context-menu',
                    '.tree-file-count'
                ];

                let cssFound = 0;
                cssTests.forEach(selector => {
                    try {
                        const element = pmDoc.querySelector(selector);
                        if (element !== null || pmDoc.styleSheets.length > 0) {
                            cssFound++;
                        }
                    } catch (e) {
                        // CSSå¯èƒ½è¿˜æœªåŠ è½½
                    }
                });

                updateTestResults(`âœ… CSS structure compatibility: ${cssFound}/${cssTests.length}`, 
                    cssFound >= 3 ? 'success' : 'info');

            } catch (error) {
                updateTestResults(`âŒ Initial test error: ${error.message}`, 'error');
            }
        }

        function runFileTreeTests() {
            updateTestResults('ğŸ§ª Running file tree structure tests...', 'info');
            
            try {
                const pmDoc = pmWindow.document;
                const projectTree = pmDoc.getElementById('projectTree');
                
                if (projectTree) {
                    updateTestResults('âœ… Project tree container found', 'success');
                    
                    // æ£€æŸ¥æ ‘ç»“æ„
                    const treeItems = projectTree.querySelectorAll('.tree-item');
                    updateTestResults(`ğŸ“Š Found ${treeItems.length} tree items`, 'info');
                    
                    // æ£€æŸ¥å±•å¼€å™¨
                    const expanders = projectTree.querySelectorAll('.tree-expander');
                    updateTestResults(`ğŸ”½ Found ${expanders.length} expander controls`, 'info');
                    
                    // æ£€æŸ¥æ–‡ä»¶è®¡æ•°æ˜¾ç¤º
                    const fileCounts = projectTree.querySelectorAll('.tree-file-count');
                    updateTestResults(`ğŸ”¢ Found ${fileCounts.length} file count indicators`, 'info');
                    
                    updateTestDetails(`
                        <h4>File Tree Structure Analysis</h4>
                        <ul>
                            <li><strong>Tree Items:</strong> ${treeItems.length} found</li>
                            <li><strong>Expander Controls:</strong> ${expanders.length} found</li>
                            <li><strong>File Count Indicators:</strong> ${fileCounts.length} found</li>
                            <li><strong>Context Menu Elements:</strong> ${pmDoc.querySelectorAll('.context-menu').length} found</li>
                        </ul>
                        <p><em>The enhanced tree structure provides hierarchical navigation with expand/collapse functionality.</em></p>
                    `);
                    
                } else {
                    updateTestResults('âŒ Project tree container not found', 'error');
                }
                
            } catch (error) {
                updateTestResults(`âŒ File tree test error: ${error.message}`, 'error');
            }
        }

        function testExpandCollapse() {
            updateTestResults('ğŸ“‚ Testing expand/collapse functionality...', 'info');
            
            try {
                if (pmWindow.projectManagerWindow.expandedProjects) {
                    updateTestResults('âœ… Expansion state management initialized', 'success');
                    
                    // æ¨¡æ‹Ÿæµ‹è¯•å±•å¼€çŠ¶æ€
                    const testProjectId = 'test-project';
                    pmWindow.projectManagerWindow.toggleProjectExpansion(testProjectId);
                    
                    const isExpanded = pmWindow.projectManagerWindow.expandedProjects.has(testProjectId);
                    updateTestResults(`âœ… Project expansion toggle: ${isExpanded ? 'Expanded' : 'Collapsed'}`, 'success');
                    
                    // æµ‹è¯•æ–‡ä»¶å¤¹å±•å¼€
                    const testFolderId = 'test/folder';
                    pmWindow.projectManagerWindow.toggleFolderExpansion(testFolderId);
                    
                    const folderExpanded = pmWindow.projectManagerWindow.expandedFolders && 
                                         pmWindow.projectManagerWindow.expandedFolders.has(testFolderId);
                    updateTestResults(`âœ… Folder expansion toggle: ${folderExpanded ? 'Expanded' : 'Collapsed'}`, 'success');
                    
                    updateTestDetails(`
                        <h4>Expand/Collapse Test Results</h4>
                        <ul>
                            <li><strong>Project Expansion:</strong> Working âœ…</li>
                            <li><strong>Folder Expansion:</strong> Working âœ…</li>
                            <li><strong>State Management:</strong> Functional âœ…</li>
                        </ul>
                        <p><em>Click the folder/project icons in the tree to test expand/collapse visually.</em></p>
                    `);
                    
                } else {
                    updateTestResults('âŒ Expansion state management not initialized', 'error');
                }
                
            } catch (error) {
                updateTestResults(`âŒ Expand/collapse test error: ${error.message}`, 'error');
            }
        }

        function testSubfolderCreation() {
            updateTestResults('ğŸ“ Testing subfolder creation functionality...', 'info');
            
            try {
                // æ£€æŸ¥åˆ›å»ºå­æ–‡ä»¶å¤¹çš„æ–¹æ³•
                if (typeof pmWindow.projectManagerWindow.createSubfolderInPath === 'function') {
                    updateTestResults('âœ… Subfolder creation method available', 'success');
                }
                
                if (typeof pmWindow.projectManagerWindow.showCreateSubfolderModal === 'function') {
                    updateTestResults('âœ… Enhanced subfolder modal available', 'success');
                }
                
                // æ£€æŸ¥æ¨¡æ€æ¡†å…ƒç´ 
                const pmDoc = pmWindow.document;
                const subfolderModal = pmDoc.getElementById('createSubfolderModal');
                if (subfolderModal) {
                    updateTestResults('âœ… Enhanced subfolder modal found in DOM', 'success');
                    
                    // æ£€æŸ¥æ¨¡æ€æ¡†çš„è¾“å…¥å­—æ®µ
                    const nameInput = pmDoc.getElementById('subfolderName');
                    const iconSelect = pmDoc.getElementById('subfolderIcon');
                    const descInput = pmDoc.getElementById('subfolderDescription');
                    
                    if (nameInput && iconSelect && descInput) {
                        updateTestResults('âœ… All modal input fields present', 'success');
                    } else {
                        updateTestResults('âš ï¸ Some modal input fields missing', 'error');
                    }
                } else {
                    updateTestResults('âŒ Enhanced subfolder modal not found', 'error');
                }
                
                updateTestDetails(`
                    <h4>Subfolder Creation Test Results</h4>
                    <ul>
                        <li><strong>Creation Method:</strong> Available âœ…</li>
                        <li><strong>Enhanced Modal:</strong> ${subfolderModal ? 'Found' : 'Missing'} ${subfolderModal ? 'âœ…' : 'âŒ'}</li>
                        <li><strong>Icon Selection:</strong> ${pmDoc.getElementById('subfolderIcon') ? 'Available' : 'Missing'} ${pmDoc.getElementById('subfolderIcon') ? 'âœ…' : 'âŒ'}</li>
                        <li><strong>Path Display:</strong> ${pmDoc.getElementById('currentFolderPath') ? 'Available' : 'Missing'} ${pmDoc.getElementById('currentFolderPath') ? 'âœ…' : 'âŒ'}</li>
                    </ul>
                    <p><em>Right-click on folders in the tree to access the "New Subfolder" option.</em></p>
                `);
                
            } catch (error) {
                updateTestResults(`âŒ Subfolder creation test error: ${error.message}`, 'error');
            }
        }

        function testRightClickMenus() {
            updateTestResults('ğŸ–±ï¸ Testing right-click context menus...', 'info');
            
            try {
                const pmDoc = pmWindow.document;
                
                // æ£€æŸ¥ä¸Šä¸‹æ–‡èœå•å…ƒç´ 
                const projectMenu = pmDoc.getElementById('projectContextMenu');
                const folderMenu = pmDoc.getElementById('folderContextMenu'); 
                const fileMenu = pmDoc.getElementById('fileContextMenu');
                
                let menuCount = 0;
                if (projectMenu) {
                    menuCount++;
                    updateTestResults('âœ… Project context menu found', 'success');
                }
                if (folderMenu) {
                    menuCount++;
                    updateTestResults('âœ… Folder context menu found', 'success');
                }
                if (fileMenu) {
                    menuCount++;
                    updateTestResults('âœ… File context menu found', 'success');
                }
                
                // æ£€æŸ¥èœå•æ–¹æ³•
                const menuMethods = [
                    'showProjectContextMenu',
                    'showFolderContextMenu', 
                    'hideContextMenus'
                ];
                
                let methodCount = 0;
                menuMethods.forEach(method => {
                    if (typeof pmWindow.projectManagerWindow[method] === 'function') {
                        methodCount++;
                    }
                });
                
                updateTestResults(`âœ… Found ${methodCount}/${menuMethods.length} context menu methods`, 
                    methodCount === menuMethods.length ? 'success' : 'error');
                
                updateTestDetails(`
                    <h4>Context Menu Test Results</h4>
                    <ul>
                        <li><strong>Project Menu:</strong> ${projectMenu ? 'Found' : 'Missing'} ${projectMenu ? 'âœ…' : 'âŒ'}</li>
                        <li><strong>Folder Menu:</strong> ${folderMenu ? 'Found' : 'Missing'} ${folderMenu ? 'âœ…' : 'âŒ'}</li>
                        <li><strong>File Menu:</strong> ${fileMenu ? 'Found' : 'Missing'} ${fileMenu ? 'âœ…' : 'âŒ'}</li>
                        <li><strong>Menu Methods:</strong> ${methodCount}/${menuMethods.length} available</li>
                        <li><strong>Total Menus:</strong> ${menuCount}/3 implemented</li>
                    </ul>
                    <p><em>Right-click on items in the workspace tree to test context menus.</em></p>
                `);
                
            } catch (error) {
                updateTestResults(`âŒ Context menu test error: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateTestResults('ğŸš€ Enhanced Workspace Tree Test Suite initialized', 'info');
        });
    </script>
</body>
</html> 