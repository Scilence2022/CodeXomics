<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom LLM Tab Test</title>
    <link rel="stylesheet" href="src/renderer/styles.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-header {
            background: #667eea;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-button {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #5a6fd8;
        }
        .success {
            color: #28a745;
            font-weight: bold;
        }
        .error {
            color: #dc3545;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>🧬 Genome AI Studio - Custom LLM Tab Test</h1>
            <p>Testing the new custom LLM provider configuration tab</p>
        </div>

        <div class="test-section">
            <h2>Test 1: LLM Configuration Modal</h2>
            <p>Click the button below to open the LLM configuration modal and verify the new "用户自定义" tab appears:</p>
            <button class="test-button" onclick="showLLMConfigModal()">Open Configure LLMs Modal</button>
            <div id="test1-result"></div>
        </div>

        <div class="test-section">
            <h2>Test 2: Custom Tab UI Elements</h2>
            <p>This test will check if all UI elements in the custom tab are working correctly:</p>
            <button class="test-button" onclick="testCustomTabElements()">Test Custom Tab Elements</button>
            <div id="test2-result"></div>
        </div>

        <div class="test-section">
            <h2>Test 3: Configuration Save/Load</h2>
            <p>Test saving and loading custom provider configuration:</p>
            <button class="test-button" onclick="testSaveLoadConfig()">Test Save/Load Configuration</button>
            <div id="test3-result"></div>
        </div>

        <div class="test-section">
            <h2>Test Results Summary</h2>
            <div id="test-summary">
                <p>Run the tests above to see results here.</p>
            </div>
        </div>
    </div>

    <!-- LLM Configuration Modal (copied from main HTML) -->
    <div id="llmConfigModal" class="modal">
        <div class="modal-content llm-config-modal">
            <div class="modal-header">
                <h3>Configure LLMs</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="llm-provider-tabs">
                    <button class="tab-button active" data-provider="openai">OpenAI</button>
                    <button class="tab-button" data-provider="anthropic">Anthropic</button>
                    <button class="tab-button" data-provider="google">Google</button>
                    <button class="tab-button" data-provider="deepseek">DeepSeek</button>
                    <button class="tab-button" data-provider="siliconflow">SiliconFlow</button>
                    <button class="tab-button" data-provider="local">Local LLM</button>
                    <button class="tab-button" data-provider="custom">用户自定义</button>
                </div>
                
                <div class="llm-provider-config">
                    <!-- Custom LLM Configuration -->
                    <div id="custom-config" class="provider-config">
                        <div class="form-group">
                            <label for="customProviderName">Provider Name:</label>
                            <input type="text" id="customProviderName" placeholder="My Custom Provider" class="input-full">
                            <small class="help-text">A friendly name for your custom LLM provider</small>
                        </div>
                        <div class="form-group">
                            <label for="customApiKey">API Key:</label>
                            <div class="input-with-button">
                                <input type="password" id="customApiKey" placeholder="Enter your API key" class="input-full">
                                <button type="button" class="btn btn-sm btn-paste" id="pasteCustomApiKeyBtn" title="Paste API Key">
                                    <i class="fas fa-paste"></i>
                                </button>
                            </div>
                            <small class="help-text">API key for your custom provider</small>
                        </div>
                        <div class="form-group">
                            <label for="customModel">Model Name:</label>
                            <input type="text" id="customModel" placeholder="gpt-4" class="input-full">
                            <small class="help-text">Model identifier for your custom provider</small>
                        </div>
                        <div class="form-group">
                            <label for="customBaseUrl">Base URL:</label>
                            <input type="text" id="customBaseUrl" placeholder="https://api.example.com/v1" class="input-full">
                            <small class="help-text">Base URL for your custom provider's API</small>
                        </div>
                        <div class="form-group">
                            <label for="customApiFormat">API Format:</label>
                            <select id="customApiFormat" class="select">
                                <option value="openai">OpenAI Compatible</option>
                                <option value="anthropic">Anthropic Compatible</option>
                                <option value="google">Google Compatible</option>
                                <option value="custom">Custom Format</option>
                            </select>
                            <small class="help-text">Choose the API format your custom provider uses</small>
                        </div>
                        <div class="form-group">
                            <label for="customHeaders">Custom Headers (JSON):</label>
                            <textarea id="customHeaders" placeholder='{"Authorization": "Bearer token", "Content-Type": "application/json"}' class="input-full" rows="3"></textarea>
                            <small class="help-text">Optional: Custom HTTP headers as JSON object</small>
                        </div>
                        <div class="form-group">
                            <label for="customMaxTokens">Max Tokens:</label>
                            <input type="number" id="customMaxTokens" placeholder="4096" min="1" max="200000" class="input-full">
                            <small class="help-text">Maximum number of tokens for responses</small>
                        </div>
                        <div class="form-group">
                            <label for="customTemperature">Temperature:</label>
                            <input type="range" id="customTemperature" min="0" max="2" step="0.1" value="0.7" class="slider">
                            <div class="slider-value">
                                <span id="customTemperatureValue">0.7</span>
                                <small>(0.0 = Deterministic, 2.0 = Very creative)</small>
                            </div>
                            <small class="help-text">Controls randomness in responses</small>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="customStreamingSupport"> Streaming Support
                            </label>
                            <small class="help-text">Enable if your provider supports streaming responses</small>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveLLMConfigBtn" class="btn btn-primary">Save Configuration</button>
                <button class="btn modal-close">Cancel</button>
            </div>
        </div>
    </div>

    <script src="src/renderer/modules/ConfigManager.js"></script>
    <script src="src/renderer/modules/LLMConfigManager.js"></script>
    <script>
        let testResults = {
            test1: null,
            test2: null,
            test3: null
        };

        // Initialize LLM Config Manager
        const configManager = new ConfigManager();
        const llmConfigManager = new LLMConfigManager(configManager);

        function showLLMConfigModal() {
            const modal = document.getElementById('llmConfigModal');
            modal.classList.add('show');
            
            // Set up tab switching
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    // Update tab buttons
                    document.querySelectorAll('.tab-button').forEach(btn => {
                        btn.classList.toggle('active', btn.dataset.provider === button.dataset.provider);
                    });

                    // Update provider config panels
                    document.querySelectorAll('.provider-config').forEach(panel => {
                        panel.classList.toggle('active', panel.id === `${button.dataset.provider}-config`);
                    });
                });
            });

            // Set up close handlers
            document.querySelectorAll('.modal-close').forEach(btn => {
                btn.addEventListener('click', () => {
                    modal.classList.remove('show');
                });
            });

            // Check if custom tab exists
            const customTab = document.querySelector('[data-provider="custom"]');
            const result = document.getElementById('test1-result');
            if (customTab) {
                result.innerHTML = '<p class="success">✅ Custom tab found successfully!</p>';
                testResults.test1 = true;
            } else {
                result.innerHTML = '<p class="error">❌ Custom tab not found!</p>';
                testResults.test1 = false;
            }
            updateTestSummary();
        }

        function testCustomTabElements() {
            const elements = [
                'customProviderName',
                'customApiKey',
                'customModel',
                'customBaseUrl',
                'customApiFormat',
                'customHeaders',
                'customMaxTokens',
                'customTemperature',
                'customTemperatureValue',
                'customStreamingSupport'
            ];

            let found = 0;
            let missing = [];

            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    found++;
                } else {
                    missing.push(id);
                }
            });

            const result = document.getElementById('test2-result');
            if (missing.length === 0) {
                result.innerHTML = `<p class="success">✅ All ${found} custom tab elements found!</p>`;
                testResults.test2 = true;
            } else {
                result.innerHTML = `<p class="error">❌ Missing elements: ${missing.join(', ')}</p>`;
                testResults.test2 = false;
            }

            // Test temperature slider functionality
            const slider = document.getElementById('customTemperature');
            const valueDisplay = document.getElementById('customTemperatureValue');
            if (slider && valueDisplay) {
                slider.addEventListener('input', (e) => {
                    valueDisplay.textContent = parseFloat(e.target.value).toFixed(1);
                });
                result.innerHTML += '<p class="success">✅ Temperature slider functionality added!</p>';
            }

            updateTestSummary();
        }

        function testSaveLoadConfig() {
            try {
                // Test configuration structure
                const testConfig = {
                    providerName: 'Test Provider',
                    apiKey: 'test-key-123',
                    model: 'test-model',
                    baseUrl: 'https://api.test.com/v1',
                    apiFormat: 'openai',
                    customHeaders: {'Test-Header': 'test-value'},
                    maxTokens: 2048,
                    temperature: 0.8,
                    streamingSupport: true
                };

                // Test if we can access the provider configuration
                const customProvider = llmConfigManager.providers.custom;
                
                const result = document.getElementById('test3-result');
                if (customProvider) {
                    result.innerHTML = '<p class="success">✅ Custom provider configuration structure is accessible!</p>';
                    result.innerHTML += `<p>Default configuration: ${JSON.stringify(customProvider, null, 2)}</p>`;
                    testResults.test3 = true;
                } else {
                    result.innerHTML = '<p class="error">❌ Custom provider configuration not found!</p>';
                    testResults.test3 = false;
                }
            } catch (error) {
                const result = document.getElementById('test3-result');
                result.innerHTML = `<p class="error">❌ Error testing configuration: ${error.message}</p>`;
                testResults.test3 = false;
            }

            updateTestSummary();
        }

        function updateTestSummary() {
            const summary = document.getElementById('test-summary');
            const total = Object.keys(testResults).length;
            const passed = Object.values(testResults).filter(result => result === true).length;
            const failed = Object.values(testResults).filter(result => result === false).length;
            const pending = total - passed - failed;

            let html = '<h3>Test Summary</h3>';
            html += `<p><strong>Total Tests:</strong> ${total}</p>`;
            html += `<p><strong>Passed:</strong> <span class="success">${passed}</span></p>`;
            html += `<p><strong>Failed:</strong> <span class="error">${failed}</span></p>`;
            html += `<p><strong>Pending:</strong> ${pending}</p>`;

            if (failed === 0 && pending === 0) {
                html += '<p class="success">🎉 All tests passed! Custom LLM tab is working correctly.</p>';
            } else if (failed > 0) {
                html += '<p class="error">⚠️ Some tests failed. Please check the implementation.</p>';
            } else {
                html += '<p>🔄 Run all tests to see complete results.</p>';
            }

            summary.innerHTML = html;
        }

        // Initialize test summary
        updateTestSummary();

        console.log('Custom LLM Tab Test initialized');
        console.log('LLM Config Manager:', llmConfigManager);
        console.log('Available providers:', Object.keys(llmConfigManager.providers));
    </script>
</body>
</html> 