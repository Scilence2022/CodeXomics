<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Rename Function</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .container { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .btn { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #0056b3; }
        .file-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; }
        .log { background: #f8f9fa; border: 1px solid #ddd; border-radius: 5px; padding: 10px; margin: 10px 0; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Rename Function Test</h1>
        <p>This page tests the rename functionality in isolation to identify issues.</p>
        
        <button class="btn" onclick="createTestData()">Create Test Data</button>
        <button class="btn" onclick="clearLog()">Clear Log</button>
        
        <div id="fileList"></div>
        
        <h3>Debug Log:</h3>
        <div id="debugLog" class="log">Ready for testing...<br></div>
    </div>

    <script>
        class TestProjectManager {
            constructor() {
                this.currentProject = null;
                this.log('‚úÖ Test Manager initialized');
            }
            
            log(message) {
                const logElement = document.getElementById('debugLog');
                const timestamp = new Date().toLocaleTimeString();
                logElement.innerHTML += '[' + timestamp + '] ' + message + '<br>';
                logElement.scrollTop = logElement.scrollHeight;
                console.log(message);
            }
            
            showNotification(message, type) {
                this.log('ÔøΩÔøΩ ' + type.toUpperCase() + ': ' + message);
                alert(type.toUpperCase() + ': ' + message);
            }
            
            generateId() {
                return 'test_' + Math.random().toString(36).substr(2, 9);
            }
            
            createTestProject() {
                this.log('üß™ Creating test project...');
                
                this.currentProject = {
                    id: this.generateId(),
                    name: 'Test Project',
                    files: [
                        { id: this.generateId(), name: 'sample.fasta', size: 1024, type: 'fasta' },
                        { id: this.generateId(), name: 'annotations.gff', size: 2048, type: 'gff' },
                        { id: this.generateId(), name: 'variants.vcf', size: 4096, type: 'vcf' }
                    ],
                    hasUnsavedChanges: false
                };
                
                this.log('‚úÖ Test project created with ' + this.currentProject.files.length + ' files');
                this.renderFileList();
            }
            
            renderFileList() {
                const fileListElement = document.getElementById('fileList');
                
                if (!this.currentProject || !this.currentProject.files.length) {
                    fileListElement.innerHTML = '<p>No files to display. Click "Create Test Data" first.</p>';
                    return;
                }
                
                let html = '<h3>üìÅ Test Files:</h3>';
                this.currentProject.files.forEach(file => {
                    html += '<div class="file-item">' +
                           '<span>' + file.name + ' (' + file.type + ')</span>' +
                           '<button onclick="testManager.renameFile(\'' + file.id + '\')">‚úèÔ∏è Rename</button>' +
                           '</div>';
                });
                
                fileListElement.innerHTML = html;
                this.log('üìã File list rendered with ' + this.currentProject.files.length + ' files');
            }
            
            async renameFile(fileId) {
                this.log('‚úèÔ∏è renameFile() called with ID: ' + fileId);
                
                if (!this.currentProject) {
                    this.showNotification('No project selected', 'error');
                    return;
                }

                const file = this.currentProject.files.find(f => f.id === fileId);
                if (!file) {
                    this.showNotification('File not found', 'error');
                    return;
                }

                this.log('üìÅ Found file: ' + file.name);

                const newName = prompt('Enter new file name:', file.name);
                if (!newName || newName.trim() === '' || newName.trim() === file.name) {
                    this.log('‚ùå Rename cancelled or no change');
                    return;
                }

                this.log('üìù New name entered: ' + newName.trim());

                const existingFile = this.currentProject.files.find(f => f.name === newName.trim() && f.id !== fileId);
                if (existingFile) {
                    this.showNotification('A file with this name already exists', 'error');
                    return;
                }

                try {
                    const oldName = file.name;
                    file.name = newName.trim();
                    file.modified = new Date().toISOString();
                    
                    this.log('‚úÖ File renamed from "' + oldName + '" to "' + file.name + '"');
                    
                    this.markProjectAsModified();
                    this.renderFileList();
                    
                    this.showNotification('File renamed to "' + newName.trim() + '"', 'success');
                    
                } catch (error) {
                    this.log('‚ùå Error renaming file: ' + error.message);
                    this.showNotification('Failed to rename file: ' + error.message, 'error');
                }
            }
            
            markProjectAsModified() {
                if (this.currentProject) {
                    this.currentProject.hasUnsavedChanges = true;
                    this.currentProject.modified = new Date().toISOString();
                    this.log('üìù Project marked as modified');
                }
            }
            
            clearLog() {
                document.getElementById('debugLog').innerHTML = 'Log cleared...<br>';
                this.log('üßπ Log cleared');
            }
        }
        
        const testManager = new TestProjectManager();
        
        function createTestData() {
            testManager.createTestProject();
        }
        
        function clearLog() {
            testManager.clearLog();
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            testManager.log('üöÄ Rename Function Test Page Ready');
        });
    </script>
</body>
</html>
