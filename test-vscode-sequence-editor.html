<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VS Code Sequence Editor Test - Genome AI Studio</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .test-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 30px;
            text-align: center;
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .editor-container {
            height: 600px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            margin: 20px 0;
            background: #1e1e1e;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .info-panel {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .info-panel h3 {
            color: #1976d2;
            margin-top: 0;
        }
        
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .feature-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
        }
        
        .feature-item h4 {
            margin-top: 0;
            color: #495057;
        }
        
        .status-display {
            background: #2d3748;
            color: #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîß VS Code Sequence Editor Test</h1>
        
        <div class="info-panel">
            <h3>üöÄ Enhanced Sequence Visualization</h3>
            <p>This test demonstrates the new VS Code-style sequence editor with improved performance and user experience:</p>
            <ul>
                <li><strong>Virtual Scrolling:</strong> Smooth performance with large sequences</li>
                <li><strong>Syntax Highlighting:</strong> Color-coded bases and features</li>
                <li><strong>Text Selection:</strong> Click and drag to select sequences</li>
                <li><strong>Keyboard Navigation:</strong> Arrow keys, Home/End, Page Up/Down</li>
                <li><strong>Search Integration:</strong> Find sequences with highlighting</li>
                <li><strong>Copy/Paste:</strong> Standard keyboard shortcuts</li>
            </ul>
        </div>
        
        <div class="controls">
            <button class="btn" onclick="loadSampleSequence()">Load Sample Sequence</button>
            <button class="btn" onclick="testNavigation()">Test Navigation</button>
            <button class="btn" onclick="testSelection()">Test Selection</button>
            <button class="btn" onclick="testSearch()">Test Search</button>
            <button class="btn" onclick="testFeatures()">Add Features</button>
            <button class="btn" onclick="exportSequence()">Export Sequence</button>
        </div>
        
        <div class="editor-container" id="editorContainer"></div>
        
        <div class="feature-list">
            <div class="feature-item">
                <h4>üéØ Virtual Scrolling</h4>
                <p>Renders only visible lines for smooth performance with large sequences (millions of bases)</p>
            </div>
            <div class="feature-item">
                <h4>üé® Syntax Highlighting</h4>
                <p>Color-coded DNA bases (A, T, G, C) and feature annotations with VS Code-like themes</p>
            </div>
            <div class="feature-item">
                <h4>‚å®Ô∏è Keyboard Shortcuts</h4>
                <p>Ctrl+A (Select All), Ctrl+C (Copy), Ctrl+F (Search), Arrow keys for navigation</p>
            </div>
            <div class="feature-item">
                <h4>üîç Search & Replace</h4>
                <p>Find DNA patterns with highlighting, case-sensitive options, regex support</p>
            </div>
            <div class="feature-item">
                <h4>üìè Position Ruler</h4>
                <p>Shows base positions with markers every 10/50 bases for easy navigation</p>
            </div>
            <div class="feature-item">
                <h4>üñ±Ô∏è Mouse Interaction</h4>
                <p>Click to position cursor, drag to select, scroll wheel for navigation</p>
            </div>
        </div>
        
        <div class="status-display" id="statusDisplay">
            Editor Status: Ready
        </div>
    </div>

    <!-- Load the VS Code Sequence Editor -->
    <script src="src/renderer/modules/VSCodeSequenceEditor.js"></script>
    
    <script>
        let editor = null;
        let mockGenomeBrowser = {
            showNotification: (message, type) => {
                updateStatus(`Notification: ${message} (${type})`);
            }
        };
        
        function updateStatus(message) {
            document.getElementById('statusDisplay').textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        }
        
        function initializeEditor() {
            const container = document.getElementById('editorContainer');
            editor = new VSCodeSequenceEditor(container, mockGenomeBrowser);
            updateStatus('VS Code Sequence Editor initialized');
        }
        
        function loadSampleSequence() {
            if (!editor) {
                initializeEditor();
            }
            
            // Generate a sample DNA sequence with features
            const sequence = generateSampleSequence(5000);
            const annotations = generateSampleAnnotations();
            
            editor.updateSequence('chr1', sequence, 0, sequence.length, annotations);
            updateStatus(`Loaded sample sequence: ${sequence.length} bases with ${annotations.length} features`);
        }
        
        function generateSampleSequence(length) {
            const bases = ['A', 'T', 'G', 'C'];
            let sequence = '';
            
            for (let i = 0; i < length; i++) {
                sequence += bases[Math.floor(Math.random() * bases.length)];
            }
            
            return sequence;
        }
        
        function generateSampleAnnotations() {
            const annotations = [];
            const types = ['gene', 'CDS', 'mRNA', 'rRNA', 'tRNA'];
            
            // Generate 20 random features
            for (let i = 0; i < 20; i++) {
                const start = Math.floor(Math.random() * 4500);
                const end = start + Math.floor(Math.random() * 500) + 50;
                const type = types[Math.floor(Math.random() * types.length)];
                
                annotations.push({
                    start: start,
                    end: end,
                    type: type,
                    strand: Math.random() > 0.5 ? 1 : -1,
                    qualifiers: {
                        gene: `gene_${i + 1}`,
                        locus_tag: `locus_${i + 1}`
                    }
                });
            }
            
            return annotations.sort((a, b) => a.start - b.start);
        }
        
        function testNavigation() {
            if (!editor) {
                updateStatus('Please load a sequence first');
                return;
            }
            
            // Test various navigation methods
            updateStatus('Testing navigation...');
            
            setTimeout(() => {
                editor.goToPosition(1000);
                updateStatus('Navigated to position 1000');
            }, 500);
            
            setTimeout(() => {
                editor.moveToStart();
                updateStatus('Moved to start of sequence');
            }, 1500);
            
            setTimeout(() => {
                editor.moveToEnd();
                updateStatus('Moved to end of sequence');
            }, 2500);
        }
        
        function testSelection() {
            if (!editor) {
                updateStatus('Please load a sequence first');
                return;
            }
            
            // Test selection functionality
            editor.selectionStart = 100;
            editor.selectionEnd = 200;
            editor.render();
            
            updateStatus('Selected bases 100-200. Try Ctrl+C to copy selection.');
        }
        
        function testSearch() {
            if (!editor) {
                updateStatus('Please load a sequence first');
                return;
            }
            
            // Test search functionality
            const query = 'ATCG';
            const results = editor.search(query);
            
            if (results.length > 0) {
                editor.highlightSearchResults(results);
                updateStatus(`Found ${results.length} matches for "${query}"`);
            } else {
                updateStatus(`No matches found for "${query}"`);
            }
        }
        
        function testFeatures() {
            if (!editor) {
                updateStatus('Please load a sequence first');
                return;
            }
            
            // Add some test features
            const newAnnotations = editor.annotations.concat([
                {
                    start: 500,
                    end: 800,
                    type: 'promoter',
                    strand: 1,
                    qualifiers: { gene: 'test_promoter' }
                },
                {
                    start: 1200,
                    end: 1500,
                    type: 'terminator',
                    strand: -1,
                    qualifiers: { gene: 'test_terminator' }
                }
            ]);
            
            editor.annotations = newAnnotations;
            editor.render();
            
            updateStatus('Added test promoter and terminator features');
        }
        
        function exportSequence() {
            if (!editor) {
                updateStatus('Please load a sequence first');
                return;
            }
            
            // Create export data
            const exportData = {
                sequence: editor.sequence,
                chromosome: editor.chromosome,
                start: editor.viewStart,
                end: editor.viewEnd,
                annotations: editor.annotations,
                timestamp: new Date().toISOString()
            };
            
            // Create download
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `sequence_export_${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            updateStatus('Sequence exported to JSON file');
        }
        
        // Keyboard shortcuts for testing
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case '1':
                        loadSampleSequence();
                        e.preventDefault();
                        break;
                    case '2':
                        testNavigation();
                        e.preventDefault();
                        break;
                    case '3':
                        testSelection();
                        e.preventDefault();
                        break;
                    case '4':
                        testSearch();
                        e.preventDefault();
                        break;
                }
            }
        });
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            updateStatus('VS Code Sequence Editor Test loaded. Use Ctrl+1-4 for quick tests.');
        });
    </script>
</body>
</html> 