<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸºå› ç»„ä¸‹è½½ä¸é¡¹ç›®é›†æˆæµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .test-section h2 {
            color: #34495e;
            margin-top: 0;
        }
        
        .button {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
        }
        
        .button.success {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        }
        
        .button.warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }
        
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .status.info {
            background: #cce7ff;
            color: #0c5460;
            border: 1px solid #b8daff;
        }
        
        .log {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 15px;
        }
        
        .info-box {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .info-box h3 {
            margin: 0 0 10px 0;
            color: #1976d2;
        }
        
        .workflow {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .workflow-step {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .workflow-step h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        
        .workflow-step .step-number {
            background: #3498db;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px auto;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§¬ğŸ“ åŸºå› ç»„ä¸‹è½½ä¸é¡¹ç›®é›†æˆæµ‹è¯•</h1>
        
        <div class="info-box">
            <h3>ğŸ” æµ‹è¯•ç›®æ ‡</h3>
            <p>éªŒè¯åŸºå› ç»„æ•°æ®ä¸‹è½½åŠŸèƒ½ä¸é¡¹ç›®ç®¡ç†ç³»ç»Ÿçš„å®Œæ•´é›†æˆï¼Œç¡®ä¿ä¸‹è½½çš„æ–‡ä»¶æ­£ç¡®ä¿å­˜åˆ°é¡¹ç›®æ–‡ä»¶å¤¹ä¸­ã€‚</p>
        </div>
        
        <div class="workflow">
            <div class="workflow-step">
                <div class="step-number">1</div>
                <h4>é¡¹ç›®æ£€æŸ¥</h4>
                <p>éªŒè¯æ˜¯å¦éœ€è¦å…ˆåˆ›å»ºæˆ–æ‰“å¼€é¡¹ç›®</p>
            </div>
            <div class="workflow-step">
                <div class="step-number">2</div>
                <h4>èœå•è®¿é—®</h4>
                <p>é€šè¿‡Fileèœå•è®¿é—®ä¸‹è½½åŠŸèƒ½</p>
            </div>
            <div class="workflow-step">
                <div class="step-number">3</div>
                <h4>é¡¹ç›®é›†æˆ</h4>
                <p>éªŒè¯é¡¹ç›®ä¿¡æ¯æ˜¾ç¤ºå’Œè·¯å¾„è®¾ç½®</p>
            </div>
            <div class="workflow-step">
                <div class="step-number">4</div>
                <h4>æ•°æ®ä¸‹è½½</h4>
                <p>æ‰§è¡Œå®é™…çš„æ•°æ®ä¸‹è½½æµ‹è¯•</p>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ—‚ï¸ é¡¹ç›®çŠ¶æ€æ£€æŸ¥</h2>
            <p>é¦–å…ˆæ£€æŸ¥å½“å‰æ˜¯å¦æœ‰æ´»åŠ¨é¡¹ç›®ï¼Œä»¥åŠé¡¹ç›®é›†æˆåŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</p>
            <button class="button" onclick="checkProjectStatus()">æ£€æŸ¥é¡¹ç›®çŠ¶æ€</button>
            <button class="button warning" onclick="testWithoutProject()">æµ‹è¯•æ— é¡¹ç›®çŠ¶æ€</button>
            <div id="projectStatus"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“‹ èœå•åŠŸèƒ½æµ‹è¯•</h2>
            <p>æµ‹è¯•ä»Fileèœå•è®¿é—®å„ç§åŸºå› ç»„æ•°æ®åº“çš„åŠŸèƒ½ã€‚</p>
            <div class="status info">
                <strong>æµ‹è¯•æ­¥éª¤ï¼š</strong><br>
                1. æ‰“å¼€ File â†’ Download Genomic Data<br>
                2. é€‰æ‹©ä»»æ„æ•°æ®åº“ç±»å‹<br>
                3. éªŒè¯æ˜¯å¦æ­£ç¡®æ˜¾ç¤ºé¡¹ç›®è¦æ±‚å¯¹è¯æ¡†<br>
                4. éªŒè¯é¡¹ç›®é€‰æ‹©åæ˜¯å¦æ­£ç¡®æ‰“å¼€ä¸‹è½½ç•Œé¢
            </div>
            <button class="button success" onclick="testMenuAccess('ncbi-genbank')">æµ‹è¯• NCBI GenBank</button>
            <button class="button success" onclick="testMenuAccess('embl-sequences')">æµ‹è¯• EMBL Sequences</button>
            <button class="button success" onclick="testMenuAccess('uniprot-proteins')">æµ‹è¯• UniProt</button>
        </div>
        
        <div class="test-section">
            <h2>ğŸ”— é¡¹ç›®é›†æˆåŠŸèƒ½</h2>
            <p>æµ‹è¯•ä¸‹è½½åŠŸèƒ½ä¸é¡¹ç›®ç³»ç»Ÿçš„é›†æˆï¼ŒåŒ…æ‹¬è·¯å¾„è®¾ç½®å’Œæ–‡ä»¶ç»„ç»‡ã€‚</p>
            <button class="button" onclick="testProjectIntegration()">æµ‹è¯•é¡¹ç›®ä¿¡æ¯é›†æˆ</button>
            <button class="button" onclick="testDownloadPath()">æµ‹è¯•ä¸‹è½½è·¯å¾„è®¾ç½®</button>
            <div id="integrationStatus"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“¥ ä¸‹è½½åŠŸèƒ½æµ‹è¯•</h2>
            <p>æµ‹è¯•å®é™…çš„æ–‡ä»¶ä¸‹è½½åŠŸèƒ½ï¼ŒéªŒè¯æ–‡ä»¶æ˜¯å¦æ­£ç¡®ä¿å­˜åˆ°é¡¹ç›®ç›®å½•ä¸­ã€‚</p>
            <button class="button success" onclick="testDownloadToProject()">æµ‹è¯•ä¸‹è½½åˆ°é¡¹ç›®</button>
            <button class="button" onclick="checkDownloadedFiles()">æ£€æŸ¥å·²ä¸‹è½½æ–‡ä»¶</button>
            <div id="downloadStatus"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ”§ APIè¿æ¥æµ‹è¯•</h2>
            <p>éªŒè¯ä¸å„ä¸ªå…¬å…±æ•°æ®åº“çš„APIè¿æ¥çŠ¶æ€ã€‚</p>
            <button class="button" onclick="testAllAPIs()">æµ‹è¯•æ‰€æœ‰APIè¿æ¥</button>
            <div id="apiStatus"></div>
        </div>
        
        <div class="log" id="testLog">æµ‹è¯•æ—¥å¿—å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</div>
    </div>

    <script>
        let logElement = document.getElementById('testLog');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }
        
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = `<div class="status ${type}">${message}</div>`;
            }
        }
        
        async function checkProjectStatus() {
            log('ğŸ” æ£€æŸ¥å½“å‰é¡¹ç›®çŠ¶æ€...');
            
            if (window.electronAPI && window.electronAPI.getCurrentProject) {
                try {
                    const project = await window.electronAPI.getCurrentProject();
                    if (project) {
                        log(`âœ… æ‰¾åˆ°æ´»åŠ¨é¡¹ç›®: ${project.name}`);
                        log(`ğŸ“ é¡¹ç›®ä½ç½®: ${project.location || 'Not set'}`);
                        log(`ğŸ’¾ æ•°æ®æ–‡ä»¶å¤¹: ${project.dataFolderPath || 'Not set'}`);
                        showStatus('projectStatus', 
                            `æ´»åŠ¨é¡¹ç›®ï¼š${project.name}<br>æ•°æ®æ–‡ä»¶å¤¹ï¼š${project.dataFolderPath}`, 
                            'success');
                    } else {
                        log('âš ï¸ æœªæ‰¾åˆ°æ´»åŠ¨é¡¹ç›®');
                        showStatus('projectStatus', 'æœªæ‰¾åˆ°æ´»åŠ¨é¡¹ç›®ã€‚è¯·å…ˆåˆ›å»ºæˆ–æ‰“å¼€ä¸€ä¸ªé¡¹ç›®ã€‚', 'warning');
                    }
                } catch (error) {
                    log(`âŒ æ£€æŸ¥é¡¹ç›®çŠ¶æ€æ—¶å‡ºé”™: ${error.message}`);
                    showStatus('projectStatus', `é”™è¯¯ï¼š${error.message}`, 'error');
                }
            } else {
                log('âŒ electronAPIä¸å¯ç”¨');
                showStatus('projectStatus', 'electronAPIä¸å¯ç”¨ï¼Œéœ€è¦åœ¨Electronç¯å¢ƒä¸­è¿è¡Œ', 'error');
            }
        }
        
        function testWithoutProject() {
            log('ğŸ§ª æµ‹è¯•æ— é¡¹ç›®çŠ¶æ€ä¸‹çš„è¡Œä¸º...');
            log('ğŸ“ é¢„æœŸè¡Œä¸ºï¼š');
            log('   1. ç‚¹å‡»File â†’ Download Genomic Data â†’ ä»»æ„æ•°æ®åº“');
            log('   2. åº”è¯¥æ˜¾ç¤º"Project Required"å¯¹è¯æ¡†');
            log('   3. æä¾›åˆ›å»ºæ–°é¡¹ç›®æˆ–æ‰“å¼€ç°æœ‰é¡¹ç›®çš„é€‰é¡¹');
            log('   4. å–æ¶ˆæ“ä½œåº”è¯¥ä¸æ‰“å¼€ä¸‹è½½çª—å£');
            showStatus('projectStatus', 'è¯·æ‰‹åŠ¨æµ‹è¯•ï¼šå°è¯•åœ¨æ²¡æœ‰é¡¹ç›®æ—¶è®¿é—®ä¸‹è½½åŠŸèƒ½', 'info');
        }
        
        function testMenuAccess(downloadType) {
            log(`ğŸ” æµ‹è¯•èœå•è®¿é—®: ${downloadType}`);
            log(`ğŸ“ æ“ä½œæ­¥éª¤ï¼š`);
            log(`   1. æ‰“å¼€ File â†’ Download Genomic Data`);
            log(`   2. é€‰æ‹© ${downloadType.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}`);
            log(`   3. éªŒè¯é¡¹ç›®æ£€æŸ¥å’Œçª—å£æ‰“å¼€`);
            log(`ğŸ¯ é¢„æœŸç»“æœï¼š`);
            log(`   - å¦‚æœæœ‰é¡¹ç›®ï¼šç›´æ¥æ‰“å¼€ä¸‹è½½çª—å£`);
            log(`   - å¦‚æœæ— é¡¹ç›®ï¼šæ˜¾ç¤ºé¡¹ç›®è¦æ±‚å¯¹è¯æ¡†`);
        }
        
        async function testProjectIntegration() {
            log('ğŸ”— æµ‹è¯•é¡¹ç›®é›†æˆåŠŸèƒ½...');
            
            try {
                const project = await window.electronAPI.getCurrentProject();
                if (project) {
                    log(`âœ… é¡¹ç›®é›†æˆæµ‹è¯•:`);
                    log(`   - é¡¹ç›®åç§°: ${project.name}`);
                    log(`   - æ•°æ®è·¯å¾„: ${project.dataFolderPath}`);
                    log(`   - é¢„æœŸåŸºå› ç»„ç›®å½•: ${project.dataFolderPath}/genomes`);
                    
                    showStatus('integrationStatus', 
                        `é¡¹ç›®é›†æˆæ­£å¸¸<br>åŸºå› ç»„æ–‡ä»¶å°†ä¿å­˜åˆ°ï¼š${project.dataFolderPath}/genomes`, 
                        'success');
                } else {
                    log('âš ï¸ æ— æ´»åŠ¨é¡¹ç›®ï¼Œæ— æ³•æµ‹è¯•é›†æˆåŠŸèƒ½');
                    showStatus('integrationStatus', 'éœ€è¦å…ˆæ‰“å¼€ä¸€ä¸ªé¡¹ç›®æ‰èƒ½æµ‹è¯•é›†æˆåŠŸèƒ½', 'warning');
                }
            } catch (error) {
                log(`âŒ é¡¹ç›®é›†æˆæµ‹è¯•å¤±è´¥: ${error.message}`);
                showStatus('integrationStatus', `é›†æˆæµ‹è¯•å¤±è´¥ï¼š${error.message}`, 'error');
            }
        }
        
        function testDownloadPath() {
            log('ğŸ“ æµ‹è¯•ä¸‹è½½è·¯å¾„è®¾ç½®...');
            log('ğŸ“ æµ‹è¯•æ­¥éª¤ï¼š');
            log('   1. æ‰“å¼€åŸºå› ç»„ä¸‹è½½çª—å£');
            log('   2. æ£€æŸ¥è¾“å‡ºç›®å½•æ˜¯å¦è‡ªåŠ¨è®¾ç½®ä¸ºé¡¹ç›®çš„genomesæ–‡ä»¶å¤¹');
            log('   3. éªŒè¯é¡¹ç›®ä¿¡æ¯æ˜¯å¦åœ¨ç•Œé¢ä¸­æ­£ç¡®æ˜¾ç¤º');
            log('ğŸ¯ é¢„æœŸï¼šè¾“å‡ºç›®å½• = [ProjectPath]/genomes');
        }
        
        async function testDownloadToProject() {
            log('ğŸ“¥ æµ‹è¯•ä¸‹è½½åˆ°é¡¹ç›®åŠŸèƒ½...');
            
            try {
                const project = await window.electronAPI.getCurrentProject();
                if (!project) {
                    log('âŒ éœ€è¦å…ˆæ‰“å¼€ä¸€ä¸ªé¡¹ç›®');
                    showStatus('downloadStatus', 'è¯·å…ˆåˆ›å»ºæˆ–æ‰“å¼€ä¸€ä¸ªé¡¹ç›®', 'warning');
                    return;
                }
                
                // æµ‹è¯•ä¸‹è½½ä¸€ä¸ªå°æ–‡ä»¶
                const testUrl = 'https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=nucleotide&id=NC_000913&rettype=fasta&retmode=text&retstart=1&retend=100';
                const filename = 'test_download.fasta';
                
                log(`ğŸ”— æµ‹è¯•ä¸‹è½½URL: ${testUrl}`);
                log(`ğŸ“ ç›®æ ‡é¡¹ç›®: ${project.name}`);
                log(`ğŸ’¾ é¢„æœŸä¿å­˜è·¯å¾„: ${project.dataFolderPath}/genomes/${filename}`);
                
                const result = await window.electronAPI.downloadFile(testUrl, filename, project);
                
                if (result.success) {
                    log(`âœ… ä¸‹è½½æˆåŠŸ: ${result.filePath}`);
                    showStatus('downloadStatus', 
                        `ä¸‹è½½æˆåŠŸï¼<br>æ–‡ä»¶ä¿å­˜åˆ°ï¼š${result.filePath}`, 
                        'success');
                } else {
                    log(`âŒ ä¸‹è½½å¤±è´¥: ${result.error}`);
                    showStatus('downloadStatus', `ä¸‹è½½å¤±è´¥ï¼š${result.error}`, 'error');
                }
                
            } catch (error) {
                log(`âŒ ä¸‹è½½æµ‹è¯•å‡ºé”™: ${error.message}`);
                showStatus('downloadStatus', `ä¸‹è½½æµ‹è¯•å¤±è´¥ï¼š${error.message}`, 'error');
            }
        }
        
        function checkDownloadedFiles() {
            log('ğŸ“‹ æ£€æŸ¥å·²ä¸‹è½½æ–‡ä»¶...');
            log('ğŸ“ æ‰‹åŠ¨æ£€æŸ¥æ­¥éª¤ï¼š');
            log('   1. æ‰“å¼€é¡¹ç›®æ–‡ä»¶å¤¹');
            log('   2. å¯¼èˆªåˆ° genomes å­æ–‡ä»¶å¤¹');
            log('   3. éªŒè¯ä¸‹è½½çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨');
            log('   4. æ£€æŸ¥æ–‡ä»¶å†…å®¹æ˜¯å¦æ­£ç¡®');
            showStatus('downloadStatus', 'è¯·æ‰‹åŠ¨æ£€æŸ¥é¡¹ç›®çš„genomesæ–‡ä»¶å¤¹ä¸­çš„ä¸‹è½½æ–‡ä»¶', 'info');
        }
        
        async function testAllAPIs() {
            log('ğŸ“¡ æµ‹è¯•æ‰€æœ‰APIè¿æ¥...');
            
            const apis = [
                { name: 'NCBI', url: 'https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=nucleotide&term=test&retmax=1&retmode=json' },
                { name: 'EMBL-EBI', url: 'https://www.ebi.ac.uk/ena/portal/api/search?result=sequence&query=test&format=json&limit=1' },
                { name: 'Ensembl', url: 'https://rest.ensembl.org/info/ping?content-type=application/json' },
                { name: 'UniProt', url: 'https://rest.uniprot.org/uniprotkb/search?query=test&format=json&size=1' }
            ];
            
            let results = [];
            
            for (const api of apis) {
                try {
                    log(`ğŸ”— æµ‹è¯• ${api.name} API...`);
                    const response = await fetch(api.url);
                    if (response.ok) {
                        log(`âœ… ${api.name} API è¿æ¥æˆåŠŸ (${response.status})`);
                        results.push(`${api.name}: âœ… è¿æ¥æˆåŠŸ`);
                    } else {
                        log(`âŒ ${api.name} API è¿æ¥å¤±è´¥ (${response.status})`);
                        results.push(`${api.name}: âŒ è¿æ¥å¤±è´¥ (${response.status})`);
                    }
                } catch (error) {
                    log(`âŒ ${api.name} API è¿æ¥é”™è¯¯: ${error.message}`);
                    results.push(`${api.name}: âŒ è¿æ¥é”™è¯¯`);
                }
            }
            
            showStatus('apiStatus', results.join('<br>'), 
                results.every(r => r.includes('âœ…')) ? 'success' : 'warning');
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            log('ğŸ§¬ åŸºå› ç»„ä¸‹è½½ä¸é¡¹ç›®é›†æˆæµ‹è¯•é¡µé¢å·²åŠ è½½');
            log('');
            log('ğŸ“‹ æµ‹è¯•æ¸…å•ï¼š');
            log('   âœ“ é¡¹ç›®çŠ¶æ€æ£€æŸ¥');
            log('   âœ“ èœå•è®¿é—®æµ‹è¯•');
            log('   âœ“ é¡¹ç›®é›†æˆéªŒè¯');
            log('   âœ“ ä¸‹è½½åŠŸèƒ½æµ‹è¯•');
            log('   âœ“ APIè¿æ¥æµ‹è¯•');
            log('');
            log('ğŸ¯ å¼€å§‹æµ‹è¯•ï¼šç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ‰§è¡Œå„é¡¹æµ‹è¯•');
            log('');
            
            // è‡ªåŠ¨æ£€æŸ¥é¡¹ç›®çŠ¶æ€
            setTimeout(checkProjectStatus, 1000);
        });
    </script>
</body>
</html> 